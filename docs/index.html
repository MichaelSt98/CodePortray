<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>CodePortray</title>
	<base href="/">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--
	<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=9"/>
	-->
	<meta name="generator" content="Doxygen 1.9.3"/>
	<title>milupHPC: milupHPC</title>
	<title>milupHPC</title>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css2?family=Alata&amp;display=swap" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="CodePortray/components/side-nav/styles.css" type="text/css">
	<link rel="stylesheet" href="CodePortray/components/hamburger/styles.css" type="text/css">
	<link rel="stylesheet" href="CodePortray/components/header/styles.css" type="text/css">
	<link rel="stylesheet" href="CodePortray/components/icons/styles.css" type="text/css">
	<link rel="stylesheet" href="CodePortray/components/dialog/styles.css" type="text/css">
	<link rel="stylesheet" href="CodePortray/components/copyable/styles.css" type="text/css">
	<link rel="stylesheet" href="CodePortray/https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css">
	<link href="CodePortray/tabs.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="CodePortray/jquery.js"></script>
	<script type="text/javascript" src="CodePortray/dynsections.js"></script>
	<!--
	<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
	<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
	<link href="CodePortray/doxygen-custom.css" rel="stylesheet" type="text/css"/>
	-->
	<link href="CodePortray/search/search.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="CodePortray/search/searchdata.js"></script>
	<script type="text/javascript" src="CodePortray/search/search.js"></script>
	<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
	<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
	<link href="doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<custom-header class="custom-header-class">
	<!--<custom-hamburger menu onclick="toggle()"></custom-hamburger>-->
	<a menu href="https://michaelst98.github.io/milupHPC/"><custom-icon icon="home" color="white" background="black"></custom-icon></a>
	<div shortcuts style="display: table">
		<div style="display: table-cell; padding-right: 2px">
			<a title="GitHub: milupHPC" href="https://github.com/MichaelSt98/milupHPC"><custom-icon icon="github" color="white" background="#2A2D32"></custom-icon></a>
		</div>
		<div style="display: table-cell; padding-right: 2px">
			<a title="Computational physics TÃ¼bingen" href="https://uni-tuebingen.de/en/faculties/faculty-of-science/departments/physics/institutes/astronomy-astrophysics/computational-physics/welcome/"><custom-icon icon="university" color="white" background="#8D2439"></custom-icon></a>
		</div>
		<div style="display: table-cell; padding-right: 2px">
			<a title="Wikipedia: Smoothed particle hydrodynamics" href="https://de.wikipedia.org/wiki/Smoothed_Particle_Hydrodynamics"><custom-icon icon="wikipedia-w" color="black" background="lightgrey"></custom-icon></a>
		</div>
		<div style="display: table-cell; padding-right: 2px">
			<a title="Youtube: CPTuebingen" href="https://www.youtube.com/user/CPTuebingen"><custom-icon icon="youtube" color="white" background="#DB0000"></custom-icon></a>
		</div>
		<!-- get the code ... -->
		<!--<custom-icon url="https://www.google.com" icon="code" color="white" background="black"></custom-icon>-->
		<div style="display: table-cell; padding-right: 2px">
			<custom-dialog window-width="600px" window-height="400px">
				<span open><custom-icon title="Get the code" icon="code" color="white" background="black"></custom-icon></span>
				<div title>Get the code: milupHPC!</div>
				<div style="text-align: center; padding-top: 20px;">
					<div>The code is publicly available on GitHub: <a title="GitHub: milupHPC" href="https://github.com/MichaelSt98/milupHPC"><custom-icon icon="github" color="white" background="#2A2D32"></custom-icon></a></div>
					<!--<div><a title="GitHub: milupHPC" href="https://github.com/MichaelSt98/milupHPC"><custom-icon icon="github" color="white" background="#2A2D32"></custom-icon></a></div>-->
					<!--<a href="https://github.com/MichaelSt98/milupHPC">github.com/MichaelSt98/milupHPC</a>-->
					<div style="padding-top: 40px">clone via HTTPS:</div>
					<custom-copyable copy-text="https://github.com/MichaelSt98/milupHPC.git" width="none" height="33px">
						<custom-icon icon="clone" color="white" background="black" size="15px"></custom-icon>
					</custom-copyable>
					<div style="padding-top: 20px">clone via SSH:</div>
					<custom-copyable copy-text="git@github.com:MichaelSt98/milupHPC.git" width="none" height="33px">
						<custom-icon icon="clone" color="white" background="black" size="15px"></custom-icon>
					</custom-copyable>
					<div style="padding-top: 20px">or download as zip: <a href="https://github.com/MichaelSt98/milupHPC/archive/refs/heads/main.zip"><custom-icon icon="file-archive-o" color="white" background="black"></custom-icon></a></div>
					<!--<a href="https://github.com/MichaelSt98/milupHPC/archive/refs/heads/main.zip"><custom-icon icon="file-archive-o" color="white" background="black"></custom-icon></a>-->
				</div>
				<!--<div footer>This is the footer</div>-->
			</custom-dialog>
		</div>
		<!-- end: get the code .... -->
		<div style="display: table-cell; padding-right: 2px">
			<a title="License" href="https://github.com/MichaelSt98/milupHPC/blob/main/LICENSE"><custom-icon icon="balance-scale" color="white" background="#000000"></custom-icon></a>
		</div>
		<!--<a href=""><custom-icon url="https://www.google.com" icon="terminal" color="white" background="black"></custom-icon></a>-->
	</div>
</custom-header>
	<!--
	<custom-side-nav id="side-nav" nav-width="300">
		<custom-icon url="https://www.google.com" icon="code" color="white" background="black"></custom-icon>
		<div>test</div>
	</custom-side-nav>
	-->
	<div id="banner">
		<div class="logo">
			<span class="subtitle">
				milupHPC documentation
			</span>
		</div>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">milupHPC </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_doc_Mainpage"></a> This is the <b>API documentation for milupHPC</b> - a parallel smoothed particle hydrodynamics (<b><a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a></b>) targeting GPU cluster via CUDA-aware MPI.</p>
<p >Relevant links:</p>
<ul>
<li><a href="https://github.com/michaelst98/miluphpc">GitHub: milupHPC</a></li>
<li><a href="https://github.com/christophmschaefer/miluphcuda">GitHub: miluphcuda</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md32"></a>
About</h1>
<hr  />
<p >The computational method Smoothed <a class="el" href="class_particle.html">Particle</a> Hydrodynamics is an expedient method for solving hydrodynamic equations and is in combination with a method for self-gravity applicable for astrophysical simulations. Since computationally expensive, appropriate methods and technologies need to be utilized. Especially parallelization is a promising approach.</p>
<p >Thus, this work aims to describe and implement a multi-GPU Smoothed <a class="el" href="class_particle.html">Particle</a> Hydrodynamics code with self-gravity via the Barnes-Hut method using CUDA-aware MPI targeting GPU cluster. The Barnes-Hut method is an approximative N-body tree method subdividing the simulation domain hierarchically and approximating the potential of a distant group using a multipole expansion of the potential which reduces the overall complexity of the gravitational force computation. While the parallelization for shared memory systems is relatively straightforward, many challenges and problems arise for distributed memory parallelization.</p>
<p >The approach presented here is based on the parallelization of the tree as constructed for the Barnes-Hut method. Every process' local tree contains the particles assigned to this process and in addition nodes identical for all processes forming a common coarse tree. This shared part of the tree enables processes to gain knowledge about the local trees on the other processes. Moreover, the tree constructed in this way permit the introduction of space-filling-curves which themselves are basis for an efficient domain decomposition and load-balancing. In addition, the parallel tree facilitates the determination of communication patterns which are necessary for calculating the forces arising from the Barnes-Hut method and <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a>. <a class="el" href="class_particle.html">Particle</a> exchange via message passing is necessary since not all particles are accessible on all processes as the target architecture are distributed memory systems. Besides, this thesis investigates efficient GPU implementations of <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> and the Barnes-Hut algorithm including the gravitational force computation and fixed-radius near neighbor search.</p>
<hr  />
<p ><b>High Performance Computing Smooth(ed) <a class="el" href="class_particle.html">Particle</a> Hydrodynamics</b></p>
<p >The successor of <a href="https://github.com/christophmschaefer/miluphcuda">miluphcuda</a> targeting GPU cluster via CUDA aware MPI.</p>
<hr  />
<p >This repository implements a <b>multi-GPU <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> &amp; N-body (via Barnes-Hut) algorithm using C++11 and CUDA-aware MPI</b> by combining already proven parallelization strategies and available implementations</p>
<ul>
<li><b>single-GPU version inspired/adopted from:</b><ul>
<li><a href="https://github.com/christophmschaefer/miluphcuda">miluphcuda</a></li>
<li><a href="https://iss.oden.utexas.edu/Publications/Papers/burtscher11.pdf">An Efficient CUDA Implementation of the Tree-Based Barnes Hut n-Body Algorithm</a></li>
</ul>
</li>
<li><b>multi-node (or rather multi-CPU) version inspired/adopted from:</b><ul>
<li>M. Griebel, S. Knapek, and G. Zumbusch. Numerical Simulation in Molecular Dynamics: Numerics, Algorithms, Parallelization, Applications. 1st. Springer Pub- lishing Company, Incorporated, 2010. isbn: 3642087760</li>
</ul>
</li>
</ul>
<p >with new ideas and parallelization strategies.</p>
<ul>
<li>for a <b>versatile single-GPU implementation</b> refer to <a href="https://github.com/christophmschaefer/miluphcuda">miluphcuda</a></li>
<li>for a <b>multi-CPU implementation</b> (self-gravity via Barnes-Hut only) refer to <a href="https://github.com/jammartin/ParaLoBstar">jammartin/ParaLoBstar</a></li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md33"></a>
Parallelization/Implementation</h2>
<ul>
<li>Parallelization embraces both<ul>
<li><b>multi-node</b> parallelization via message-passing and</li>
<li><b>single-node</b> parallelization for **GPU**s via CUDA</li>
</ul>
</li>
</ul>
<p >implemented using <b>C++ and CUDA-aware MPI</b>.</p>
<p ><img src="documents/figures/class_miluphpc__coll__graph_small.png" alt="Collaboration diagram" width="100%" class="inline"/></p>
<p ><b>Implementation details</b></p>
<div class="fragment"><div class="line">include/src</div>
<div class="line">âââ cuda_utils // CUDA utilities</div>
<div class="line">âÂ Â  âââ cuda_launcher.cuh/cu</div>
<div class="line">âÂ Â  âââ cuda_runtime.h/cpp</div>
<div class="line">âÂ Â  âââ cuda_utilities.cuh/cu</div>
<div class="line">âÂ Â  âââ linalg.cuh/cu</div>
<div class="line">âââ device_rhs.cuh/cu</div>
<div class="line">âââ gravity // Gravity related functions/kernels</div>
<div class="line">âÂ Â  âââ gravity.cuh/cu</div>
<div class="line">âââ helper.cuh/cu // buffer class</div>
<div class="line">âââ helper_handler.h/cpp // buffer handling</div>
<div class="line">âââ integrator // Integrator classes, inheriting from miluphpc.h/cpp</div>
<div class="line">âÂ Â  âââ device_explicit_euler.cuh/cu</div>
<div class="line">âÂ Â  âââ device_leapfrog.cuh/cu</div>
<div class="line">âÂ Â  âââ device_predictor_corrector_euler.cuh/cu</div>
<div class="line">âÂ Â  âââ explicit_euler.h/cpp</div>
<div class="line">âÂ Â  âââ leapfrog.h/cpp</div>
<div class="line">âÂ Â  âââ predictor_corrector_euler.h/cpp</div>
<div class="line">âââ main.cpp // main</div>
<div class="line">âââ materials // material handling (for SPH)</div>
<div class="line">âÂ Â  âââ material.cuh/cu</div>
<div class="line">âÂ Â  âââ material_handler.cuh/cpp</div>
<div class="line">âââ miluphpc.h/cpp // base class for dispatching simulation</div>
<div class="line">âââ particle_handler.h/cpp // particle class handling</div>
<div class="line">âââ particles.cuh/cu // particle information/class</div>
<div class="line">âââ processing</div>
<div class="line">âÂ Â  âââ kernels.cuh/cu</div>
<div class="line">âââ simulation_time.cuh/cu // simulation time class</div>
<div class="line">âââ simulation_time_handler.cpp // simulation time handling</div>
<div class="line">âââ sph // SPH related functions/kernels</div>
<div class="line">âÂ Â  âââ density.cuh/cu</div>
<div class="line">âÂ Â  âââ internal_forces.cuh/cu</div>
<div class="line">âÂ Â  âââ kernel.cuh/cu</div>
<div class="line">âÂ Â  âââ kernel_handler.cuh/cu</div>
<div class="line">âÂ Â  âââ pressure.cuh/cu</div>
<div class="line">âÂ Â  âââ soundspeed.cuh/cu</div>
<div class="line">âÂ Â  âââ sph.cuh/cu</div>
<div class="line">âÂ Â  âââ stress.cuh/cu</div>
<div class="line">âÂ Â  âââ viscosity.cuh/cu</div>
<div class="line">âââ subdomain_key_tree // Tree related functions/kernels as well as domain decomposition</div>
<div class="line">âÂ Â  âââ subdomain.cuh/cu</div>
<div class="line">âÂ Â  âââ subdomain_handler.h/cpp</div>
<div class="line">âÂ Â  âââ tree.cuh/cu</div>
<div class="line">âÂ Â  âââ tree_handler.h/cpp</div>
<div class="line">âââ utils // C++ utilities</div>
<div class="line">    âââ config_parser.h/cpp</div>
<div class="line">    âââ h5profiler.h/cpp</div>
<div class="line">    âââ logger.h/cpp</div>
<div class="line">    âââ timer.h/cpp</div>
</div><!-- fragment --><p >The actual implementation and dispatching of the simulation includes</p>
<ul>
<li>pre-processing (inititial particle distribution, ...)</li>
<li>preparation tasks like<ul>
<li>initializing the MPI and CUDA environment</li>
<li>reading the initial particle distribution</li>
<li>memory allocation, ...</li>
</ul>
</li>
<li>the actual simulation in dependence of the used integration scheme<ul>
<li>encapsulated in the right-hand-side (as depicted in the following picture)</li>
<li>advancing the particles</li>
</ul>
</li>
<li>post-processing</li>
<li>...</li>
</ul>
<p >However, as the following suggests, the simulation differs for single and multi-node execution, whereas multi-node execution requires more and more sophisticated functionalities to ensure the correctness of the algorithms.</p>
<p ><img src="documents/figures/right-hand-side.png" alt="right-hand-side" width="100%" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md34"></a>
Prerequisites/Dependencies</h2>
<p >For more information and instructions refer to <a class="el" href="md_documents__prerequisites.html">Prerequisites.md</a></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">library   </th><th class="markdownTableHeadNone">licence   </th><th class="markdownTableHeadNone">usage   </th><th class="markdownTableHeadNone">link    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GNU   </td><td class="markdownTableBodyNone">GPLv3+   </td><td class="markdownTableBodyNone">Â compiler   </td><td class="markdownTableBodyNone"><a href="https://www.gnu.org/home.de.html">gnu.org</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OpenMPI   </td><td class="markdownTableBodyNone">BSD 3-Clause   </td><td class="markdownTableBodyNone">compiler, MPI Implementation   </td><td class="markdownTableBodyNone"><a href="https://www.open-mpi.org/">open-mpi.org</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CUDA   </td><td class="markdownTableBodyNone">CUDA Toolkit End User License Agreement   </td><td class="markdownTableBodyNone">compiler, CUDA Toolkit and API   </td><td class="markdownTableBodyNone"><a href="https://developer.nvidia.com/">developer.nvidia.com</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Â CUDA cub   </td><td class="markdownTableBodyNone">BSD 3-Clause "New" or "Revised" License   </td><td class="markdownTableBodyNone">device wide parallel primitives   </td><td class="markdownTableBodyNone"><a href="https://github.com/NVIDIA/cub">github.com/NVIDIA/cub</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">HDF5   </td><td class="markdownTableBodyNone">HDF5 License (BSD-Style)   </td><td class="markdownTableBodyNone">parallel HDF5 for I/O operations   </td><td class="markdownTableBodyNone"><a href="https://www.hdfgroup.org/solutions/hdf5/">hdf5group.org</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">HighFive   </td><td class="markdownTableBodyNone">Boost Software License 1.0   </td><td class="markdownTableBodyNone">C++ wrapper for parallel HDF5   </td><td class="markdownTableBodyNone"><a href="https://github.com/BlueBrain/HighFive">github.com/BlueBrain/HighFive</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Boost   </td><td class="markdownTableBodyNone">Boost Software License 1.0   </td><td class="markdownTableBodyNone">config file parsing, C++ wrapper for MPI   </td><td class="markdownTableBodyNone"><a href="https://www.boost.org/">boost.org</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">cxxopts   </td><td class="markdownTableBodyNone">MIT license   </td><td class="markdownTableBodyNone">command line argument parsing   </td><td class="markdownTableBodyNone"><a href="https://github.com/jarro2783/cxxopts">github.com/jarro2783/cxxopts</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">libconfig   </td><td class="markdownTableBodyNone">LGPL-2.1   </td><td class="markdownTableBodyNone">material config parsing   </td><td class="markdownTableBodyNone"><a href="http://hyperrealm.github.io/libconfig/">github.io/libconfig</a>   </td></tr>
</table>
<ul>
<li>in general there is no need for the usage of the GNU compiler and OpenMPI as MPI implementation, as long as a proper C++ compiler as well as MPI implementation (CUDA-aware) are available and corresponding changes in the Makefile are done</li>
</ul>
<h2><a class="anchor" id="autotoc_md35"></a>
Usage</h2>
<ul>
<li>you need to provide an appropriate H5 file as initial (particle) distribution<ul>
<li>see e.g. <a href="https://github.com/MichaelSt98/ParticleDistributor">GitHub: ParticleDistributor</a></li>
</ul>
</li>
<li><b>build/compile</b> using the <em>Makefile</em> via: <code>make</code><ul>
<li>for debug: <code>make debug</code><ul>
<li>using <em>cuda-gdb</em>: <code>./debug/cuda_debug.sh</code></li>
</ul>
</li>
<li>for single-precision: <code>make single-precision</code> (default: double-precision)</li>
</ul>
</li>
<li><b>run</b> via **<code>mpirun -np &lt;np&gt; &lt;binary&gt; -n &lt;#output files&gt; -f &lt;input hdf5 file&gt; -C &lt;config file&gt; -m &lt;material-config&gt;</code>**<ul>
<li><code>&lt;binary&gt;</code> within <code>bin/</code> e.g. <code>bin/runner</code></li>
<li><code>&lt;input hdf5 file&gt;</code>: appropriate HDF5 file as initial (particle) distribution</li>
<li><code>&lt;config file&gt;</code>: configurations</li>
<li><code>&lt;material-config&gt;</code> : material configurations</li>
<li>as well as correct preprocessor directives: <code><a class="el" href="include_2parameter_8h.html" title="Settings via preprocessor directives, typedefs, constants, structs.">include/parameter.h</a></code></li>
</ul>
</li>
<li>clean via: <code>make clean</code>, <code>make cleaner</code></li>
<li>rebuild via: <code>make remake</code></li>
</ul>
<p ><b>Preprocessor directives: parameter.h</b></p>
<ul>
<li>see <code><a class="el" href="include_2parameter_8h.html" title="Settings via preprocessor directives, typedefs, constants, structs.">include/parameter.h</a></code></li>
</ul>
<div class="fragment"><div class="line"><span class="preprocessor">#define DEBUGGING 0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SAFETY_LEVEL 2</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DIM 3</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SI_UNITS 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define CUBIC_DOMAINS 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define GRAVITY_SIM 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SPH_SIM 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define INTEGRATE_ENERGY 0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define INTEGRATE_DENSITY 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define INTEGRATE_SML 0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DECOUPLE_SML 0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VARIABLE_SML 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SML_CORRECTION 0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SPH_EQU_VERSION 1</span></div>
</div><!-- fragment --><p ><b>Input HDF5 file</b></p>
<ul>
<li>for <b>gravity only</b><ul>
<li>provide mass "m", position "x" and velocity "v"</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">GROUP &quot;/&quot; {</div>
<div class="line">   DATASET &quot;m&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt; ) / ( &lt;num particles&gt;  ) }</div>
<div class="line">   }</div>
<div class="line">   DATASET &quot;v&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt; , &lt;dim&gt; ) / ( &lt;num particles&gt; , &lt;dim&gt; ) }</div>
<div class="line">   }</div>
<div class="line">   DATASET &quot;x&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt; , &lt;dim&gt;  ) / (&lt;num particles&gt; , &lt;dim&gt;  ) }</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li><b>with <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a></b> provide (at least)<ul>
<li>provide mass "m", material identifier "materialId", internal energy "u", position "x" and velocity "v"</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">GROUP &quot;/&quot; {</div>
<div class="line">   DATASET &quot;m&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt; ) / ( &lt;num particles&gt;  ) }</div>
<div class="line">   }</div>
<div class="line">   DATASET &quot;materialId&quot; {</div>
<div class="line">      DATATYPE  H5T_STD_I8LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt;  ) / ( &lt;num particles&gt;  ) }</div>
<div class="line">   }</div>
<div class="line">   DATASET &quot;u&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt;  ) / ( &lt;num particles&gt;  ) }</div>
<div class="line">   }</div>
<div class="line">   DATASET &quot;v&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt; , &lt;dim&gt; ) / ( &lt;num particles&gt; , &lt;dim&gt; ) }</div>
<div class="line">   }</div>
<div class="line">   DATASET &quot;x&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt; , &lt;dim&gt;  ) / (&lt;num particles&gt; , &lt;dim&gt;  ) }</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="line">}</div>
</div><!-- fragment --><p ><b>Config file</b></p>
<div class="fragment"><div class="line">; IO RELATED</div>
<div class="line">; ------------------------------------------------------</div>
<div class="line">; output directory (will be created if it does not exist)</div>
<div class="line">directory bb/</div>
<div class="line"> </div>
<div class="line">; outputRank (-1 corresponds to all)</div>
<div class="line">outputRank -1</div>
<div class="line">; omit logType::TIME for standard output</div>
<div class="line">omitTime true</div>
<div class="line">; create log file (including warnings, errors, ...)</div>
<div class="line">log true</div>
<div class="line">; create performance log</div>
<div class="line">performanceLog true</div>
<div class="line">; write particles to be sent to h5 file</div>
<div class="line">particlesSent2H5 true</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">; INTEGRATOR RELATED</div>
<div class="line">; ------------------------------------------------------</div>
<div class="line">; integrator selection</div>
<div class="line">; explicit euler [0], predictor-corrector euler [1], leapfrog [2]</div>
<div class="line">integrator 1</div>
<div class="line">; initial time step</div>
<div class="line">timeStep 1e-4</div>
<div class="line">; max time step allowed</div>
<div class="line">maxTimeStep 1e-4</div>
<div class="line">; end time for simulation</div>
<div class="line">;timeEnd 6e-2</div>
<div class="line"> </div>
<div class="line">; SIMULATION RELATED</div>
<div class="line">; ------------------------------------------------------</div>
<div class="line">; space-filling curve selection</div>
<div class="line">; lebesgue [0], hilbert [1]</div>
<div class="line">sfc 1</div>
<div class="line"> </div>
<div class="line">; theta-criterion for Barnes-Hut (approximative gravity)</div>
<div class="line">theta 0.5</div>
<div class="line">; smoothing parameter for gravitational forces</div>
<div class="line">smoothing 2.56e+20</div>
<div class="line"> </div>
<div class="line">; SPH smoothing kernel selection</div>
<div class="line">; spiky [0], cubic spline [1], wendlandc2 [3], wendlandc4 [4], wendlandc6 [5]</div>
<div class="line">smoothingKernel 1</div>
<div class="line"> </div>
<div class="line">; remove particles (corresponding to some criterion)</div>
<div class="line">removeParticles true</div>
<div class="line">; spherically [0], cubic [1]</div>
<div class="line">removeParticlesCriterion 0</div>
<div class="line">; allowed distance to center (0, 0, 0)</div>
<div class="line">removeParticlesDimension 3.6e14</div>
<div class="line"> </div>
<div class="line">; execute load balancing</div>
<div class="line">loadBalancing false</div>
<div class="line">; interval for executing load balancing (every Nth step)</div>
<div class="line">loadBalancingInterval 1</div>
<div class="line"> </div>
<div class="line">; how much memory to allocate (1.0 -&gt; all particles can in principle be on one process)</div>
<div class="line">particleMemoryContingent 1.0</div>
<div class="line"> </div>
<div class="line">; calculate angular momentum (and save to output file)</div>
<div class="line">calculateAngularMomentum true</div>
<div class="line">; calculate (total) energy (and save to output file)</div>
<div class="line">calculateEnergy true</div>
<div class="line">; calculate center of mass (and save to output file)</div>
<div class="line">calculateCenterOfMass false</div>
<div class="line"> </div>
<div class="line">; IMPLEMENTATION SELECTION</div>
<div class="line">; ------------------------------------------------------</div>
<div class="line">; force version for gravity (use [2])</div>
<div class="line">; burtscher [0], burtscher without presorting [1], miluphcuda with presorting [2],</div>
<div class="line">; miluphcuda without presorting [3], miluphcuda shared memory (experimental) [4]</div>
<div class="line">gravityForceVersion 0</div>
<div class="line">; fixed radius NN version for SPH (use [0])</div>
<div class="line">; normal [0], brute-force [1], shared-memory [2], within-box [3]</div>
<div class="line">sphFixedRadiusNNVersion 3</div>
</div><!-- fragment --><p ><b><a class="el" href="class_material.html" title="Material parameters.">Material</a> config file</b></p>
<div class="fragment"><div class="line">materials = (</div>
<div class="line">{</div>
<div class="line">    ID = 0</div>
<div class="line">    name = &quot;IsothermalGas&quot;</div>
<div class="line">    #sml = 1e12</div>
<div class="line">    sml = 5.2e11</div>
<div class="line">    interactions = 50</div>
<div class="line">    artificial_viscosity = { alpha = 1.0; beta = 2.0; };</div>
<div class="line">    eos = {</div>
<div class="line">        type = 3</div>
<div class="line">    };</div>
<div class="line">}</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line">...</div>
</div><!-- fragment --><p ><b>Command line arguments</b></p>
<ul>
<li><code>./bin/runner -h</code> gives help:</li>
</ul>
<div class="fragment"><div class="line">Multi-GPU CUDA Barnes-Hut NBody/SPH code</div>
<div class="line">Usage:</div>
<div class="line">  HPC NBody [OPTION...]</div>
<div class="line"> </div>
<div class="line">  -n, --number-output-files arg</div>
<div class="line">                                number of output files (default: 100)</div>
<div class="line">  -t, --max-time-step arg       time step (default: -1.)</div>
<div class="line">  -l, --load-balancing          load balancing</div>
<div class="line">  -L, --load-balancing-interval arg</div>
<div class="line">                                load balancing interval (default: -1)</div>
<div class="line">  -C, --config arg              config file (default: config/config.info)</div>
<div class="line">  -m, --material-config arg     material config file (default: </div>
<div class="line">                                config/material.cfg)</div>
<div class="line">  -c, --curve-type arg          curve type (Lebesgue: 0/Hilbert: 1) </div>
<div class="line">                                (default: -1)</div>
<div class="line">  -f, --input-file arg          File name (default: -)</div>
<div class="line">  -v, --verbosity arg           Verbosity level (default: 0)</div>
<div class="line">  -h, --help                    Show this help</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md36"></a>
Samples/Validation</h2>
<p >The code validation comprises the correctness of dispatched simulation on one GPU and multiple GPUs, whereas identical simulation on one and multiple GPUs are not mandatorily bitwise-identical. By suitable choice of compiler flags and in dependence of the used architecture this is in principle attainable. However, this is generally not useful to apply for performance reasons and therefore at this point not presupposed. Amongst others, three test cases were used for validating the implementation:</p>
<ul>
<li>the Plummer test case is a gravity-only test case</li>
<li>the Taylorâvon NeumannâSedov blast wave test case is a pure hydrodynamical <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> test case</li>
<li>the isothermal collapse test case self-gravitating <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> test case utilizing almost all implemented features</li>
</ul>
<blockquote class="doxtable">
<p >&zwj;each color represents a process, thus a GPU </p>
</blockquote>
<p><b>Plummer</b></p>
<ul>
<li>Plummer model: four GPUs with dynamic load balancing every 10th step (top: lebesgue, bottom: hilbert)</li>
</ul>
<p ><img src="documents/4proc_plummer_dynamic.gif" alt="Plummer sample" width="100%" class="inline"/></p>
<p >The Plummer model is a gravity only test case, the distribution is stable over time enabling the validation as shown in the following picture.</p>
<p ><img src="documents/figures/long_pl_N10000000_sfc1D_np4_mass_quantiles.png" alt="Plummer sample" width="100%" class="inline"/></p>
<p ><b>Taylorâvon NeumannâSedov blast wave</b></p>
<ul>
<li>Sedov explosion: one and two GPUs</li>
</ul>
<p ><img src="documents/sedov_sample_movie.gif" alt="Sedov sample" width="100%" class="inline"/></p>
<p >The density in dependence of the radius for t = 0.06 and the semi-analytical solution as comparison.</p>
<p ><img src="documents/figures/sedov_N171_sfc1D_np8_density.png" alt="Sedov sample" width="100%" class="inline"/></p>
<p ><b>Boss-Bodenheimer: Isothermal collapse</b></p>
<ul>
<li>Boss-Bodenheimer: isothermal collapse<ul>
<li>one and two GPUs</li>
</ul>
</li>
</ul>
<p ><img src="documents/bb_sample_movie.gif" alt="Isothermal collapse sample" width="100%" class="inline"/></p>
<p >Contour plot, showing the density at 1.2 x free-fall time.</p>
<p ><img src="documents/figures/bb_contour.png" alt="Isothermal collapse sample" width="100%" class="inline"/> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
  <hr class="footer"/><address class="footer"><small>
    <!--
    milupHPC  - milupHPC<br />
    Generated on Wed Jun 29 2022 22:58:53 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.9.3
    -->
  </small></address>
</body>
<footer>
  <custom-footer color="white" background="#2E4053">
    <div first>API documentation for milupHPC - a parallel SPH & Barnes-Hut code targeting GPU cluster via CUDA-aware MPI</div>
    <div second>
      <div style="text-align: center">
        <div style="display: inline-block; padding-right: 2px; padding-top: 2px">
          <a title="GitHub: milupHPC" href="https://github.com/MichaelSt98/milupHPC"><custom-icon icon="github" color="white" background="#2A2D32"></custom-icon></a>
        </div>
        <div style="display: inline-block; padding-right: 2px; padding-top: 2px">
          <a title="Computational physics TÃ¼bingen" href="https://uni-tuebingen.de/en/faculties/faculty-of-science/departments/physics/institutes/astronomy-astrophysics/computational-physics/welcome/"><custom-icon icon="university" color="white" background="#8D2439"></custom-icon></a>
        </div>
        <div style="display: inline-block; padding-right: 2px; padding-top: 2px">
          <a title="Wikipedia: Smoothed particle hydrodynamics" href="https://de.wikipedia.org/wiki/Smoothed_Particle_Hydrodynamics"><custom-icon icon="wikipedia-w" color="black" background="lightgrey"></custom-icon></a>
        </div>
      </div>
    </div>
    <div third>
      milupHPC  - milupHPC<br />
      Generated on Wed Jun 29 2022 22:58:53 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.9.3
    </div>
  </custom-footer>
</footer>
<!--
<script src="components/side-nav/runtime.js" type="module"></script><script src="components/side-nav/polyfills.js" type="module"></script><script src="components/side-nav/main.js" type="module"></script>
-->
<script src="CodePortray/components/hamburger/runtime.js" type="text/javascript"></script><script src="CodePortray/components/hamburger/polyfills.js" type="text/javascript"></script><script src="CodePortray/components/hamburger/main.js" type="text/javascript"></script>
<script src="CodePortray/components/header/runtime.js" type="text/javascript"></script><script src="CodePortray/components/header/polyfills.js" type="text/javascript"></script><script src="CodePortray/components/header/main.js" type="text/javascript"></script>
<script src="CodePortray/components/icons/runtime.js" type="text/javascript"></script><script src="CodePortray/components/icons/polyfills.js" type="text/javascript"></script><script src="CodePortray/components/icons/main.js" type="text/javascript"></script>
<script src="CodePortray/components/footer/runtime.js" type="text/javascript"></script><script src="CodePortray/components/footer/polyfills.js" type="text/javascript"></script><script src="CodePortray/components/footer/main.js" type="text/javascript"></script>
<script src="CodePortray/components/dialog/runtime.js" type="text/javascript"></script><script src="CodePortray/components/dialog/polyfills.js" type="text/javascript"></script><script src="CodePortray/components/dialog/main.js" type="text/javascript"></script>
<script src="CodePortray/components/copyable/runtime.js" type="text/javascript"></script><script src="CodePortray/components/copyable/polyfills.js" type="text/javascript"></script><script src="CodePortray/components/copyable/main.js" type="text/javascript"></script>
<!--
<script>
  function toggle() {
    var elem = document.getElementById("side-nav");
    console.log(elem);
    elem.toggleSideNav(false);
  }
</script>
-->
<!--
<script>
  function topFunction() {
    document.body.scrollTop = 0; // For Safari
    document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
  }
</script>
-->
</html>