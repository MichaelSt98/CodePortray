<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>CodePortray</title>
	<base href="/">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--
	<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=9"/>
	-->
	<meta name="generator" content="Doxygen 1.9.3"/>
	<title>milupHPC: src/gravity/gravity.cu Source File</title>
	<title>src/gravity/gravity.cu Source File</title>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Alata&amp;display=swap" rel="stylesheet">
	<link rel="stylesheet" href="components/side-nav/styles.css">
	<link rel="stylesheet" href="components/hamburger/styles.css">
	<link rel="stylesheet" href="components/header/styles.css">
	<link rel="stylesheet" href="components/icons/styles.css">
	<link rel="stylesheet" href="components/dialog/styles.css">
	<link rel="stylesheet" href="components/copyable/styles.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link href="tabs.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
	<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
	<link href="doxygen-custom.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<custom-header class="custom-header-class">
		<!--<custom-hamburger menu onclick="toggle()"></custom-hamburger>-->
		<a menu href=""><custom-icon icon="home" color="white" background="black"></custom-icon></a>
		<div shortcuts style="display: table;">
			<!--<a href=""><custom-icon icon="facebook" color="white" background="#3B5998"></custom-icon></a>-->
			<!--<a href=""><custom-icon icon="twitter" color="white" background="#55ACEE"></custom-icon></a>-->
			<!--<a href=""><custom-icon icon="linkedin" color="white" background="#3B67BE"></custom-icon></a>-->
			<!--<a href=""><custom-icon icon="slack" color="white" background="#421B4B"></custom-icon></a>-->
			<!--<a href=""><custom-icon icon="home" color="white" background="black"></custom-icon></a>-->
			<!--<a href=""><custom-icon icon="cogs" color="white" background="black"></custom-icon></a>-->
			<!--<a href=""><custom-icon icon="bars" color="white" background="black"></custom-icon></a>-->
			<div style="display: table-cell; padding-right: 2px">
				<a title="GitHub: milupHPC" href="https://github.com/MichaelSt98/milupHPC"><custom-icon icon="github" color="white" background="#2A2D32"></custom-icon></a>
			</div>
			<div style="display: table-cell; padding-right: 2px">
				<a title="Computational physics TÃ¼bingen" href="https://uni-tuebingen.de/en/faculties/faculty-of-science/departments/physics/institutes/astronomy-astrophysics/computational-physics/welcome/"><custom-icon icon="university" color="white" background="#8D2439"></custom-icon></a>
			</div>
			<div style="display: table-cell; padding-right: 2px">
				<a title="Wikipedia: Smoothed particle hydrodynamics" href="https://de.wikipedia.org/wiki/Smoothed_Particle_Hydrodynamics"><custom-icon icon="wikipedia-w" color="black" background="lightgrey"></custom-icon></a>
			</div>
			<div style="display: table-cell; padding-right: 2px">
				<a title="Youtube: CPTuebingen" href="https://www.youtube.com/user/CPTuebingen"><custom-icon icon="youtube" color="white" background="#DB0000"></custom-icon></a>
			</div>
			<div style="display: table-cell; padding-right: 2px">
				<a title="LinkedIn" href=""><custom-icon icon="linkedin" color="white" background="#3B67BE"></custom-icon></a>
			</div>
			<div style="display: table-cell; padding-right: 2px">
				<a title="Slack" href=""><custom-icon icon="slack" color="white" background="#421B4B"></custom-icon></a>
			</div>
			<!-- get the code ... -->
			<!--<custom-icon url="https://www.google.com" icon="code" color="white" background="black"></custom-icon>-->
			<div style="display: table-cell; padding-right: 2px">
				<custom-dialog window-width="600px" window-height="400px">
					<span open><custom-icon title="Get the code" icon="code" color="white" background="black"></custom-icon></span>
					<div title>Get the code: milupHPC!</div>
					<div style="text-align: center; padding-top: 20px;">
						<div>The code is publicly available on GitHub: <a title="GitHub: milupHPC" href="https://github.com/MichaelSt98/milupHPC"><custom-icon icon="github" color="white" background="#2A2D32"></custom-icon></a></div>
						<!--<div><a title="GitHub: milupHPC" href="https://github.com/MichaelSt98/milupHPC"><custom-icon icon="github" color="white" background="#2A2D32"></custom-icon></a></div>-->
						<!--<a href="https://github.com/MichaelSt98/milupHPC">github.com/MichaelSt98/milupHPC</a>-->
						<div style="padding-top: 40px">clone via HTTPS:</div>
						<custom-copyable copy-text="https://github.com/MichaelSt98/milupHPC.git" width="none" height="33px">
							<custom-icon icon="clone" color="white" background="black" size="15px"></custom-icon>
						</custom-copyable>
						<div style="padding-top: 20px">clone via SSH:</div>
						<custom-copyable copy-text="git@github.com:MichaelSt98/milupHPC.git" width="none" height="33px">
							<custom-icon icon="clone" color="white" background="black" size="15px"></custom-icon>
						</custom-copyable>
						<div style="padding-top: 20px">or download as zip: <a href="https://github.com/MichaelSt98/milupHPC/archive/refs/heads/main.zip"><custom-icon icon="file-archive-o" color="white" background="black"></custom-icon></a></div>
						<!--<a href="https://github.com/MichaelSt98/milupHPC/archive/refs/heads/main.zip"><custom-icon icon="file-archive-o" color="white" background="black"></custom-icon></a>-->
					</div>
					<!--<div footer>This is the footer</div>-->
				</custom-dialog>
			</div>
			<!-- end: get the code .... -->
			<!-- share -->
			<!--<custom-icon url="https://www.google.com" icon="share-alt" color="white" background="darkgrey"></custom-icon>-->
			<div style="display: table-cell; padding-right: 2px">
				<custom-dialog window-width="600px" window-height="400px">
					<span open><custom-icon title="About" icon="info" color="white" background="darkgrey"></custom-icon></span>
					<div title>Info</div>
					<div style="text-align: center; padding-top: 50px;">
						<div>Some information about the project</div>
						<div>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.  Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Nam liber tempor cum soluta nobis eleifend option congue nihil imperdiet doming id quod mazim placerat facer possim assum. Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, At accusam aliquyam diam diam dolore dolores duo eirmod eos erat, et nonumy sed tempor et et invidunt justo labore Stet clita ea et gubergren, kasd magna no rebum. sanctus sea sed takimata ut vero voluptua. est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat. Consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus.</div>
					</div>
				</custom-dialog>
			</div>
			<!-- end: share -->
			<div style="display: table-cell; padding-right: 2px">
				<a title="License" href="https://github.com/MichaelSt98/milupHPC/blob/main/LICENSE"><custom-icon icon="balance-scale" color="white" background="#000000"></custom-icon></a>
			</div>
			<div style="display: table-cell; padding-right: 2px">
				<custom-dialog window-width="600px" window-height="400px">
					<span open><custom-icon title="Share" icon="share-alt" color="white" background="darkgrey"></custom-icon></span>
					<div title>Contact and share!</div>
					<div style="text-align: center; padding-top: 50px;">
						<div style="display: table; align-content: center; text-align: center; margin: 0 auto;"> <!--  background: #b0b0b0; width: 90%; -->
							<div style="display: table-cell; padding-right: 2px;">
								<a href="mailto:?subject=Check out milupHPC!&amp;body=Check out this site http://www.website.com." title="Share by Email"><custom-icon icon="envelope" background="black" color="white"></custom-icon></a>
							</div>
							<div style="display: table-cell; padding-right: 2px;">
								<span onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.nameoftheproject.com'); return false"><custom-icon icon="linkedin" color="white" background="#3B67BE"></custom-icon></span>
							</div>
							<div style="display: table-cell; padding-right: 2px;">
								<a href="whatsapp://send?text=The text to share!" data-action="share/whatsapp/share"><custom-icon icon="whatsapp" color="white" background="#25D366"></custom-icon></a>
							</div>
							<div style="display: table-cell; padding-right: 2px;">
								<a href="https://telegram.me/share/url?url=www.google.com&text=Text to be shared!"><custom-icon icon="telegram" color="white" background="#0088CC"></custom-icon></a>
							</div>
							<div style="display: table-cell; padding-right: 2px;">
								<a href="http://www.reddit.com/submit?url=www.google.com&title=Title%20of%20sharing"><custom-icon icon="reddit" color="#FF5700" background="white"></custom-icon></a>
							</div>
							<div style="display: table-cell; padding-right: 2px;">
								<!-- need to be extended via https://stackoverflow.com/questions/468881/print-div-id-printarea-div-only -->
								<span onclick="window.print();return false;"><custom-icon icon="print" color="white" background="black"></custom-icon></span>
							</div>
							<!--<span onclick="window.open('https://twitter.com/share?url=https://www.nameoftheproject.com'); return false">-->
							<!--<a title="Share by Email"><a href=""><custom-icon icon="bars" color="white" background="black"></custom-icon></a>-->
						</div>
						<div>GitHub: Issues ... </div>
						<div>GitHub: Pull requests ...</div>
						<div>GitHub: Discussions ...</div>
						<div><a href=""><custom-icon icon="linkedin" color="white" background="#3B67BE"></custom-icon></a></div>
					</div>
				</custom-dialog>
			</div>
			<!--<a href=""><custom-icon url="https://www.google.com" icon="terminal" color="white" background="black"></custom-icon></a>-->
		</div>
	</custom-header>
	<!--
	<custom-side-nav id="side-nav" nav-width="300">
		<custom-icon url="https://www.google.com" icon="code" color="white" background="black"></custom-icon>
		<div>test</div>
	</custom-side-nav>
	-->
	<div id="banner">
		<div class="logo">
			<span class="subtitle">
				milupHPC documentation
			</span>
		</div>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_487e35dd24e4df5c2584ebd5d3dfced5.html">gravity</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">gravity.cu</div></div>
</div><!--header-->
<div class="contents">
<a href="gravity_8cu.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="preprocessor">#include &quot;../../include/gravity/gravity.cuh&quot;</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="preprocessor">#include &quot;../../include/cuda_utils/cuda_launcher.cuh&quot;</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span> </div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespace_gravity.html">Gravity</a> {</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span> </div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span>    <span class="keyword">namespace </span><a class="code hl_namespace" href="namespace_kernel.html">Kernel</a> {</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span> </div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel.html#ab82c5727eb23d566faca7ff2460b8b94">    8</a></span>        __global__ <span class="keywordtype">void</span> <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#ab82c5727eb23d566faca7ff2460b8b94">collectSendIndices</a>(<a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *sendIndices,</div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span>                                           <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *<a class="code hl_function" href="namespace_s_p_h_1_1_kernel.html#a89b6537f53e3271b87059b7be0d844ee">particles2Send</a>, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *pseudoParticles2Send,</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>                                           <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *pseudoParticlesLevel,</div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span>                                           <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *particlesCount, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *pseudoParticlesCount,</div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span>                                           <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> length, <a class="code hl_enumeration" href="struct_curve.html#a4269858acf8d67e3cd222466771848b9">Curve::Type</a> curveType) {</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span> </div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> bodyIndex = threadIdx.x + blockIdx.x*blockDim.x;</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stride = blockDim.x*gridDim.x;</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> = 0;</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> particleInsertIndex;</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> pseudoParticleInsertIndex;</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>            <span class="keywordflow">while</span> ((bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>) &lt; length) {</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>                <span class="keywordflow">if</span> (sendIndices[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] == 1) {</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>                    <span class="comment">// it is a particle</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>                    <span class="keywordflow">if</span> (bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> &lt; n) {</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>                        particleInsertIndex = atomicAdd(particlesCount, 1);</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>                        <a class="code hl_function" href="namespace_s_p_h_1_1_kernel.html#a89b6537f53e3271b87059b7be0d844ee">particles2Send</a>[particleInsertIndex] = bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>;</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>                    }</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>                    <span class="comment">// it is a pseudo-particle</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>                    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>                        pseudoParticleInsertIndex = atomicAdd(pseudoParticlesCount, 1);</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>                        pseudoParticles2Send[pseudoParticleInsertIndex] = bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>;</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>                        pseudoParticlesLevel[pseudoParticleInsertIndex] = particles-&gt;<a class="code hl_variable" href="class_particles.html#a19adbbf68f6c36892dee44dd76a2b0d3">level</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>];</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>                        <span class="comment">//printf(&quot;pseudo-particle level to be sent: %i (%i)\n&quot;, particles-&gt;level[bodyIndex + offset],</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>                        <span class="comment">//       bodyIndex + offset);</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>                        <span class="comment">//pseudoParticlesLevel[pseudoParticleInsertIndex] = tree-&gt;getTreeLevel(particles,</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>                        <span class="comment">//                                                                     bodyIndex + offset,</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>                        <span class="comment">//                                                                     MAX_LEVEL, curveType);</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>                        <span class="comment">// debug</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>                        <span class="comment">//if (pseudoParticlesLevel[pseudoParticleInsertIndex] == -1) {</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>                        <span class="comment">//    printf(&quot;level = -1 within collectSendIndices for index: %i\n&quot;, bodyIndex + offset);</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>                        <span class="comment">//}</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>                        <span class="comment">// end: debug</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>                    }</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>                }</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>                __threadfence();</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>                <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> += stride;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>            }</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>        }</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel.html#a2e0b258dbccbab147cbb5ec68b434bd3">   53</a></span>        __global__ <span class="keywordtype">void</span> <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#a2e0b258dbccbab147cbb5ec68b434bd3">testSendIndices</a>(<a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles,</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>                                        <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *sendIndices, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *markedSendIndices,</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>                                        <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *levels, <a class="code hl_enumeration" href="struct_curve.html#a4269858acf8d67e3cd222466771848b9">Curve::Type</a> curveType, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> length) {</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> bodyIndex = threadIdx.x + blockIdx.x*blockDim.x;</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stride = blockDim.x*gridDim.x;</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> = 0;</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> key;</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> temp;</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> childIndex;</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> childPath;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span> </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>            <span class="keywordtype">bool</span> available = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> min_x, max_x;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> min_y, max_y;</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> min_z, max_z;</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>            <span class="comment">//while ((bodyIndex + offset) &lt; length) {</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>            <span class="comment">//    printf(&quot;x[%i] = (%f, %f, %f) %f\n&quot;, sendIndices[bodyIndex + offset], particles-&gt;x[sendIndices[bodyIndex + offset]],</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>            <span class="comment">//           particles-&gt;y[sendIndices[bodyIndex + offset]], particles-&gt;z[sendIndices[bodyIndex + offset]],</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>            <span class="comment">//           particles-&gt;mass[sendIndices[bodyIndex + offset]]);</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>            <span class="comment">//    offset += stride;</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>            <span class="comment">//}</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>            <span class="comment">//while ((bodyIndex + offset) &lt; length) {</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>            <span class="comment">//    if (particles-&gt;x[sendIndices[bodyIndex + offset]] == 0.f &amp;&amp;</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>            <span class="comment">//        particles-&gt;y[sendIndices[bodyIndex + offset]] == 0.f &amp;&amp;</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>            <span class="comment">//        particles-&gt;z[sendIndices[bodyIndex + offset]] == 0.f &amp;&amp;</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>            <span class="comment">//        particles-&gt;mass[sendIndices[bodyIndex + offset]]) {</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>            <span class="comment">//</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>            <span class="comment">//    }</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>            <span class="comment">//    offset += stride;</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>            <span class="comment">//}</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span> </div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>            <span class="comment">// ///////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span> </div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>            <span class="comment">//if (bodyIndex == 0) {</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>            <span class="comment">//    for (int i = 0; i&lt;10; i++) {</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>            <span class="comment">//        printf(&quot;sendIndices[%i] = %i (length = %i)\n&quot;, length - 1 + i, sendIndices[length -1 + i], length);</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>            <span class="comment">//    }</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>            <span class="comment">//}</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>            <span class="comment">//if (bodyIndex == 0) {</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>            <span class="comment">//    integer i=0;</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>            <span class="comment">//    for (int i = 0; i&lt;30000; i++) {</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>            <span class="comment">//        if (markedSendIndices[100000 + i] == 1) {</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>            <span class="comment">//            printf(&quot;[rank %i] markedSendIndices[%i] = %i!\n&quot;, subDomainKeyTree-&gt;rank, 100000 + i, markedSendIndices[100000 + i]);</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>            <span class="comment">//            break;</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>            <span class="comment">//        }</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>            <span class="comment">//    }</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>            <span class="comment">//}</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>            <span class="keywordflow">while</span> ((bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>) &lt; length) {</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span> </div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>                <span class="comment">//printf(&quot;index = %i sendIndex = %i level = %i\n&quot;, bodyIndex + offset, sendIndices[bodyIndex + offset],</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>                <span class="comment">//       levels[bodyIndex + offset]);</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> </div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>                min_x = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minX;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>                max_x = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxX;</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>                min_y = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minY;</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>                max_y = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxY;</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>                min_z = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minZ;</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>                max_z = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxZ;</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>                available = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span> </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>                childIndex = 0;</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>                <span class="keywordflow">if</span> (levels[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &gt; 3) {</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>                    <span class="comment">//key = tree-&gt;getParticleKey(particles, bodyIndex + offset + tree-&gt;toDeleteNode[0], MAX_LEVEL,</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>                    <span class="comment">//                           curveType);</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span> </div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>                    <span class="comment">//printf(&quot;level = %i\n&quot;, levels[bodyIndex + offset]);</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span> </div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>                    childIndex = 0;</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span> </div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; levels[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] - 1; j++) {</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span> </div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>                        temp = childIndex;</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span> </div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>                        childPath = 0;</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>                        <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[sendIndices[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>]] &lt; 0.5 * (min_x + max_x)) {</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>                            childPath += 1;</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>                            max_x = 0.5 * (min_x + max_x);</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>                            min_x = 0.5 * (min_x + max_x);</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>                        }</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>                        <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[sendIndices[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>]] &lt; 0.5 * (min_y + max_y)) {</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>                            childPath += 2;</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>                            max_y = 0.5 * (min_y + max_y);</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>                            min_y = 0.5 * (min_y + max_y);</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>                        }</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>                        <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[sendIndices[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>]] &lt; 0.5 * (min_z + max_z)) {</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>                            childPath += 4;</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>                            max_z = 0.5 * (min_z + max_z);</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>                            min_z = 0.5 * (min_z + max_z);</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>                        }</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>                        <span class="comment">//printf(&quot;childIndex = %i\n&quot;, childIndex);</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>                        childIndex = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a> * temp + childPath];</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>                        <span class="keywordflow">if</span> (bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> == 0) {</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>                            printf(<span class="stringliteral">&quot;tree-&gt;child[POW_DIM * %i + %i] = %i (%i)\n&quot;</span>, temp, childPath, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a> * temp + childPath], sendIndices[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>]);</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>                        }</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>                    }</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span> </div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; length; i++) {</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>                        <span class="keywordflow">if</span> (temp == sendIndices[i]) {</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>                            available = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>                            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>                        }</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>                    }</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>                    <span class="keywordflow">if</span> (!available) {</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>                        <span class="comment">//integer a = -1;</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>                        <span class="comment">//markedSendIndices[childIndex] = a;</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>                        <a class="code hl_define" href="cuda__utilities_8cuh.html#a0269abaf8e197ef5b7f85bd16c19bbf8">cudaTerminate</a>(<span class="stringliteral">&quot;[rank %i] %i (relevant son: %i) NOT Available sendIndices[%i] = %i, [%i] = %i)!\n&quot;</span>,</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>                                      subDomainKeyTree-&gt;<a class="code hl_variable" href="class_sub_domain_key_tree.html#ad364fe0bf3c4c29e3e7c403e1fef200b">rank</a>, temp, childIndex, childIndex,</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>                                      markedSendIndices[childIndex], temp, markedSendIndices[temp])</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>                    }</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span> </div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>                    <span class="comment">//if (childIndex != sendIndices[bodyIndex + offset]) {</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>                        <span class="comment">//printf(&quot;ATTENTION childIndex != bodyIndex level = %i (%i != %i) (%f, %f, %f)!\n&quot;, levels[bodyIndex + offset], childIndex, sendIndices[bodyIndex + offset],</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>                        <span class="comment">//       particles-&gt;x[sendIndices[bodyIndex + offset]], particles-&gt;y[sendIndices[bodyIndex + offset]],</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>                        <span class="comment">//       particles-&gt;z[sendIndices[bodyIndex + offset]]);</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>                    <span class="comment">//} else {</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>                        <span class="comment">//printf(&quot;--\n&quot;);</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>                    <span class="comment">//}</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>                }</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>                <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> += stride;</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>            }</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        }</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span> </div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel.html#aed59991b3f4e4a8893656f2c1bce363a">  202</a></span>        __global__ <span class="keywordtype">void</span> <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#aed59991b3f4e4a8893656f2c1bce363a">computeForces_v1</a>(<a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> radius, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m,</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>                                         <a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> smoothing,</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>                                         <span class="keywordtype">bool</span> potentialEnergy) {</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span> </div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>            <span class="keyword">register</span> <span class="keywordtype">int</span> i, ii;</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>            <span class="keywordtype">int</span> child, nodeIndex, childNumber, depth;</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> px, ax, dx, f, distance;</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> py, ay, dy;</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> pz, az, dz;</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> sml;</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> thetasq = theta*theta;</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span> </div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>            <span class="keywordtype">int</span> currentNodeIndex[<a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>];</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>            <span class="keywordtype">int</span> currentChildNumber[<a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>];</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span> </div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>            __shared__ <span class="keyword">volatile</span> <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> cellSize[<a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>];</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span> </div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>            <span class="keywordflow">if</span> (threadIdx.x == 0) {</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>                cellSize[0] = 4.0 * radius * radius; <span class="comment">//4.0 * radius * radius;</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span><span class="preprocessor">#pragma unroll</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>                <span class="keywordflow">for</span> (i = 1; i &lt; <a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>; i++) {</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>                    cellSize[i] = cellSize[i - 1] * 0.25;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>                }</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>            }</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span> </div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>            __syncthreads();</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span> </div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>            <span class="keywordflow">for</span> (ii = threadIdx.x + blockIdx.x * blockDim.x; ii &lt; n; ii += blockDim.x * gridDim.x) {</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span> </div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>                i = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;sorted[ii]; <span class="comment">//i = ii;</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span> </div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>                px = particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[i];</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>                py = particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[i];</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>                pz = particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[i];</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>                <span class="comment">//particles-&gt;ax[i] = 0.0;</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#aa0081a57dbe2053fae1d331641d8bacd">g_ax</a>[i] = 0.0;</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>                <span class="comment">//particles-&gt;ay[i] = 0.0;</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#a1fb75739bd93384823a2f8e958f59cbf">g_ay</a>[i] = 0.0;</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>                <span class="comment">//particles-&gt;az[i] = 0.0;</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#ae00fcd5b4197a57b0a1112a7be4e8de0">g_az</a>[i] = 0.0;</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>                ax = 0.0;</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>                ay = 0.0;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>                az = 0.0;</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span> </div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>                <span class="comment">// start at root</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>                depth = 1;</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>                currentNodeIndex[depth] = 0;</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>                currentChildNumber[depth] = 0;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span> </div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>                <span class="keywordflow">do</span> {</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>                    childNumber = currentChildNumber[depth];</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                    nodeIndex = currentNodeIndex[depth];</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span> </div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>                    <span class="keywordflow">while</span>(childNumber &lt; <a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>) {</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>                        <span class="keywordflow">do</span> {</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>                            child = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a> * nodeIndex + childNumber];</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>                            childNumber++;</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>                        } <span class="keywordflow">while</span>(child == -1 &amp;&amp; childNumber &lt; <a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>);</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span> </div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>                        <span class="keywordflow">if</span> (child != -1 &amp;&amp; child != i) { <span class="comment">// dont do self-gravity with yourself!</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>                            dx = particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[child] - px;</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>                            distance = dx*dx + smoothing;</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>                            dy = particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[child] - py;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>                            distance += dy*dy;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>                            dz = particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[child] - pz;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>                            distance += dz*dz;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>                            <span class="comment">// if child is leaf or far away</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>                            <span class="keywordflow">if</span> (child &lt; n || distance * thetasq &gt; cellSize[depth]) {</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>                                distance = <a class="code hl_function" href="namespacecuda_1_1math.html#a706200a3f1b2445d7fd835c2ac504a11">cuda::math::sqrt</a>(distance);</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span><span class="preprocessor">#if SI_UNITS</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>                                f = <a class="code hl_variable" href="namespace_constants.html#ad17e79c3a9b2da663530274844d9f780">Constants::G</a> * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[child] / (distance * distance * distance);</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>                                f = particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[child] / (distance * distance * distance);</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span> </div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>                                ax += f*dx;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>                                ay += f*dy;</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>                                az += f*dz;</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>                                <span class="comment">// gravitational potential energy</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>                                <span class="keywordflow">if</span> (potentialEnergy) {</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span><span class="preprocessor">#if SI_UNITS</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>                                    particles-&gt;<a class="code hl_variable" href="class_particles.html#a9e1b9e80538c2b745216b67ae79fc66a">u</a>[i] -= 0.5 * (<a class="code hl_variable" href="namespace_constants.html#ad17e79c3a9b2da663530274844d9f780">Constants::G</a> * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[child] * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[i]) / distance;</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>                                    particles-&gt;<a class="code hl_variable" href="class_particles.html#a9e1b9e80538c2b745216b67ae79fc66a">u</a>[i] -= 0.5 * (particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[child] * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[i]) / distance;</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>                                }</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>                                <span class="comment">// put child on stack</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>                                currentChildNumber[depth] = childNumber;</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>                                currentNodeIndex[depth] = nodeIndex;</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>                                depth++;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>                                <span class="keywordflow">if</span> (depth == <a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>) {</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>                                    <a class="code hl_define" href="cuda__utilities_8cuh.html#a0269abaf8e197ef5b7f85bd16c19bbf8">cudaTerminate</a>(<span class="stringliteral">&quot;depth = %i &gt;= MAX_DEPTH = %i\n&quot;</span>, depth, <a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>);</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>                                }</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>                                childNumber = 0;</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>                                nodeIndex = child;</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>                            }</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>                        }</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>                    }</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>                    depth--;</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>                } <span class="keywordflow">while</span>(depth &gt; 0);</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>                <span class="comment">//particles-&gt;ax[i] = ax;</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#aa0081a57dbe2053fae1d331641d8bacd">g_ax</a>[i] = ax;</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>                <span class="comment">//particles-&gt;ay[i] = ay;</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#a1fb75739bd93384823a2f8e958f59cbf">g_ay</a>[i] = ay;</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>                <span class="comment">//particles-&gt;az[i] = az;</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#ae00fcd5b4197a57b0a1112a7be4e8de0">g_az</a>[i] = az;</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>            }</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>        }</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel.html#a717dff3559e55e15c1f94e10eae1d16e">  342</a></span>        __global__ <span class="keywordtype">void</span> <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#a717dff3559e55e15c1f94e10eae1d16e">computeForces_v1_1</a>(<a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> radius, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m,</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>                                           <a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> smoothing,</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>                                           <span class="keywordtype">bool</span> potentialEnergy) {</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> i, ii, child, nodeIndex, childNumber, depth;</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span> </div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> px, ax, dx, f, distance;</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> py, ay, dy;</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> pz, az, dz;</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> sml;</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> thetasq = theta*theta;</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> currentNodeIndex[<a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>];</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> currentChildNumber[<a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>];</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span> </div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>            __shared__ <span class="keyword">volatile</span> <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> cellSize[<a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>];</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>            <span class="keywordflow">if</span> (threadIdx.x == 0) {</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>                cellSize[0] = 4.0 * radius * radius;</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span><span class="preprocessor">#pragma unroll</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>                <span class="keywordflow">for</span> (i = 1; i &lt; <a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>; i++) {</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>                    cellSize[i] = cellSize[i - 1] * 0.25;</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>                }</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>            }</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span> </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>            __syncthreads();</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>            <span class="keywordflow">for</span> (i = threadIdx.x + blockIdx.x * blockDim.x; i &lt; n; i += blockDim.x * gridDim.x) {</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span> </div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>                px = particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[i];</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>                py = particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[i];</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>                pz = particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[i];</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>                <span class="comment">//particles-&gt;ax[i] = 0.0;</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#aa0081a57dbe2053fae1d331641d8bacd">g_ax</a>[i] = 0.0;</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>                <span class="comment">//particles-&gt;ay[i] = 0.0;</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#a1fb75739bd93384823a2f8e958f59cbf">g_ay</a>[i] = 0.0;</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>                <span class="comment">//particles-&gt;az[i] = 0.0;</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#ae00fcd5b4197a57b0a1112a7be4e8de0">g_az</a>[i] = 0.0;</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>                ax = 0.0;</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>                ay = 0.0;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>                az = 0.0;</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span> </div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>                <span class="comment">// start at root</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>                depth = 1;</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>                currentNodeIndex[depth] = 0;</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>                currentChildNumber[depth] = 0;</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span> </div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>                <span class="keywordflow">do</span> {</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>                    childNumber = currentChildNumber[depth];</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>                    nodeIndex = currentNodeIndex[depth];</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span> </div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>                    <span class="keywordflow">while</span>(childNumber &lt; <a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>) {</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>                        <span class="keywordflow">do</span> {</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>                            child = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a> * nodeIndex + childNumber]; <span class="comment">//childList[childListIndex(nodeIndex, childNumber)];</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>                            childNumber++;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>                        } <span class="keywordflow">while</span>(child == -1 &amp;&amp; childNumber &lt; <a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>);</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>                        <span class="keywordflow">if</span> (child != -1 &amp;&amp; child != i) { <span class="comment">// dont do self-gravity with yourself!</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>                            dx = particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[child] - px;</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>                            distance = dx*dx + smoothing; <span class="comment">//150329404.287723; //(0.0317 * 0.0317); //0.025;</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>                            dy = particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[child] - py;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>                            distance += dy*dy;</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>                            dz = particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[child] - pz;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>                            distance += dz*dz;</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>                            <span class="comment">// if child is leaf or far away</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>                            <span class="keywordflow">if</span> (child &lt; n || distance * thetasq &gt; cellSize[depth]) {</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>                                distance = <a class="code hl_function" href="namespacecuda_1_1math.html#a706200a3f1b2445d7fd835c2ac504a11">sqrt</a>(distance);</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span><span class="preprocessor">#if SI_UNITS</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>                                f = <a class="code hl_variable" href="namespace_constants.html#ad17e79c3a9b2da663530274844d9f780">Constants::G</a> * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[child] / (distance * distance * distance);</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>                                f = particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[child] / (distance * distance * distance);</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span> </div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>                                ax += f*dx;</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>                                ay += f*dy;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>                                az += f*dz;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>                                <span class="comment">// gravitational potential energy</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>                                <span class="keywordflow">if</span> (potentialEnergy) {</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span><span class="preprocessor">#if SI_UNITS</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>                                    particles-&gt;<a class="code hl_variable" href="class_particles.html#a9e1b9e80538c2b745216b67ae79fc66a">u</a>[i] -= 0.5 * (<a class="code hl_variable" href="namespace_constants.html#ad17e79c3a9b2da663530274844d9f780">Constants::G</a> * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[child] * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[i])/distance;</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>                                    particles-&gt;<a class="code hl_variable" href="class_particles.html#a9e1b9e80538c2b745216b67ae79fc66a">u</a>[i] -= 0.5 * (particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[child] * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[i])/distance;</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>                                }</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>                                <span class="comment">// put child on stack</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>                                currentChildNumber[depth] = childNumber;</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>                                currentNodeIndex[depth] = nodeIndex;</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>                                depth++;</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>                                <span class="keywordflow">if</span> (depth == <a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>) {</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>                                    <a class="code hl_define" href="cuda__utilities_8cuh.html#a0269abaf8e197ef5b7f85bd16c19bbf8">cudaTerminate</a>(<span class="stringliteral">&quot;depth = %i &gt;= MAX_DEPTH = %i\n&quot;</span>, depth, <a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>);</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>                                }</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>                                childNumber = 0;</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>                                nodeIndex = child;</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>                            }</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>                        }</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>                    }</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>                    depth--;</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>                } <span class="keywordflow">while</span>(depth &gt; 0);</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span> </div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>                <span class="comment">//particles-&gt;ax[i] = ax;</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#aa0081a57dbe2053fae1d331641d8bacd">g_ax</a>[i] = ax;</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>                <span class="comment">//particles-&gt;ay[i] = ay;</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#a1fb75739bd93384823a2f8e958f59cbf">g_ay</a>[i] = ay;</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>                <span class="comment">//particles-&gt;az[i] = az;</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#ae00fcd5b4197a57b0a1112a7be4e8de0">g_az</a>[i] = az;</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>            }</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>        }</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span> </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel.html#aab6c8bfe6472b2584544b0af06dfd150">  479</a></span>        __global__ <span class="keywordtype">void</span> <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#aab6c8bfe6472b2584544b0af06dfd150">computeForces_v1_2</a>(<a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> radius, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m,</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>                                           <a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> smoothing,</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>                                           <span class="keywordtype">bool</span> potentialEnergy) {</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>            <span class="keyword">register</span> <span class="keywordtype">int</span> i, ii;</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>            <span class="keywordtype">int</span> child, nodeIndex, childNumber, depth;</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span> </div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> px, ax, dx, f, distance;</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> py, ay, dy;</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> pz, az, dz;</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> sml;</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> thetasq = theta*theta;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span> </div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>            __shared__ <span class="keywordtype">int</span> currentNodeIndex[<a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>];</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>            __shared__ <span class="keywordtype">int</span> currentChildNumber[<a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>];</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span> </div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>            __shared__ <span class="keyword">volatile</span> <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> cellSize[<a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>];</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span> </div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>            <span class="keywordflow">if</span> (threadIdx.x == 0) {</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>                cellSize[0] = 4.0 * radius * radius;</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span><span class="preprocessor">                #pragma unroll</span></div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>                <span class="keywordflow">for</span> (i = 1; i &lt; <a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>; i++) {</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>                    cellSize[i] = cellSize[i - 1] * 0.25;</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>                }</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>            }</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span> </div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>            __syncthreads();</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>            <span class="keywordflow">for</span> (ii = threadIdx.x + blockIdx.x * blockDim.x; ii &lt; n; ii += blockDim.x * gridDim.x) {</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span> </div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>                i = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;sorted[ii]; <span class="comment">//i = ii;</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span> </div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>                px = particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[i];</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>                py = particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[i];</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>                pz = particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[i];</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>                <span class="comment">//particles-&gt;ax[i] = 0.0;</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#aa0081a57dbe2053fae1d331641d8bacd">g_ax</a>[i] = 0.0;</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>                <span class="comment">//particles-&gt;ay[i] = 0.0;</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#a1fb75739bd93384823a2f8e958f59cbf">g_ay</a>[i] = 0.0;</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>                <span class="comment">//particles-&gt;az[i] = 0.0;</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#ae00fcd5b4197a57b0a1112a7be4e8de0">g_az</a>[i] = 0.0;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>                ax = 0.0;</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>                ay = 0.0;</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>                az = 0.0;</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span> </div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>                <span class="comment">// start at root</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>                depth = 1;</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>                currentNodeIndex[depth] = 0;</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>                currentChildNumber[depth] = 0;</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span> </div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>                <span class="keywordflow">do</span> {</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>                    childNumber = currentChildNumber[depth];</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>                    nodeIndex = currentNodeIndex[depth];</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span> </div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>                    <span class="keywordflow">while</span>(childNumber &lt; <a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>) {</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>                        <span class="keywordflow">do</span> {</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>                            child = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a> * nodeIndex + childNumber];</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>                            childNumber++;</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>                        } <span class="keywordflow">while</span>(child == -1 &amp;&amp; childNumber &lt; <a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>);</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>                        <span class="keywordflow">if</span> (child != -1 &amp;&amp; child != i) { <span class="comment">// dont do self-gravity with yourself!</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>                            dx = particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[child] - px;</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>                            distance = dx*dx + smoothing; <span class="comment">//150329404.287723; //(0.0317 * 0.0317); //0.025;</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>                            dy = particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[child] - py;</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>                            distance += dy*dy;</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>                            dz = particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[child] - pz;</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>                            distance += dz*dz;</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>                            <span class="comment">// if child is leaf or far away</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>                            <span class="keywordflow">if</span> (child &lt; n || distance * thetasq &gt; cellSize[depth]) {</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>                                distance = <a class="code hl_function" href="namespacecuda_1_1math.html#a706200a3f1b2445d7fd835c2ac504a11">cuda::math::sqrt</a>(distance);</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span><span class="preprocessor">#if SI_UNITS</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>                                f = <a class="code hl_variable" href="namespace_constants.html#ad17e79c3a9b2da663530274844d9f780">Constants::G</a> * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[child] / (distance * distance * distance);</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>                                f = particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[child] / (distance * distance * distance);</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span> </div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>                                ax += f*dx;</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>                                ay += f*dy;</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>                                az += f*dz;</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>                                <span class="comment">// gravitational potential energy</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>                                <span class="keywordflow">if</span> (potentialEnergy) {</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span><span class="preprocessor">#if SI_UNITS</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>                                    particles-&gt;<a class="code hl_variable" href="class_particles.html#a9e1b9e80538c2b745216b67ae79fc66a">u</a>[i] -= 0.5 * (<a class="code hl_variable" href="namespace_constants.html#ad17e79c3a9b2da663530274844d9f780">Constants::G</a> * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[child] * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[i])/distance;</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>                                    particles-&gt;<a class="code hl_variable" href="class_particles.html#a9e1b9e80538c2b745216b67ae79fc66a">u</a>[i] -= 0.5 * (particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[child] * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[i])/distance;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>                                }</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>                                <span class="comment">// put child on stack</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>                                currentChildNumber[depth] = childNumber;</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>                                currentNodeIndex[depth] = nodeIndex;</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>                                depth++;</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>                                <span class="keywordflow">if</span> (depth == <a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>) {</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>                                    <a class="code hl_define" href="cuda__utilities_8cuh.html#a0269abaf8e197ef5b7f85bd16c19bbf8">cudaTerminate</a>(<span class="stringliteral">&quot;depth = %i &gt;= MAX_DEPTH = %i\n&quot;</span>, depth, <a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>);</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>                                }</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>                                childNumber = 0;</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>                                nodeIndex = child;</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>                            }</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>                        }</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>                    }</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>                    depth--;</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>                } <span class="keywordflow">while</span>(depth &gt; 0);</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span> </div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>                <span class="comment">//particles-&gt;ax[i] = ax;</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#aa0081a57dbe2053fae1d331641d8bacd">g_ax</a>[i] = ax;</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>                <span class="comment">//particles-&gt;ay[i] = ay;</span></div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#a1fb75739bd93384823a2f8e958f59cbf">g_ay</a>[i] = ay;</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>                <span class="comment">//particles-&gt;az[i] = az;</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#ae00fcd5b4197a57b0a1112a7be4e8de0">g_az</a>[i] = az;</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>            }</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        }</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span> </div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>        <span class="comment">// see: https://iss.oden.utexas.edu/Publications/Papers/burtscher11.pdf</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>        <span class="comment">/*__global__ void test() {</span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span><span class="comment">            // precompute and cache info</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span><span class="comment">            // determine first thread in each warp</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span><span class="comment">            for (//sorted body indexes assigned to me) {</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span><span class="comment">                // cache body data</span></div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span><span class="comment">                // initialize iteration stack</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span><span class="comment">                depth = 0;</span></div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span><span class="comment">                while (depth &gt;= 0) {</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span><span class="comment">                    while (//there are more nodes to visit) {</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span><span class="comment">                        if (//Iâm the first thread in the warp) {</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span><span class="comment">                            // move on to next node</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span><span class="comment">                            // read node data and put in shared memory</span></div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span><span class="comment">                        }</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span><span class="comment">                        threadfence block();</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span><span class="comment">                        if (//node is not null) {</span></div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span><span class="comment">                            // get node data from shared memory</span></div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span><span class="comment">                            // compute distance to node</span></div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span><span class="comment">                            if ((//node is a body) || all(//distance &gt;= cutoff)) {</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span><span class="comment">                                // compute interaction force contribution</span></div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span><span class="comment">                            } else {</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span><span class="comment">                                depth++; // descend to next tree level</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span><span class="comment">                                if (//Iâm the first thread in the warp) {</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span><span class="comment">                                    // push nodeâs children onto iteration stack</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span><span class="comment">                                }</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span><span class="comment">                                threadfence block();</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span><span class="comment">                            }</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span><span class="comment">                        } else {</span></div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span><span class="comment">                            depth = max(0, depth-1); // early out because remaining nodes are also null</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span><span class="comment">                        }</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span><span class="comment">                    }</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span><span class="comment">                    depthââ;</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span><span class="comment">                }</span></div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span><span class="comment">            // update body data</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span><span class="comment">            }</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span><span class="comment">        }*/</span></div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span> </div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel.html#a700b862d81747a6140b7af269c3cee16">  655</a></span>        __global__ <span class="keywordtype">void</span> <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#a700b862d81747a6140b7af269c3cee16">computeForces_v2</a>(<a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> radius, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m,</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>                                         <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> blockSize, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> warp, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stackSize,</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>                                         <a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta,</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>                                         <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> smoothing, <span class="keywordtype">bool</span> potentialEnergy) {</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span> </div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> bodyIndex = threadIdx.x + blockIdx.x*blockDim.x;</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stride = blockDim.x*gridDim.x;</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> = 0;</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span> </div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>            <span class="keyword">register</span> <span class="keywordtype">int</span> sortedIndex;</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span> </div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>            <span class="comment">//__shared__ real depth[stackSize * blockSize/warp];</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>            <span class="comment">//__shared__ integer stack[stackSize * blockSize/warp];</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>            <span class="keyword">extern</span> __shared__ <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> buffer[];</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span> </div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>* depth = (<a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>*)buffer;</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a>* stack = (<a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a>*)&amp;depth[stackSize * blockSize/warp];</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span> </div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> pos_x;</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> pos_y;</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> pos_z;</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span> </div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> acc_x;</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> acc_y;</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> acc_z;</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span> </div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>            <span class="comment">// in case that one of the first children are a leaf</span></div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>            <span class="keywordtype">int</span> jj = -1;</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span><span class="preprocessor">            #pragma unroll</span></div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>            <span class="keywordflow">for</span> (<a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> i=0; i&lt;<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>; i++) {</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[i] != -1) {</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>                    jj++;</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>                }</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>            }</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span> </div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>            <span class="keywordtype">int</span> counter = threadIdx.x % warp;</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>            <span class="keywordtype">int</span> stackStartIndex = stackSize*(threadIdx.x / warp);</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span> </div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>            <span class="keywordflow">while</span> ((bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>) &lt; n) {</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span> </div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>                <span class="comment">//sortedIndex = bodyIndex + offset;</span></div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>                sortedIndex = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;sorted[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>];</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span> </div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>                pos_x = particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[sortedIndex];</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>                pos_y = particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[sortedIndex];</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>                pos_z = particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[sortedIndex];</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span> </div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>                acc_x = 0.0;</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>                acc_y = 0.0;</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>                acc_z = 0.0;</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span> </div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>                <span class="comment">// initialize stack</span></div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>                <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> top = jj + stackStartIndex;</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span> </div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>                <span class="keywordflow">if</span> (counter == 0) {</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span> </div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>                    <span class="keywordtype">int</span> temp = 0;</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span> </div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span><span class="preprocessor">                    #pragma unroll</span></div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>; i++) {</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>                        <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[i] != -1) {</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>                            stack[stackStartIndex + temp] = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[i];</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>                            depth[stackStartIndex + temp] = radius*radius/theta;</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>                            temp++;</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>                        }</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>                    }</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>                }</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>                __syncthreads();</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span> </div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>                <span class="comment">// while stack is not empty / more nodes to visit</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>                <span class="keywordflow">while</span> (top &gt;= stackStartIndex) {</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span> </div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>                    <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> node = stack[top];</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span> </div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>                    <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> dp = 0.25 * depth[top]; <span class="comment">//powf(0.5, DIM) * depth[top]; //0.25*depth[top]; // float dp = depth[top];</span></div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span> </div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>                    <span class="keywordflow">for</span> (<a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> i=0; i&lt;<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>; i++) {</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span> </div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>                        <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> ch = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>*node + i];</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span> </div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>                        <span class="comment">//__threadfence();</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span> </div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>                        <span class="keywordflow">if</span> (ch &gt;= 0) {</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span> </div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>                            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> dx = particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[ch] - pos_x;</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>                            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> dy = particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[ch] - pos_y;</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>                            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> dz = particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[ch] - pos_z;</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span> </div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>                            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> r = dx*dx + smoothing; <span class="comment">// SMOOTHING</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>                            r += dy*dy;</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>                            r += dz*dz;</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span> </div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>                            <span class="comment">//if (ch &lt; n /*is leaf node*/ || !__any_sync(activeMask, dp &gt; r)) {</span></div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>                            <span class="keywordflow">if</span> (ch &lt; m <span class="comment">/*is leaf node*/</span> || __all_sync(__activemask(), dp &lt;= r)) {</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span> </div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>                                <span class="comment">// calculate interaction force contribution</span></div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>                                <span class="keywordflow">if</span> (r &gt; 0.f) { <span class="comment">//NEW //TODO: how to avoid r = 0?</span></div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>                                    r = <a class="code hl_function" href="namespacecuda_1_1math.html#a19175dcfac61c20c0914751a44bee73a">cuda::math::rsqrt</a>(r);</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>                                }</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span> </div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span><span class="preprocessor">#if SI_UNITS</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>                                <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> f = <a class="code hl_variable" href="namespace_constants.html#ad17e79c3a9b2da663530274844d9f780">Constants::G</a> * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[ch] * r * r * r;</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>                                <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> f = particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[ch] * r * r * r;</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span> </div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>                                acc_x += f*dx;</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>                                acc_y += f*dy;</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>                                acc_z += f*dz;</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>                                <span class="keywordflow">if</span> (potentialEnergy) {</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span><span class="preprocessor">#if SI_UNITS</span></div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>                                    particles-&gt;<a class="code hl_variable" href="class_particles.html#a9e1b9e80538c2b745216b67ae79fc66a">u</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] -= 0.5 * (<a class="code hl_variable" href="namespace_constants.html#ad17e79c3a9b2da663530274844d9f780">Constants::G</a> * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[ch] *</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>                                        particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>])/<a class="code hl_function" href="namespacecuda_1_1math.html#a706200a3f1b2445d7fd835c2ac504a11">cuda::math::sqrt</a>(r);</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>                                    particles-&gt;<a class="code hl_variable" href="class_particles.html#a9e1b9e80538c2b745216b67ae79fc66a">u</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] -= 0.5 * (particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[ch] *</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>                                            particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>])/<a class="code hl_function" href="namespacecuda_1_1math.html#a706200a3f1b2445d7fd835c2ac504a11">cuda::math::sqrt</a>(r);</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>                                }</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>                            }</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>                            <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>                                <span class="comment">// if first thread in warp: push node&#39;s children onto iteration stack</span></div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>                                <span class="keywordflow">if</span> (counter == 0) {</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>                                    stack[top] = ch;</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>                                    depth[top] = dp; <span class="comment">// depth[top] = 0.25*dp;</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>                                }</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>                                top++; <span class="comment">// descend to next tree level</span></div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>                                __threadfence_block();</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>                            }</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>                        }</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>                        <span class="comment">// this is not working</span></div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>                        <span class="comment">//else {</span></div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>                        <span class="comment">//    top = cuda::math::max(stackStartIndex, top-1);</span></div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>                        <span class="comment">//}</span></div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>                    }</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>                    top--;</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>                }</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>                <span class="comment">// update body data</span></div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#aa0081a57dbe2053fae1d331641d8bacd">g_ax</a>[sortedIndex] = acc_x;</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#a1fb75739bd93384823a2f8e958f59cbf">g_ay</a>[sortedIndex] = acc_y;</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#ae00fcd5b4197a57b0a1112a7be4e8de0">g_az</a>[sortedIndex] = acc_z;</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>                <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> += stride;</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>                __syncthreads();</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>            }</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span> </div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>        }</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span> </div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel.html#afe9543ee9b2e06c705b1a087b3f6b94a">  834</a></span>        __global__ <span class="keywordtype">void</span> <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#afe9543ee9b2e06c705b1a087b3f6b94a">computeForces_v2_1</a>(<a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> blockSize,</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>                                           <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> warp, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stackSize, <a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree,</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>                                           <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> smoothing, <span class="keywordtype">bool</span> potentialEnergy) {</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span> </div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> bodyIndex = threadIdx.x + blockIdx.x*blockDim.x;</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stride = blockDim.x*gridDim.x;</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> = 0;</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span> </div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>            <span class="comment">//__shared__ real depth[stackSize * blockSize/warp];</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>            <span class="comment">//__shared__ integer stack[stackSize * blockSize/warp];</span></div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>            <span class="keyword">extern</span> __shared__ <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> buffer[];</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span> </div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>* depth = (<a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>*)buffer;</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a>* stack = (<a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a>*)&amp;depth[stackSize * blockSize/warp];</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span> </div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> x_radius = 0.5*(*<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxX - (*<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minX));</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> y_radius = 0.5*(*<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxY - (*<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minY));</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> z_radius = 0.5*(*<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxZ - (*<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minZ));</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span> </div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span><span class="preprocessor">#if DIM == 1</span></div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> radius = x_radius;</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span><span class="preprocessor">#elif DIM == 2</span></div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> radius = <a class="code hl_function" href="namespacecuda_1_1math.html#ae45b7a0e96687aa98c58a3ee386b2ada">cuda::math::max</a>(x_radius, y_radius);</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> radius_max = <a class="code hl_function" href="namespacecuda_1_1math.html#ae45b7a0e96687aa98c58a3ee386b2ada">cuda::math::max</a>(x_radius, y_radius);</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> radius = <a class="code hl_function" href="namespacecuda_1_1math.html#ae45b7a0e96687aa98c58a3ee386b2ada">cuda::math::max</a>(radius_max, z_radius);</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span> </div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>            <span class="comment">// in case that one of the first children are a leaf</span></div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> jj = -1;</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>            <span class="keywordflow">for</span> (<a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> i=0; i&lt;<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>; i++) {</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[i] != -1) {</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>                    jj++;</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>                }</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>            }</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span> </div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> counter = threadIdx.x % warp;</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stackStartIndex = stackSize*(threadIdx.x / warp);</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span> </div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>            <span class="keywordflow">while</span> ((bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>) &lt; n) {</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span> </div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>                <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> pos_x = particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>];</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>                <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> pos_y = particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>];</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>                <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> pos_z = particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>];</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span> </div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>                <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> acc_x = 0.0;</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>                <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> acc_y = 0.0;</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>                <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> acc_z = 0.0;</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span> </div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>                <span class="comment">// initialize stack</span></div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>                <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> top = jj + stackStartIndex;</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span> </div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>                <span class="keywordflow">if</span> (counter == 0) {</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span> </div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>                    <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> temp = 0;</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span> </div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>; i++) {</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>                        <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[i] != -1) {</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>                            stack[stackStartIndex + temp] = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[i];</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>                            depth[stackStartIndex + temp] = radius*radius/theta;</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>                            temp++;</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>                        }</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>                    }</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>                }</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>                __syncthreads();</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span> </div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>                <span class="comment">// while stack is not empty / more nodes to visit</span></div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>                <span class="keywordflow">while</span> (top &gt;= stackStartIndex) {</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span> </div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>                    <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> node = stack[top];</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span> </div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>                    <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> dp = 0.5 * depth[top]; <span class="comment">//powf(0.5, DIM) * depth[top]; //0.25*depth[top]; // float dp = depth[top];</span></div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span> </div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>                    <span class="keywordflow">for</span> (<a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> i=0; i&lt;<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>; i++) {</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span> </div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>                        <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> ch = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>*node + i];</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span> </div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>                        <span class="comment">//__threadfence();</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span> </div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>                        <span class="keywordflow">if</span> (ch &gt;= 0) {</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span> </div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>                            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> dx = particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[ch] - pos_x;</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>                            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> dy = particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[ch] - pos_y;</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>                            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> dz = particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[ch] - pos_z;</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span> </div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>                            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> r = dx*dx + smoothing; <span class="comment">// SMOOTHING</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>                            r += dy*dy;</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>                            r += dz*dz;</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span> </div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>                            <span class="comment">//if (ch &lt; n /*is leaf node*/ || !__any_sync(activeMask, dp &gt; r)) {</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>                            <span class="keywordflow">if</span> (ch &lt; m <span class="comment">/*is leaf node*/</span> || __all_sync(__activemask(), dp &lt;= r)) {</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span> </div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>                                <span class="comment">// calculate interaction force contribution</span></div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>                                <span class="keywordflow">if</span> (r &gt; 0.f) { <span class="comment">//NEW //TODO: how to avoid r = 0?</span></div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>                                    r = <a class="code hl_function" href="namespacecuda_1_1math.html#a19175dcfac61c20c0914751a44bee73a">cuda::math::rsqrt</a>(r);</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>                                }</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span> </div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span><span class="preprocessor">#if SI_UNITS</span></div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>                                <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> f = <a class="code hl_variable" href="namespace_constants.html#ad17e79c3a9b2da663530274844d9f780">Constants::G</a> * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[ch] * r * r * r;</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>                                <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> f = particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[ch] * r * r * r;</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span> </div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>                                acc_x += f*dx;</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>                                acc_y += f*dy;</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>                                acc_z += f*dz;</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>                                <span class="keywordflow">if</span> (potentialEnergy) {</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span><span class="preprocessor">#if SI_UNITS</span></div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>                                    particles-&gt;<a class="code hl_variable" href="class_particles.html#a9e1b9e80538c2b745216b67ae79fc66a">u</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] -= 0.5 * (<a class="code hl_variable" href="namespace_constants.html#ad17e79c3a9b2da663530274844d9f780">Constants::G</a> * particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[ch] *</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>                                            particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>])/<a class="code hl_function" href="namespacecuda_1_1math.html#a706200a3f1b2445d7fd835c2ac504a11">cuda::math::sqrt</a>(r);</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>                                    particles-&gt;<a class="code hl_variable" href="class_particles.html#a9e1b9e80538c2b745216b67ae79fc66a">u</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] -= 0.5 * (particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[ch] *</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>                                            particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>])/<a class="code hl_function" href="namespacecuda_1_1math.html#a706200a3f1b2445d7fd835c2ac504a11">cuda::math::sqrt</a>(r);</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>                                }</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>                            }</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>                            <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>                                <span class="comment">// if first thread in warp: push node&#39;s children onto iteration stack</span></div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>                                <span class="keywordflow">if</span> (counter == 0) {</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>                                    stack[top] = ch;</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>                                    depth[top] = dp; <span class="comment">// depth[top] = 0.25*dp;</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>                                }</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>                                top++; <span class="comment">// descend to next tree level</span></div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>                                <span class="comment">//__threadfence();</span></div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>                            }</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>                        }</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>                        <span class="comment">//else {</span></div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>                        <span class="comment">//    top = max(stackStartIndex, top-1);</span></div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>                        <span class="comment">//}</span></div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>                    }</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>                    top--;</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>                }</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>                <span class="comment">// update body data</span></div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#aa0081a57dbe2053fae1d331641d8bacd">g_ax</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] = acc_x;</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#a1fb75739bd93384823a2f8e958f59cbf">g_ay</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] = acc_y;</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>                particles-&gt;<a class="code hl_variable" href="class_particles.html#ae00fcd5b4197a57b0a1112a7be4e8de0">g_az</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] = acc_z;</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>                <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> += stride;</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span> </div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>                __syncthreads();</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>            }</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span> </div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>        }</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span> </div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel.html#a962bb4ab459204c7236171ae3523e871"> 1005</a></span>        __global__ <span class="keywordtype">void</span> <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#a962bb4ab459204c7236171ae3523e871">intermediateSymbolicForce</a>(<a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles,</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>                                                  <a class="code hl_class" href="class_domain_list.html">DomainList</a> *domainList, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *sendIndices, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> diam, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta_,</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>                                                  <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> relevantIndex, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> level,</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>                                                  <a class="code hl_enumeration" href="struct_curve.html#a4269858acf8d67e3cd222466771848b9">Curve::Type</a> curveType) {</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span> </div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> bodyIndex = threadIdx.x + blockIdx.x * blockDim.x;</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stride = blockDim.x * gridDim.x;</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> = 0;</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span> </div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>            <span class="keywordflow">while</span> ((bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>) &lt; *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;index) {</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>                <span class="keywordflow">if</span> (sendIndices[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] == 2) {</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>                    sendIndices[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] = 0;</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>                }</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>                <span class="keywordflow">if</span> (sendIndices[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] == 3) {</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>                    sendIndices[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] = 1;</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>                }</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span> </div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>                <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> += stride;</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>            }</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>        }</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span> </div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel.html#ad044343bcb2d7ed50e294f60c308d585"> 1026</a></span>        __global__ <span class="keywordtype">void</span> <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#ad044343bcb2d7ed50e294f60c308d585">symbolicForce</a>(<a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles,</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>                                      <a class="code hl_class" href="class_domain_list.html">DomainList</a> *domainList, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *sendIndices, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> diam, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta_,</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>                                      <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> relevantIndex, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> level,</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>                                      <a class="code hl_enumeration" href="struct_curve.html#a4269858acf8d67e3cd222466771848b9">Curve::Type</a> curveType) {</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span> </div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>            <span class="keywordtype">int</span> bodyIndex = threadIdx.x + blockIdx.x * blockDim.x;</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>            <span class="keywordtype">int</span> stride = blockDim.x * gridDim.x;</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>            <span class="keywordtype">int</span> <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> = 0;</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span> </div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>            <span class="keywordtype">int</span> particleLevel;</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>            <span class="keywordtype">int</span> domainListLevel;</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>            <span class="keywordtype">int</span> currentDomainListIndex;</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>            <span class="keywordtype">int</span> currentParticleIndex;</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>            <span class="keywordtype">int</span> childIndex;</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span> </div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>            <span class="keywordtype">int</span> childPath;</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>            <span class="keywordtype">int</span> tempChildIndex;</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span> </div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>            <span class="keywordtype">bool</span> isDomainListNode;</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>            <span class="keywordtype">bool</span> insert;</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span> </div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> min_x, max_x;</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> dx;</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> min_y, max_y;</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> dy;</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> min_z, max_z;</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> dz;</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> r;</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span> </div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>            <span class="comment">// IDEA: sendIndices = [-1, -1, -1, ..., -1, -1]</span></div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>            <span class="comment">// mark to be tested indices with 2&#39;s: e.g.: sendIndices = [-1, 2, -1, ..., 2, -1]</span></div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>            <span class="comment">// the 2&#39;s are converted within a separate kernel to zeros (which will be tested within this kernel)</span></div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>            <span class="comment">//  separate kernel necessary to avoid race conditions</span></div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>            <span class="comment">// mark to be sent indices/particles with 3&#39;s: e.g.: sendIndices = [-1, 0, 3, ..., 3, 3]</span></div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>            <span class="comment">//  the 3&#39;s are converted within a separate kernel to ones</span></div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span> </div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>            <span class="keywordflow">if</span> (level == 0) { <span class="comment">// mark first level children as starting point</span></div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>                <span class="keywordflow">while</span> ((bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>) &lt; <a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>) {</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>                    <span class="comment">//if ((bodyIndex + offset) == 0) {</span></div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>                    <span class="comment">//    printf(&quot;symbolicForce: [rank %i] relevantDomainListIndices[%i] = %i (%f, %f, %f)\n&quot;,</span></div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>                    <span class="comment">//           subDomainKeyTree-&gt;rank,</span></div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>                    <span class="comment">//           relevantIndex, domainList-&gt;relevantDomainListIndices[relevantIndex],</span></div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>                    <span class="comment">//           particles-&gt;x[domainList-&gt;relevantDomainListIndices[relevantIndex]],</span></div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>                    <span class="comment">//           particles-&gt;y[domainList-&gt;relevantDomainListIndices[relevantIndex]],</span></div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>                    <span class="comment">//           particles-&gt;z[domainList-&gt;relevantDomainListIndices[relevantIndex]]);</span></div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>                    <span class="comment">//}</span></div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] != -1) {</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>                        sendIndices[<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>]] = 0;</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>                    }</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>                    <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> += stride;</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>                }</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>            }</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>            <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span> </div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>                <span class="keywordflow">while</span> ((bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>) &lt; *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;index) {</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span> </div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>                    <span class="comment">//if (bodyIndex + offset == 0) {</span></div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>                    <span class="comment">//    printf(&quot;[rank %i] relevantIndex = %i domainListIndex = %i (%f, %f, %f) %f\n&quot;, subDomainKeyTree-&gt;rank,</span></div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>                    <span class="comment">//           relevantIndex, domainList-&gt;relevantDomainListIndices[relevantIndex],</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>                    <span class="comment">//           particles-&gt;x[domainList-&gt;relevantDomainListIndices[relevantIndex]],</span></div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>                    <span class="comment">//           particles-&gt;y[domainList-&gt;relevantDomainListIndices[relevantIndex]],</span></div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>                    <span class="comment">//           particles-&gt;z[domainList-&gt;relevantDomainListIndices[relevantIndex]],</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>                    <span class="comment">//           particles-&gt;mass[domainList-&gt;relevantDomainListIndices[relevantIndex]]);</span></div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>                    <span class="comment">//}</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span> </div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>                    currentParticleIndex = bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>;</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span> </div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>                    <span class="keywordflow">if</span> ((sendIndices[currentParticleIndex] == 0 || sendIndices[currentParticleIndex] == 3) &amp;&amp; (currentParticleIndex &lt; n || currentParticleIndex &gt;= m )) {</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span> </div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>                        insert = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>                        isDomainListNode = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span> </div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>                        <span class="keywordflow">if</span> (sendIndices[currentParticleIndex] == 0) {</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span> </div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>                            <span class="comment">// check whether to be inserted index corresponds to a domain list</span></div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>                            <span class="comment">//if (insert) {</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>                                <span class="comment">//for (int i_domain = 0; i_domain &lt; *domainList-&gt;domainListIndex; i_domain++) {</span></div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>                                <span class="comment">//    if ((bodyIndex + offset) == domainList-&gt;domainListIndices[i_domain]) {</span></div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>                                <span class="comment">//        insert = false;</span></div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>                                <span class="comment">//        isDomainListNode = true;</span></div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>                                <span class="comment">//        break;</span></div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>                                <span class="comment">//    }</span></div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>                                <span class="comment">//}</span></div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>                            <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a2b2230019fb5f5e34d2ba256d9469272">nodeType</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &gt;= 1) {</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>                                insert = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>                                isDomainListNode = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>                            }</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>                            <span class="comment">//}</span></div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>                            <span class="comment">// TODO: this is probably not necessary, since only domain list indices can correspond to another process</span></div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>                            <span class="keywordflow">if</span> (!isDomainListNode) {</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>                                <span class="keywordflow">if</span> (subDomainKeyTree-&gt;<a class="code hl_function" href="class_sub_domain_key_tree.html#a97cea9227718b239343d6964915015c0">key2proc</a>(</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>                                        <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;getParticleKey(particles, currentParticleIndex, <a class="code hl_define" href="parameter_8h.html#a5bb4257ca9fa4bfcf9391b7895b97761">MAX_LEVEL</a>, curveType)) !=</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>                                    subDomainKeyTree-&gt;<a class="code hl_variable" href="class_sub_domain_key_tree.html#ad364fe0bf3c4c29e3e7c403e1fef200b">rank</a>) {</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>                                    insert = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>                                    <span class="comment">//printf(&quot;Happening?\n&quot;);</span></div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>                                }</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>                            }</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span> </div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>                            <span class="keywordflow">if</span> (insert) {</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>                                sendIndices[currentParticleIndex] = 3;</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>                                sendIndices[currentParticleIndex] = -1;</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>                            }</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>                        }</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span> </div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>                        <span class="comment">// get the particle&#39;s level</span></div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>                        <span class="comment">//particleLevel /*int tempParticleLevel*/ = tree-&gt;getTreeLevel(particles, currentParticleIndex, MAX_LEVEL, curveType);</span></div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>                        particleLevel = particles-&gt;<a class="code hl_variable" href="class_particles.html#a19adbbf68f6c36892dee44dd76a2b0d3">level</a>[currentParticleIndex];</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>                        <span class="comment">//if (tempParticleLevel != particleLevel) {</span></div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>                        <span class="comment">//    printf(&quot;%i vs %i\n&quot;, tempParticleLevel, particleLevel);</span></div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>                        <span class="comment">//}</span></div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span><span class="preprocessor">#if DEBUGGING</span></div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>                        <span class="keywordflow">if</span> (particleLevel &lt; 0) {</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>                            printf(<span class="stringliteral">&quot;WTF particleLevel = %i for %i (%e, %e, %e) (numParticlesLocal = %i, index = %i)\n&quot;</span>,</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>                                   particleLevel, currentParticleIndex, particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[currentParticleIndex],</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>                                   particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[currentParticleIndex], particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[currentParticleIndex],</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>                                   n, *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;index);</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>                        }</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span> </div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>                        <span class="comment">// get the domain list node&#39;s level</span></div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>                        <span class="comment">//domainListLevel = tree-&gt;getTreeLevel(particles,</span></div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>                        <span class="comment">//                                     domainList-&gt;relevantDomainListIndices[relevantIndex],</span></div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>                        <span class="comment">//                                     MAX_LEVEL, curveType);</span></div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>                        domainListLevel = domainList-&gt;<a class="code hl_variable" href="class_domain_list.html#aeed50b7926680d21787841bb670a7b58">relevantDomainListLevels</a>[relevantIndex];</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>                        currentDomainListIndex = domainList-&gt;<a class="code hl_variable" href="class_domain_list.html#ad4e60b99aad7aa93c474a41e65ef5dc4">relevantDomainListIndices</a>[relevantIndex];</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>                        <span class="comment">//printf(&quot;domainListLevel = %i\n&quot;, domainListLevel);</span></div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>                        <span class="keywordflow">if</span> (domainListLevel == -1) {</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>                            <a class="code hl_define" href="cuda__utilities_8cuh.html#a18f09c8175084d073dc810de445cdf3e">cudaAssert</a>(<span class="stringliteral">&quot;symbolicForce(): domainListLevel == -1 for (relevant) index: %i\n&quot;</span>,</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>                                       relevantIndex);</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>                        }</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span> </div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>                        min_x = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minX;</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>                        max_x = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxX;</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>                        min_y = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minY;</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>                        max_y = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxY;</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>                        min_z = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minZ;</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>                        max_z = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxZ;</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span> </div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>                        <span class="comment">// determine domain list node&#39;s bounding box (in order to determine the distance)</span></div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>                        <span class="comment">//if (domainListLevel != 1) {</span></div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>                        <span class="comment">//    printf(&quot;domainListLevel = %i\n&quot;, domainListLevel);</span></div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>                        <span class="comment">//    assert(0);</span></div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>                        <span class="comment">//}</span></div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; domainListLevel; j++) {</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span> </div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>                            <span class="comment">//#if DIM == 3</span></div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>                            <span class="comment">//if (particles-&gt;x[domainList-&gt;relevantDomainListIndices[relevantIndex]] &lt;= max_x &amp;&amp; particles-&gt;x[domainList-&gt;relevantDomainListIndices[relevantIndex]] &gt;= min_x &amp;&amp;</span></div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>                            <span class="comment">//    particles-&gt;y[domainList-&gt;relevantDomainListIndices[relevantIndex]] &lt;= max_y &amp;&amp; particles-&gt;y[domainList-&gt;relevantDomainListIndices[relevantIndex]] &gt;= min_y &amp;&amp;</span></div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>                            <span class="comment">//    particles-&gt;z[domainList-&gt;relevantDomainListIndices[relevantIndex]] &lt;= max_z &amp;&amp; particles-&gt;z[domainList-&gt;relevantDomainListIndices[relevantIndex]] &gt;= min_z) {</span></div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>                            <span class="comment">//}</span></div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>                            <span class="comment">//else {</span></div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>                            <span class="comment">//    printf(&quot;not within box %i, %i  level: %i (%f, %f, %f) box (%f, %f), (%f, %f), (%f, %f)!\n&quot;, relevantIndex, domainList-&gt;relevantDomainListIndices[relevantIndex],</span></div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>                            <span class="comment">//           domainList-&gt;relevantDomainListLevels[relevantIndex],</span></div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>                            <span class="comment">//           particles-&gt;x[domainList-&gt;relevantDomainListIndices[relevantIndex]], particles-&gt;y[domainList-&gt;relevantDomainListIndices[relevantIndex]],</span></div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>                            <span class="comment">//           particles-&gt;z[domainList-&gt;relevantDomainListIndices[relevantIndex]],</span></div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>                            <span class="comment">//           min_x, max_x, min_y, max_y, min_z, max_z);</span></div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>                            <span class="comment">//    assert(0);</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>                            <span class="comment">//}</span></div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span> </div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>                            childPath = 0;</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>                            <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[currentDomainListIndex] &lt; 0.5 * (min_x + max_x)) {</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>                                childPath += 1;</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>                                max_x = 0.5 * (min_x + max_x);</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>                                min_x = 0.5 * (min_x + max_x);</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>                            }</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>                            <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[currentDomainListIndex] &lt; 0.5 * (min_y + max_y)) {</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>                                childPath += 2;</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>                                max_y = 0.5 * (min_y + max_y);</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>                                min_y = 0.5 * (min_y + max_y);</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>                            }</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>                            <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[currentDomainListIndex] &lt; 0.5 * (min_z + max_z)) {</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>                                childPath += 4;</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>                                max_z = 0.5 * (min_z + max_z);</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>                                min_z = 0.5 * (min_z + max_z);</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>                            }</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>                        }</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span> </div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>                        <span class="comment">// determine (smallest) distance between domain list box and (pseudo-) particle</span></div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>                        <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[currentParticleIndex] &lt; min_x) {</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>                            dx = particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[currentParticleIndex] - min_x;</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[currentParticleIndex] &gt; max_x) {</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>                            dx = particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[currentParticleIndex] - max_x;</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>                            dx = 0.;</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>                        }</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>                        <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[currentParticleIndex] &lt; min_y) {</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>                            dy = particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[currentParticleIndex] - min_y;</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[currentParticleIndex] &gt; max_y) {</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>                            dy = particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[currentParticleIndex] - max_y;</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>                            dy = 0.;</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>                        }</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>                        <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[currentParticleIndex] &lt; min_z) {</div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>                            dz = particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[currentParticleIndex] - min_z;</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[currentParticleIndex] &gt; max_z) { dz =</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>                        particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[currentParticleIndex] - max_z;</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>                            dz = 0.;</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>                        }</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span> </div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span><span class="preprocessor">#if DIM == 1</span></div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>                        r = <a class="code hl_function" href="namespacecuda_1_1math.html#a706200a3f1b2445d7fd835c2ac504a11">cuda::math::sqrt</a>(dx*dx);</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span><span class="preprocessor">#elif DIM == 2</span></div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>                        r = <a class="code hl_function" href="namespacecuda_1_1math.html#a706200a3f1b2445d7fd835c2ac504a11">cuda::math::sqrt</a>(dx*dx + dy*dy);</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>                        r = <a class="code hl_function" href="namespacecuda_1_1math.html#a706200a3f1b2445d7fd835c2ac504a11">cuda::math::sqrt</a>(dx*dx + dy*dy + dz*dz);</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span> </div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>                        <span class="comment">// TODO: (still?) depending on gravity force version and amount of processes: 2 * diam or 1 * diam (why?)</span></div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>                        <span class="comment">//printf(&quot;%f &gt;= %f (particleLevel = %i, theta = %f, r = %f)\n&quot;, powf(0.5, particleLevel-1) /* * 2*/ * diam, (theta_ * r), particleLevel, theta_, r);</span></div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>                        <span class="keywordflow">if</span> (particleLevel != -1 &amp;&amp; (((powf(0.5, particleLevel-1) <span class="comment">/* * 2*/</span> * diam) &gt;= (theta_ * r)) || isDomainListNode)) {</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span> </div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span><span class="preprocessor">                            #pragma unroll</span></div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>                            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>; i++) {</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span> </div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>                                <span class="comment">//if (sendIndices[tree-&gt;child[POW_DIM * (bodyIndex + offset) + i]] != 1 &amp;&amp; tree-&gt;child[POW_DIM * (bodyIndex + offset) + i] != -1) {</span></div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>                                <span class="comment">//    sendIndices[tree-&gt;child[POW_DIM * (bodyIndex + offset) + i]] = 2;</span></div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>                                <span class="comment">//}</span></div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span> </div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>                                <span class="comment">//if (insert &amp;&amp; tree-&gt;child[POW_DIM * (bodyIndex + offset) + i] != -1 &amp;&amp; particles-&gt;x[tree-&gt;child[POW_DIM * (bodyIndex + offset) + i]] == particles-&gt;x[bodyIndex + offset] &amp;&amp;</span></div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>                                <span class="comment">//        particles-&gt;y[tree-&gt;child[POW_DIM * (bodyIndex + offset) + i]] == particles-&gt;y[bodyIndex + offset]) {</span></div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>                                    <span class="comment">//printf(&quot;[rank %i] index = %i == child = %i ^= %i (%f, %f, %f) vs (%f, %f, %f)\n&quot;, subDomainKeyTree-&gt;rank, bodyIndex + offset, i, tree-&gt;child[POW_DIM * (bodyIndex + offset) + i],</span></div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>                                    <span class="comment">//       particles-&gt;x[bodyIndex + offset], particles-&gt;y[bodyIndex + offset], particles-&gt;z[bodyIndex + offset],</span></div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>                                    <span class="comment">//</span></div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>                                    <span class="comment">//       particles-&gt;x[tree-&gt;child[POW_DIM * (bodyIndex + offset) + i]], particles-&gt;y[tree-&gt;child[POW_DIM * (bodyIndex + offset) + i]], particles-&gt;z[tree-&gt;child[POW_DIM * (bodyIndex + offset) + i]]);</span></div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>                                <span class="comment">//}</span></div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span> </div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>                                <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a> * currentParticleIndex + i] != -1) {</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>                                    <span class="keywordflow">if</span> (sendIndices[<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a> * currentParticleIndex + i]] != 1) {</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>                                        sendIndices[<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a> * currentParticleIndex + i]] = 2;</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>                                    }</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>                                }</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span> </div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>                            }</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>                        }</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>                    }</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>                    __threadfence();</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>                    <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> += stride;</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>                }</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span> </div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>            }</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span> </div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>        }</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span> </div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel.html#a5cdcecff7d038d21b4e7c86011843f3e"> 1292</a></span>        __global__ <span class="keywordtype">void</span> <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#a5cdcecff7d038d21b4e7c86011843f3e">compTheta</a>(<a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles,</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>                                  <a class="code hl_class" href="class_domain_list.html">DomainList</a> *domainList, <a class="code hl_class" href="class_helper.html">Helper</a> *helper, <a class="code hl_enumeration" href="struct_curve.html#a4269858acf8d67e3cd222466771848b9">Curve::Type</a> curveType) {</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span> </div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> index = threadIdx.x + blockIdx.x * blockDim.x;</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stride = blockDim.x * gridDim.x;</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> = 0;</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> bodyIndex;</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>            <a class="code hl_typedef" href="parameter_8h.html#a2d83a9d6677f42e2572510c1a14e58ed">keyType</a> key, hilbert;</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> domainIndex;</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> proc;</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span> </div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>            <span class="comment">//&quot;loop&quot; over domain list nodes</span></div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>            <span class="keywordflow">while</span> ((index + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>) &lt; *domainList-&gt;<a class="code hl_variable" href="class_domain_list.html#a3d4763c67f6ee00ce9b2f2c2d5f43000">domainListIndex</a>) {</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span> </div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>                bodyIndex = domainList-&gt;<a class="code hl_variable" href="class_domain_list.html#ab2d8ad5eb0c718359b0caaf1da4ef3ae">domainListIndices</a>[index + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>];</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>                <span class="comment">//calculate key</span></div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>                <span class="comment">//TODO: why not domainList-&gt;domainListKeys[index + offset] instead of getParticleKey()?</span></div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>                <span class="comment">//key =  domainList-&gt;domainListKeys[index + offset]; //???</span></div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>                <span class="comment">//hilbert = KeyNS::lebesgue2hilbert(key, 21);</span></div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>                key = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;getParticleKey(particles, bodyIndex, <a class="code hl_define" href="parameter_8h.html#a5bb4257ca9fa4bfcf9391b7895b97761">MAX_LEVEL</a>, curveType); <span class="comment">// working version</span></div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>                <span class="comment">//if domain list node belongs to other process: add to relevant domain list indices</span></div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>                proc = subDomainKeyTree-&gt;<a class="code hl_function" href="class_sub_domain_key_tree.html#a97cea9227718b239343d6964915015c0">key2proc</a>(key);</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span> </div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>                <span class="comment">//printf(&quot;[rank %i] potential relevant domain list node: %i (%f, %f, %f)\n&quot;, subDomainKeyTree-&gt;rank,</span></div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>                <span class="comment">//       bodyIndex, particles-&gt;x[bodyIndex],</span></div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>                <span class="comment">//       particles-&gt;y[bodyIndex], particles-&gt;z[bodyIndex]);</span></div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span> </div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>                <span class="keywordflow">if</span> (proc != subDomainKeyTree-&gt;<a class="code hl_variable" href="class_sub_domain_key_tree.html#ad364fe0bf3c4c29e3e7c403e1fef200b">rank</a> &amp;&amp; proc &gt;= 0 &amp;&amp; particles-&gt;<a class="code hl_variable" href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">mass</a>[bodyIndex] &gt; 0.f) {</div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>                    <span class="comment">//printf(&quot;[rank = %i] proc = %i, key = %lu for x = (%f, %f, %f)\n&quot;, subDomainKeyTree-&gt;rank, proc, key, particles-&gt;x[bodyIndex], particles-&gt;y[bodyIndex], particles-&gt;z[bodyIndex]);</span></div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>                    domainIndex = atomicAdd(domainList-&gt;<a class="code hl_variable" href="class_domain_list.html#add20616cc36fe06227783e938d2eb4e4">domainListCounter</a>, 1);</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>                    domainList-&gt;<a class="code hl_variable" href="class_domain_list.html#ad4e60b99aad7aa93c474a41e65ef5dc4">relevantDomainListIndices</a>[domainIndex] = bodyIndex;</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>                    domainList-&gt;<a class="code hl_variable" href="class_domain_list.html#aeed50b7926680d21787841bb670a7b58">relevantDomainListLevels</a>[domainIndex] = domainList-&gt;<a class="code hl_variable" href="class_domain_list.html#acf99f56d23d0cb04c995945a450e0143">domainListLevels</a>[index + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>];</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>                    domainList-&gt;<a class="code hl_variable" href="class_domain_list.html#ade39d9a1d5e58ea0e17b093e83fd0285">relevantDomainListProcess</a>[domainIndex] = proc;</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span> </div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>                    <span class="comment">//printf(&quot;[rank %i] Adding relevant domain list node: %i (%f, %f, %f)\n&quot;, subDomainKeyTree-&gt;rank,</span></div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>                    <span class="comment">//       bodyIndex, particles-&gt;x[bodyIndex],</span></div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>                    <span class="comment">//       particles-&gt;y[bodyIndex], particles-&gt;z[bodyIndex]);</span></div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>                }</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>                <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> += stride;</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>            }</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span> </div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>        }</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span> </div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span> </div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel.html#ac5da3a1e3c2a9de7f4ddb53a98814c7e"> 1336</a></span>        __global__ <span class="keywordtype">void</span> <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#ac5da3a1e3c2a9de7f4ddb53a98814c7e">insertReceivedPseudoParticles</a>(<a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles,</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>                                                      <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *levels, <span class="keywordtype">int</span> level, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m) {</div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span> </div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> bodyIndex = threadIdx.x + blockIdx.x * blockDim.x;</div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stride = blockDim.x * gridDim.x;</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>;</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span> </div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> childPath;</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> temp;</div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span> </div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> insertionLevel;</div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span> </div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> min_x, max_x;</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> min_y, max_y;</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> min_z, max_z;</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span> </div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>            <span class="comment">// debug</span></div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>            <span class="comment">//if (bodyIndex == 0 &amp;&amp; level == 0) {</span></div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>            <span class="comment">//    integer levelCounter;</span></div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>            <span class="comment">//    for (int debugLevel = 0; debugLevel&lt; MAX_LEVEL; debugLevel++) {</span></div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>            <span class="comment">//        levelCounter = 0;</span></div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>            <span class="comment">//        for (int i = 0; i &lt; (tree-&gt;toDeleteNode[1] - tree-&gt;toDeleteNode[0]); i++) {</span></div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>            <span class="comment">//            if (debugLevel == 0) {</span></div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>            <span class="comment">//                if (subDomainKeyTree-&gt;key2proc(tree-&gt;getParticleKey(particles, tree-&gt;toDeleteNode[0] + i, MAX_LEVEL, Curve::lebesgue)) == subDomainKeyTree-&gt;rank) {</span></div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>            <span class="comment">//                    printf(&quot;\n-------------------------------------------------\nATTENTION\n\n-------------------------------------------------\n&quot;);</span></div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>            <span class="comment">//                }</span></div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>            <span class="comment">//                //if (particles-&gt;x[tree-&gt;toDeleteNode[0] + i] == 0.f &amp;&amp; particles-&gt;y[tree-&gt;toDeleteNode[0] + i] == 0.f &amp;&amp;</span></div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>            <span class="comment">//                //        particles-&gt;z[tree-&gt;toDeleteNode[0] + i] == 0.f) {</span></div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>            <span class="comment">//                //    printf(&quot;\n-------------------------------------------------\nATTENTION\n\n-------------------------------------------------\n&quot;);</span></div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>            <span class="comment">//                //}</span></div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>            <span class="comment">//              //printf(&quot;[rank %i] index = %i level = %i x = (%f, %f, %f) m = %f\n&quot;, subDomainKeyTree-&gt;rank,</span></div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>            <span class="comment">//                //       tree-&gt;toDeleteNode[0] + i,</span></div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>            <span class="comment">//                //       levels[i],</span></div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>            <span class="comment">//                //       particles-&gt;x[tree-&gt;toDeleteNode[0] + i],</span></div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>            <span class="comment">//                //       particles-&gt;y[tree-&gt;toDeleteNode[0] + i],</span></div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>            <span class="comment">//                //       particles-&gt;z[tree-&gt;toDeleteNode[0] + i],</span></div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>            <span class="comment">//                //       particles-&gt;mass[tree-&gt;toDeleteNode[0] + i]);</span></div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>            <span class="comment">//            }</span></div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>            <span class="comment">//            if (levels[i] == debugLevel) {</span></div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>            <span class="comment">//                //printf(&quot;[rank %i] level available: %i\n&quot;, subDomainKeyTree-&gt;rank, debugLevel);</span></div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>            <span class="comment">//                levelCounter++;</span></div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>            <span class="comment">//            }</span></div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>            <span class="comment">//        }</span></div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>            <span class="comment">//        if (levelCounter &gt; 0) {</span></div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>            <span class="comment">//            printf(&quot;[rank %i] level available: %i (# = %i)\n&quot;, subDomainKeyTree-&gt;rank, debugLevel, levelCounter);</span></div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>            <span class="comment">//        }</span></div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>            <span class="comment">//    }</span></div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>            <span class="comment">//}</span></div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span> </div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>            <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> = 0;</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span>            <span class="keywordflow">while</span> ((bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>) &lt; (<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[1] - <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0])) {</div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span> </div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>                insertionLevel = 0;</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span> </div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>                <span class="comment">//if (levels[bodyIndex + offset] &lt; 0 || levels[bodyIndex + offset] &gt; 21) {</span></div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>                <span class="comment">//    printf(&quot;[rank %i] levels[%i] = %i!\n&quot;, subDomainKeyTree-&gt;rank, bodyIndex + offset, levels[bodyIndex + offset]);</span></div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>                <span class="comment">//    assert(0);</span></div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>                <span class="comment">//}</span></div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span> </div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>                <span class="keywordflow">if</span> (levels[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] == level) {</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span> </div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span>                    min_x = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minX;</div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>                    max_x = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxX;</div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>                    min_y = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minY;</div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>                    max_y = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxY;</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>                    min_z = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minZ;</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>                    max_z = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxZ;</div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>                    temp = 0;</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>                    childPath = 0;</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span> </div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>                    <span class="comment">// find insertion point for body</span></div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>                    <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0] + bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &lt; 0.5 * (min_x + max_x)) { <span class="comment">// x direction</span></div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>                        childPath += 1;</div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>                        max_x = 0.5 * (min_x + max_x);</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>                    }</div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>                    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>                        min_x = 0.5 * (min_x + max_x);</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>                    }</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>                    <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0] + bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &lt; 0.5 * (min_y + max_y)) { <span class="comment">// y direction</span></div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>                        childPath += 2;</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>                        max_y = 0.5 * (min_y + max_y);</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>                    }</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>                    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>                        min_y = 0.5 * (min_y + max_y);</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>                    }</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span>                    <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0] + bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &lt; 0.5 * (min_z + max_z)) {  <span class="comment">// z direction</span></div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>                        childPath += 4;</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>                        max_z = 0.5 * (min_z + max_z);</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>                    }</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>                    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>                        min_z = 0.5 * (min_z + max_z);</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span>                    }</div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>                    <span class="keywordtype">int</span> childIndex = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[temp*<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a> + childPath];</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>                    atomicAdd(&amp;<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;count[childIndex], 1);</div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>                    insertionLevel++;</div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span> </div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>                    <span class="comment">// debug</span></div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>                    <span class="comment">//if (subDomainKeyTree-&gt;rank == 0) {</span></div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>                    <span class="comment">//    if (childPath &lt; 4) {</span></div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>                    <span class="comment">//        printf(&quot;[rank %i] childPath = %i WTF?\n&quot;, subDomainKeyTree-&gt;rank, childPath);</span></div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>                    <span class="comment">//    }</span></div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>                    <span class="comment">//}</span></div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>                    <span class="comment">//else {</span></div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>                    <span class="comment">//    if (childPath &gt;= 4) {</span></div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>                    <span class="comment">//        printf(&quot;[rank %i] childPath = %i WTF?\n&quot;, subDomainKeyTree-&gt;rank, childPath);</span></div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>                    <span class="comment">//    }</span></div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>                    <span class="comment">//}</span></div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>                    <span class="comment">// end: debug</span></div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span> </div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>                    <span class="comment">// debug</span></div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>                    <span class="comment">//if ((bodyIndex + offset) % 100 == 0) {</span></div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>                    <span class="comment">//    printf(&quot;[rank %i] childPath = %i, childIndex = %i\n&quot;, subDomainKeyTree-&gt;rank, childPath,</span></div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>                    <span class="comment">//           childIndex);</span></div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>                    <span class="comment">//}</span></div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>                    <span class="comment">// end: debug</span></div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span> </div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>                    <span class="comment">// traverse tree until hitting leaf node</span></div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>                    <span class="keywordflow">while</span> (childIndex &gt;= m) {</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>                        insertionLevel++;</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span> </div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>                        temp = childIndex;</div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>                        childPath = 0;</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span> </div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>                        <span class="comment">// find insertion point for body</span></div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>                        <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0] + bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &lt; 0.5 * (min_x + max_x)) { <span class="comment">// x direction</span></div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>                            childPath += 1;</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>                            max_x = 0.5 * (min_x + max_x);</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>                        }</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>                        <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span>                            min_x = 0.5 * (min_x + max_x);</div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>                        }</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>                        <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0] + bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &lt; 0.5 * (min_y + max_y)) { <span class="comment">// y direction</span></div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span>                            childPath += 2;</div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>                            max_y = 0.5 * (min_y + max_y);</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>                        }</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>                        <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>                            min_y = 0.5 * (min_y + max_y);</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>                        }</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>                        <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0] + bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &lt; 0.5 * (min_z + max_z)) { <span class="comment">// z direction</span></div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>                            childPath += 4;</div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>                            max_z = 0.5 * (min_z + max_z);</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>                        }</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>                        <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>                            min_z = 0.5 * (min_z + max_z);</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>                        }</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>                        atomicAdd(&amp;<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;count[temp], 1); <span class="comment">// ? do not count, since particles are just temporarily saved on this process</span></div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>                        childIndex = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>*temp + childPath];</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span> </div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>                    }</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>                    <span class="keywordflow">if</span> (childIndex != -1) {</div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span>                        printf(<span class="stringliteral">&quot;[rank %i] (%f, %f, %f) vs (%f, %f, %f)\n&quot;</span>, subDomainKeyTree-&gt;<a class="code hl_variable" href="class_sub_domain_key_tree.html#ad364fe0bf3c4c29e3e7c403e1fef200b">rank</a>,</div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>                               particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0] + bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>],</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span>                               particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0] + bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>],</div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>                               particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0] + bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>],</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span>                               particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[childIndex],</div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>                               particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[childIndex],</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>                               particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[childIndex]);</div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>                        <a class="code hl_define" href="cuda__utilities_8cuh.html#a18f09c8175084d073dc810de445cdf3e">cudaAssert</a>(<span class="stringliteral">&quot;insertReceivedPseudoParticles(): childIndex = %i temp = %i\n&quot;</span>, childIndex, temp);</div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>                    }</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span> </div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>                    <span class="comment">//insertionLevel++;</span></div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span> </div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>                    <span class="comment">//temp = childIndex;</span></div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>                    <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>*temp + childPath] = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0] + bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>;</div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>                    <span class="comment">//printf(&quot;[rank %i] gravity inserting POWDIM * %i + %i = %i (level = %i)\n&quot;, subDomainKeyTree-&gt;rank,</span></div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>                    <span class="comment">//       temp, childPath, tree-&gt;toDeleteNode[0] + bodyIndex + offset, level);</span></div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span> </div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>                    <span class="keywordflow">if</span> (levels[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] != insertionLevel) {</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>                        <span class="comment">// debug</span></div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>                        <span class="comment">//printf(&quot;[rank %i] index = %i childIndex = %i level = %i insertionLevel = %i path = %i, %i, %i, %i, %i, %i, %i, %i, %i, %i, %i\n&quot;,</span></div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>                        <span class="comment">//       subDomainKeyTree-&gt;rank, tree-&gt;toDeleteNode[0] + bodyIndex + offset, childIndex,</span></div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>                        <span class="comment">//       levels[bodyIndex + offset], insertionLevel, path[0], path[1], path[2], path[3], path[4],</span></div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>                        <span class="comment">//       path[5], path[6], path[7], path[8], path[9], path[10]);</span></div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>                        <span class="comment">//printf(&quot;[rank %i] level = %i, insertionLevel = %i x = (%f, %f, %f) min/max = (%f, %f | %f, %f | %f, %f))\n&quot;, subDomainKeyTree-&gt;rank,</span></div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>                        <span class="comment">//       levels[bodyIndex + offset], insertionLevel,</span></div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>                        <span class="comment">//       particles-&gt;x[tree-&gt;toDeleteNode[0] + bodyIndex + offset],</span></div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>                        <span class="comment">//       particles-&gt;y[tree-&gt;toDeleteNode[0] + bodyIndex + offset],</span></div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>                        <span class="comment">//       particles-&gt;z[tree-&gt;toDeleteNode[0] + bodyIndex + offset],</span></div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>                        <span class="comment">//       min_x, max_x, min_y, max_y, min_z, max_z);</span></div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>                        <span class="comment">//printf(&quot;[rank %i] level = %i, insertionLevel = %i x = (%f, %f, %f) min/max = (%f, %f, %f))\n&quot;, subDomainKeyTree-&gt;rank,</span></div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>                        <span class="comment">//       levels[bodyIndex + offset], insertionLevel,</span></div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>                        <span class="comment">//       particles-&gt;x[tree-&gt;toDeleteNode[0] + bodyIndex + offset],</span></div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>                        <span class="comment">//       particles-&gt;y[tree-&gt;toDeleteNode[0] + bodyIndex + offset],</span></div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>                        <span class="comment">//       particles-&gt;z[tree-&gt;toDeleteNode[0] + bodyIndex + offset],</span></div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>                        <span class="comment">//       0.5 * (min_x + max_x), 0.5 * (min_y + max_y), 0.5 * (min_z + max_z));</span></div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>                        <span class="comment">//for (int i=0; i &lt; (tree-&gt;toDeleteNode[1] - tree-&gt;toDeleteNode[0]); i++) {</span></div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span>                        <span class="comment">//    printf(&quot;[rank %i] index = %i level = %i x = (%f, %f, %f) m = %f\n&quot;,</span></div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>                        <span class="comment">//            subDomainKeyTree-&gt;rank,</span></div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>                        <span class="comment">//            tree-&gt;toDeleteNode[0] + i,</span></div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>                        <span class="comment">//            levels[i],</span></div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>                        <span class="comment">//            particles-&gt;x[tree-&gt;toDeleteNode[0] + i],</span></div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>                        <span class="comment">//            particles-&gt;y[tree-&gt;toDeleteNode[0] + i],</span></div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>                        <span class="comment">//            particles-&gt;z[tree-&gt;toDeleteNode[0] + i],</span></div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>                        <span class="comment">//            particles-&gt;mass[tree-&gt;toDeleteNode[0] + i]);</span></div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>                        <span class="comment">//}</span></div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span> </div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>                        <a class="code hl_define" href="cuda__utilities_8cuh.html#a18f09c8175084d073dc810de445cdf3e">cudaAssert</a>(<span class="stringliteral">&quot;insertReceivedPseudoParticles() for %i: level[%i] = %i != insertionLevel = %i!\n&quot;</span>,</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span>                                   <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0] + bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>, bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>,</div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>                                   levels[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>], insertionLevel);</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>                    }</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>                }</div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>                __threadfence();</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>                <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> += stride;</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>            }</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span>        }</div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span> </div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel.html#a1b8c1628c756822f843208ca4a63a024"> 1560</a></span>        __global__ <span class="keywordtype">void</span> <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#a1b8c1628c756822f843208ca4a63a024">insertReceivedParticles</a>(<a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles,</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>                                                <a class="code hl_class" href="class_domain_list.html">DomainList</a> *domainList, <a class="code hl_class" href="class_domain_list.html">DomainList</a> *<a class="code hl_function" href="namespace_domain_list_n_s_1_1_kernel.html#a262639b50010c293a6c60e75a020f106">lowestDomainList</a>, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m) {</div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span> </div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> bodyIndex = threadIdx.x + blockIdx.x * blockDim.x;</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stride = blockDim.x * gridDim.x;</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span> </div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>;</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span> </div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> min_x, max_x;</div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> min_y, max_y;</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>            <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> min_z, max_z;</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> childPath;</div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>            <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> temp;</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span> </div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>            <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> = 0;</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span> </div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>            bodyIndex += <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteLeaf[0];</div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span> </div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>            <span class="keywordflow">while</span> ((bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>) &lt; <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteLeaf[1]) { <span class="comment">// &amp;&amp; (bodyIndex + offset) &gt;= tree-&gt;toDeleteLeaf[0]) {</span></div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span> </div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>                min_x = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minX;</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>                max_x = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxX;</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>                min_y = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minY;</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>                max_y = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxY;</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>                min_z = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;minZ;</div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>                max_z = *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;maxZ;</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span> </div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>                temp = 0;</div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>                childPath = 0;</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span> </div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>                <span class="comment">// find insertion point for body</span></div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>                <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &lt; 0.5 * (min_x + max_x)) { <span class="comment">// x direction</span></div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>                    childPath += 1;</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>                    max_x = 0.5 * (min_x + max_x);</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>                }</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>                <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>                    min_x = 0.5 * (min_x + max_x);</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>                }</div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>                <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &lt; 0.5 * (min_y + max_y)) { <span class="comment">// y direction</span></div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>                    childPath += 2;</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>                    max_y = 0.5 * (min_y + max_y);</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>                }</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>                <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>                    min_y = 0.5 * (min_y + max_y);</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>                }</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>                <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &lt; 0.5 * (min_z + max_z)) {  <span class="comment">// z direction</span></div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>                    childPath += 4;</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>                    max_z = 0.5 * (min_z + max_z);</div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span>                }</div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span>                <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span>                    min_z = 0.5 * (min_z + max_z);</div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span>                }</div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>                <span class="keywordtype">int</span> childIndex = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[temp*<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a> + childPath];</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span> </div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>                <span class="comment">// traverse tree until hitting leaf node</span></div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span>                <span class="keywordflow">while</span> (childIndex &gt;= m) {</div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span> </div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span>                    temp = childIndex;</div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span> </div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>                    childPath = 0;</div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span> </div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span>                    <span class="comment">// find insertion point for body</span></div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>                    <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a122a9985fed39c45d3a151dba2794299">x</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &lt; 0.5 * (min_x + max_x)) { <span class="comment">// x direction</span></div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>                        childPath += 1;</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span>                        max_x = 0.5 * (min_x + max_x);</div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span>                    }</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>                    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>                        min_x = 0.5 * (min_x + max_x);</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>                    }</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span><span class="preprocessor">#if DIM &gt; 1</span></div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>                    <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">y</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &lt; 0.5 * (min_y + max_y)) { <span class="comment">// y direction</span></div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>                        childPath += 2;</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>                        max_y = 0.5 * (min_y + max_y);</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>                    }</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>                    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>                        min_y = 0.5 * (min_y + max_y);</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>                    }</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span><span class="preprocessor">#if DIM == 3</span></div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>                    <span class="keywordflow">if</span> (particles-&gt;<a class="code hl_variable" href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">z</a>[bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>] &lt; 0.5 * (min_z + max_z)) { <span class="comment">// z direction</span></div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>                        childPath += 4;</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>                        max_z = 0.5 * (min_z + max_z);</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>                    }</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>                    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>                        min_z = 0.5 * (min_z + max_z);</div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>                    }</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>                    atomicAdd(&amp;<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;count[temp], 1); <span class="comment">// do not count, since particles are just temporarily saved on this process</span></div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>                    childIndex = <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>*temp + childPath];</div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span> </div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>                }</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span> </div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>                <span class="keywordflow">if</span> (childIndex != -1) {</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>                    <a class="code hl_define" href="cuda__utilities_8cuh.html#a18f09c8175084d073dc810de445cdf3e">cudaAssert</a>(<span class="stringliteral">&quot;ATTENTION: insertReceivedParticles(): childIndex = %i (%i, %i) (%i, %i)\n&quot;</span>, childIndex,</div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>                               <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteLeaf[0], <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteLeaf[1], <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[0],</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>                               <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;toDeleteNode[1]);</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>                    <span class="comment">//printf(&quot;[rank %i] ATTENTION: childIndex = %i,... child[8 * %i + %i] = %i (%f, %f, %f) vs (%f, %f, %f)\n&quot;, subDomainKeyTree-&gt;rank,</span></div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>                    <span class="comment">//           childIndex, temp, childPath, bodyIndex + offset,</span></div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>                    <span class="comment">//           particles-&gt;x[childIndex], particles-&gt;y[childIndex], particles-&gt;z[childIndex],</span></div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>                    <span class="comment">//           particles-&gt;x[bodyIndex + offset], particles-&gt;y[bodyIndex + offset], particles-&gt;z[bodyIndex + offset]);</span></div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span> </div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span>                }</div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span> </div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>                <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>-&gt;child[<a class="code hl_define" href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a>*temp + childPath] = bodyIndex + <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a>;</div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span> </div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>                __threadfence();</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>                <a class="code hl_variable" href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a> += stride;</div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>            }</div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span> </div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>        }</div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span> </div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel_1_1_launch.html#a5fd5374a87a91b5e8b83940227672932"> 1683</a></span>        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> <a class="code hl_function" href="namespace_gravity_1_1_kernel_1_1_launch.html#a5fd5374a87a91b5e8b83940227672932">Launch::collectSendIndices</a>(<a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *sendIndices,</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>                                <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *<a class="code hl_function" href="namespace_s_p_h_1_1_kernel.html#a89b6537f53e3271b87059b7be0d844ee">particles2Send</a>, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *pseudoParticles2Send,</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>                                <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *pseudoParticlesLevel,</div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>                                <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *particlesCount, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *pseudoParticlesCount,</div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span>                                <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> length, <a class="code hl_enumeration" href="struct_curve.html#a4269858acf8d67e3cd222466771848b9">Curve::Type</a> curveType) {</div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span>            <a class="code hl_class" href="class_execution_policy.html">ExecutionPolicy</a> executionPolicy;</div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a>(<span class="keyword">true</span>, executionPolicy, <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#ab82c5727eb23d566faca7ff2460b8b94">::Gravity::Kernel::collectSendIndices</a>, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, particles, sendIndices,</div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span>                                <a class="code hl_function" href="namespace_s_p_h_1_1_kernel.html#a89b6537f53e3271b87059b7be0d844ee">particles2Send</a>, pseudoParticles2Send, pseudoParticlesLevel, particlesCount,</div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span>                                pseudoParticlesCount, n, length, curveType);</div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>        }</div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span> </div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel_1_1_launch.html#a34ede88c5a5ddb0e73b9e5989b68c143"> 1694</a></span>        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> <a class="code hl_function" href="namespace_gravity_1_1_kernel_1_1_launch.html#a34ede88c5a5ddb0e73b9e5989b68c143">Launch::testSendIndices</a>(<a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles,</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>                             <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *sendIndices, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *markedSendIndices,</div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>                             <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *levels, <a class="code hl_enumeration" href="struct_curve.html#a4269858acf8d67e3cd222466771848b9">Curve::Type</a> curveType, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> length) {</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>            <a class="code hl_class" href="class_execution_policy.html">ExecutionPolicy</a> executionPolicy;</div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a>(<span class="keyword">true</span>, executionPolicy, <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#a2e0b258dbccbab147cbb5ec68b434bd3">::Gravity::Kernel::testSendIndices</a>, subDomainKeyTree,</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>                                <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, particles, sendIndices, markedSendIndices, levels, curveType, length);</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>        }</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span> </div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel_1_1_launch.html#a1ca32ecc459f70026dc7944d97d9a8c2"> 1702</a></span>        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> <a class="code hl_function" href="namespace_gravity_1_1_kernel_1_1_launch.html#a1ca32ecc459f70026dc7944d97d9a8c2">Launch::computeForces_v1</a>(<a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> radius, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m,</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>                                      <a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> smoothing,</div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>                                      <span class="keywordtype">bool</span> potentialEnergy) {</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>            <span class="keywordtype">size_t</span> sharedMemory = <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>) * <a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>;</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>            <a class="code hl_class" href="class_execution_policy.html">ExecutionPolicy</a> executionPolicy(256, 256, sharedMemory);</div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>            <span class="comment">//ExecutionPolicy executionPolicy(512, 256, sharedMemory);</span></div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a>(<span class="keyword">true</span>, executionPolicy, <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#aed59991b3f4e4a8893656f2c1bce363a">::Gravity::Kernel::computeForces_v1</a>, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, particles,</div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>                                radius, n, m, subDomainKeyTree, theta, smoothing, potentialEnergy);</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>        }</div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span> </div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel_1_1_launch.html#ad7f1618337e772cbb6ad23ccfb23bc35"> 1712</a></span>        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> <a class="code hl_function" href="namespace_gravity_1_1_kernel_1_1_launch.html#ad7f1618337e772cbb6ad23ccfb23bc35">Launch::computeForces_v1_1</a>(<a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> radius, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m,</div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>                                        <a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> smoothing,</div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span>                                        <span class="keywordtype">bool</span> potentialEnergy) {</div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span>            <span class="keywordtype">size_t</span> sharedMemory = <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>) * <a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>;</div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>            <a class="code hl_class" href="class_execution_policy.html">ExecutionPolicy</a> executionPolicy(256, 256, sharedMemory);</div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>            <span class="comment">//ExecutionPolicy executionPolicy(512, 256, sharedMemory);</span></div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a>(<span class="keyword">true</span>, executionPolicy, <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#a717dff3559e55e15c1f94e10eae1d16e">::Gravity::Kernel::computeForces_v1_1</a>, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, particles,</div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>                                radius, n, m, subDomainKeyTree, theta, smoothing, potentialEnergy);</div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span>        }</div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span> </div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel_1_1_launch.html#ae755581e4ba4428696a782705d779de3"> 1722</a></span>        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> <a class="code hl_function" href="namespace_gravity_1_1_kernel_1_1_launch.html#ae755581e4ba4428696a782705d779de3">Launch::computeForces_v1_2</a>(<a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> radius, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m,</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>                                      <a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> smoothing,</div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span>                                      <span class="keywordtype">bool</span> potentialEnergy) {</div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>            <span class="keywordtype">size_t</span> sharedMemory = (2*<span class="keyword">sizeof</span>(int) + <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>)) * <a class="code hl_define" href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a>;</div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>            <a class="code hl_class" href="class_execution_policy.html">ExecutionPolicy</a> executionPolicy(256, 256, sharedMemory);</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>            <span class="comment">//ExecutionPolicy executionPolicy(512, 256, sharedMemory);</span></div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a>(<span class="keyword">true</span>, executionPolicy, <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#aab6c8bfe6472b2584544b0af06dfd150">::Gravity::Kernel::computeForces_v1_2</a>, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, particles,</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span>                                radius, n, m, subDomainKeyTree, theta, smoothing, potentialEnergy);</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>        }</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span> </div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel_1_1_launch.html#ac891e359f29fdcbe33413adc497a4e5f"> 1732</a></span>        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> <a class="code hl_function" href="namespace_gravity_1_1_kernel_1_1_launch.html#ac891e359f29fdcbe33413adc497a4e5f">Launch::computeForces_v2</a>(<a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> radius, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m,</div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>                                      <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> blockSize, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> warp, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stackSize,</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>                                      <a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta,</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>                                      <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> smoothing, <span class="keywordtype">bool</span> potentialEnergy) {</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span> </div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>            <span class="keywordtype">size_t</span> sharedMemory = (<span class="keyword">sizeof</span>(<a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>)+<span class="keyword">sizeof</span>(<a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a>))*stackSize*blockSize/warp;</div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>            <span class="comment">//size_t sharedMemory = 2*sizeof(real)*stackSize*blockSize/warp;</span></div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>            <a class="code hl_class" href="class_execution_policy.html">ExecutionPolicy</a> executionPolicy(256, 256, sharedMemory);</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span>            <span class="comment">//ExecutionPolicy executionPolicy(512, 256, sharedMemory);</span></div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a>(<span class="keyword">true</span>, executionPolicy, <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#a700b862d81747a6140b7af269c3cee16">::Gravity::Kernel::computeForces_v2</a>, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, particles, radius,</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>                                n, m, blockSize, warp, stackSize, subDomainKeyTree, theta, smoothing, potentialEnergy);</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>        }</div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span> </div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel_1_1_launch.html#a198b9af143d1ef344de44c826cd0fc04"> 1745</a></span>        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> <a class="code hl_function" href="namespace_gravity_1_1_kernel_1_1_launch.html#a198b9af143d1ef344de44c826cd0fc04">Launch::computeForces_v2_1</a>(<a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> blockSize,</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>                                        <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> warp, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> stackSize, <a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree,</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>                                        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> smoothing, <span class="keywordtype">bool</span> potentialEnergy) {</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span> </div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>            <span class="keywordtype">size_t</span> sharedMemory = (<span class="keyword">sizeof</span>(<a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a>)+<span class="keyword">sizeof</span>(<a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a>))*stackSize*blockSize/warp;</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>            <span class="comment">//size_t sharedMemory = 2*sizeof(real)*stackSize*blockSize/warp;</span></div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>            <a class="code hl_class" href="class_execution_policy.html">ExecutionPolicy</a> executionPolicy(256, 256, sharedMemory);</div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span>            <span class="comment">//ExecutionPolicy executionPolicy(512, 256, sharedMemory);</span></div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a>(<span class="keyword">true</span>, executionPolicy, <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#afe9543ee9b2e06c705b1a087b3f6b94a">::Gravity::Kernel::computeForces_v2_1</a>, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, particles, n, m,</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>                                blockSize, warp, stackSize, subDomainKeyTree, theta, smoothing, potentialEnergy);</div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span>        }</div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span> </div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span>        <span class="comment">//real Launch::symbolicForce(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles,</span></div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>        <span class="comment">//                   DomainList *domainList, integer *sendIndices,</span></div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span>        <span class="comment">//                   real diam, real theta_, integer n, integer m, integer relevantIndex,</span></div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span>        <span class="comment">//                   Curve::Type curveType) {</span></div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span>        <span class="comment">//    ExecutionPolicy executionPolicy(1, 256);</span></div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span>        <span class="comment">//    return cuda::launch(true, executionPolicy, ::Gravity::Kernel::symbolicForce, subDomainKeyTree, tree,</span></div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span>        <span class="comment">//                        particles, domainList, sendIndices, diam, theta_, n, m, relevantIndex, curveType);</span></div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>        <span class="comment">//}</span></div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span> </div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel_1_1_launch.html#a59afdf774d13a5c8b08b792a52eea8ca"> 1766</a></span>        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> <a class="code hl_function" href="namespace_gravity_1_1_kernel_1_1_launch.html#a59afdf774d13a5c8b08b792a52eea8ca">Launch::intermediateSymbolicForce</a>(<a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles,</div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>                                   <a class="code hl_class" href="class_domain_list.html">DomainList</a> *domainList, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *sendIndices, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> diam, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta_,</div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span>                                   <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> relevantIndex, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> level,</div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span>                                   <a class="code hl_enumeration" href="struct_curve.html#a4269858acf8d67e3cd222466771848b9">Curve::Type</a> curveType) {</div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>            <a class="code hl_class" href="class_execution_policy.html">ExecutionPolicy</a> executionPolicy;</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a>(<span class="keyword">true</span>, executionPolicy, <a class="code hl_function" href="namespace_gravity_1_1_kernel.html#a962bb4ab459204c7236171ae3523e871">::Gravity::Kernel::intermediateSymbolicForce</a>, subDomainKeyTree, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>,</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span>                                particles, domainList, sendIndices, diam, theta_, n, m, relevantIndex, level, curveType);</div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span>        }</div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span> </div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel_1_1_launch.html#a6ff17bca5edbee4c81b7999a17f17850"> 1775</a></span>        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> <a class="code hl_function" href="namespace_gravity_1_1_kernel_1_1_launch.html#a6ff17bca5edbee4c81b7999a17f17850">Launch::symbolicForce</a>(<a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles,</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span>                           <a class="code hl_class" href="class_domain_list.html">DomainList</a> *domainList, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *sendIndices, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> diam, <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> theta_,</div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span>                           <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> n, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> m, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> relevantIndex, <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> level,</div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span>                           <a class="code hl_enumeration" href="struct_curve.html#a4269858acf8d67e3cd222466771848b9">Curve::Type</a> curveType) {</div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>            <a class="code hl_class" href="class_execution_policy.html">ExecutionPolicy</a> executionPolicy;</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a>(<span class="keyword">true</span>, executionPolicy, <a class="code hl_function" href="parallel_force_concept_8cpp.html#a5ad90577a90240259fc6ba230b4f276c">::Gravity::Kernel::symbolicForce</a>, subDomainKeyTree, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>,</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>                                particles, domainList, sendIndices, diam, theta_, n, m, relevantIndex, level, curveType);</div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>        }</div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span> </div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel_1_1_launch.html#a36795d00ed812d043c266a9d527c0a9f"> 1784</a></span>        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> <a class="code hl_function" href="namespace_gravity_1_1_kernel_1_1_launch.html#a36795d00ed812d043c266a9d527c0a9f">Launch::compTheta</a>(<a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles,</div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>                       <a class="code hl_class" href="class_domain_list.html">DomainList</a> *domainList, <a class="code hl_class" href="class_helper.html">Helper</a> *helper, <a class="code hl_enumeration" href="struct_curve.html#a4269858acf8d67e3cd222466771848b9">Curve::Type</a> curveType) {</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span>            <a class="code hl_class" href="class_execution_policy.html">ExecutionPolicy</a> executionPolicy;</div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a>(<span class="keyword">true</span>, executionPolicy, <a class="code hl_function" href="parallel_force_concept_8cpp.html#a525c7922f7ca729e0735918e0f639bb7">::Gravity::Kernel::compTheta</a>, subDomainKeyTree, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, particles,</div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>                                domainList, helper, curveType);</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span>        }</div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span> </div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span>        <span class="comment">//real Launch::insertReceivedPseudoParticles(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles,</span></div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>        <span class="comment">//                                   integer *levels, int n, int m) {</span></div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span>        <span class="comment">//    ExecutionPolicy executionPolicy(1, 256);</span></div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span>        <span class="comment">//    return cuda::launch(true, executionPolicy, ::Gravity::Kernel::insertReceivedPseudoParticles,</span></div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>        <span class="comment">//                        subDomainKeyTree, tree, particles, levels, n, m);</span></div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span>        <span class="comment">//}</span></div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span> </div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel_1_1_launch.html#acbe6dfc65d9268a74a87f4dcc10f5100"> 1798</a></span>        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> <a class="code hl_function" href="namespace_gravity_1_1_kernel_1_1_launch.html#acbe6dfc65d9268a74a87f4dcc10f5100">Launch::insertReceivedPseudoParticles</a>(<a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles,</div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span>                                                   <a class="code hl_typedef" href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a> *levels, <span class="keywordtype">int</span> level, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m) {</div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>            <a class="code hl_class" href="class_execution_policy.html">ExecutionPolicy</a> executionPolicy;</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a>(<span class="keyword">true</span>, executionPolicy, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time_1_1_gravity.html#ad0f2afd7681e736fa00ce800a55225d9">::Gravity::Kernel::insertReceivedPseudoParticles</a>,</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>                                subDomainKeyTree, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, particles, levels, level, n, m);</div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>        }</div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span> </div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"><a class="line" href="namespace_gravity_1_1_kernel_1_1_launch.html#aa2529f45dcf03594d67a01c2ede5bb65"> 1805</a></span>        <a class="code hl_typedef" href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> <a class="code hl_function" href="namespace_gravity_1_1_kernel_1_1_launch.html#aa2529f45dcf03594d67a01c2ede5bb65">Launch::insertReceivedParticles</a>(<a class="code hl_class" href="class_sub_domain_key_tree.html">SubDomainKeyTree</a> *subDomainKeyTree, <a class="code hl_class" href="class_tree.html">Tree</a> *<a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, <a class="code hl_class" href="class_particles.html">Particles</a> *particles,</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>                                     <a class="code hl_class" href="class_domain_list.html">DomainList</a> *domainList, <a class="code hl_class" href="class_domain_list.html">DomainList</a> *<a class="code hl_function" href="namespace_domain_list_n_s_1_1_kernel.html#a262639b50010c293a6c60e75a020f106">lowestDomainList</a>, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m) {</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>            <a class="code hl_class" href="class_execution_policy.html">ExecutionPolicy</a> executionPolicy;</div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a>(<span class="keyword">true</span>, executionPolicy, <a class="code hl_variable" href="namespace_profiler_ids_1_1_time_1_1_gravity.html#ab6304a139223271c365e18efb53ec96b">::Gravity::Kernel::insertReceivedParticles</a>, subDomainKeyTree,</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>                                <a class="code hl_variable" href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">tree</a>, particles, domainList, <a class="code hl_function" href="namespace_domain_list_n_s_1_1_kernel.html#a262639b50010c293a6c60e75a020f106">lowestDomainList</a>, n, m);</div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>        }</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span> </div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span>    }</div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span>}</div>
<div class="ttc" id="aclass_domain_list_html"><div class="ttname"><a href="class_domain_list.html">DomainList</a></div><div class="ttdef"><b>Definition:</b> <a href="subdomain_8cuh_source.html#l00348">subdomain.cuh:348</a></div></div>
<div class="ttc" id="aclass_domain_list_html_a3d4763c67f6ee00ce9b2f2c2d5f43000"><div class="ttname"><a href="class_domain_list.html#a3d4763c67f6ee00ce9b2f2c2d5f43000">DomainList::domainListIndex</a></div><div class="ttdeci">integer * domainListIndex</div><div class="ttdoc">domain list node index, thus amount of domain list nodes</div><div class="ttdef"><b>Definition:</b> <a href="subdomain_8cuh_source.html#l00357">subdomain.cuh:357</a></div></div>
<div class="ttc" id="aclass_domain_list_html_ab2d8ad5eb0c718359b0caaf1da4ef3ae"><div class="ttname"><a href="class_domain_list.html#ab2d8ad5eb0c718359b0caaf1da4ef3ae">DomainList::domainListIndices</a></div><div class="ttdeci">integer * domainListIndices</div><div class="ttdoc">domain list node indices</div><div class="ttdef"><b>Definition:</b> <a href="subdomain_8cuh_source.html#l00353">subdomain.cuh:353</a></div></div>
<div class="ttc" id="aclass_domain_list_html_acf99f56d23d0cb04c995945a450e0143"><div class="ttname"><a href="class_domain_list.html#acf99f56d23d0cb04c995945a450e0143">DomainList::domainListLevels</a></div><div class="ttdeci">integer * domainListLevels</div><div class="ttdoc">domain list node levels</div><div class="ttdef"><b>Definition:</b> <a href="subdomain_8cuh_source.html#l00355">subdomain.cuh:355</a></div></div>
<div class="ttc" id="aclass_domain_list_html_ad4e60b99aad7aa93c474a41e65ef5dc4"><div class="ttname"><a href="class_domain_list.html#ad4e60b99aad7aa93c474a41e65ef5dc4">DomainList::relevantDomainListIndices</a></div><div class="ttdeci">integer * relevantDomainListIndices</div><div class="ttdoc">concentrate domain list nodes, usable to reduce domain list indices in respect to some criterion</div><div class="ttdef"><b>Definition:</b> <a href="subdomain_8cuh_source.html#l00365">subdomain.cuh:365</a></div></div>
<div class="ttc" id="aclass_domain_list_html_add20616cc36fe06227783e938d2eb4e4"><div class="ttname"><a href="class_domain_list.html#add20616cc36fe06227783e938d2eb4e4">DomainList::domainListCounter</a></div><div class="ttdeci">integer * domainListCounter</div><div class="ttdoc">domain list node counter, usable as buffer</div><div class="ttdef"><b>Definition:</b> <a href="subdomain_8cuh_source.html#l00359">subdomain.cuh:359</a></div></div>
<div class="ttc" id="aclass_domain_list_html_ade39d9a1d5e58ea0e17b093e83fd0285"><div class="ttname"><a href="class_domain_list.html#ade39d9a1d5e58ea0e17b093e83fd0285">DomainList::relevantDomainListProcess</a></div><div class="ttdeci">integer * relevantDomainListProcess</div><div class="ttdef"><b>Definition:</b> <a href="subdomain_8cuh_source.html#l00369">subdomain.cuh:369</a></div></div>
<div class="ttc" id="aclass_domain_list_html_aeed50b7926680d21787841bb670a7b58"><div class="ttname"><a href="class_domain_list.html#aeed50b7926680d21787841bb670a7b58">DomainList::relevantDomainListLevels</a></div><div class="ttdeci">integer * relevantDomainListLevels</div><div class="ttdef"><b>Definition:</b> <a href="subdomain_8cuh_source.html#l00367">subdomain.cuh:367</a></div></div>
<div class="ttc" id="aclass_execution_policy_html"><div class="ttname"><a href="class_execution_policy.html">ExecutionPolicy</a></div><div class="ttdef"><b>Definition:</b> <a href="cuda__launcher_8cuh_source.html#l00013">cuda_launcher.cuh:13</a></div></div>
<div class="ttc" id="aclass_helper_html"><div class="ttname"><a href="class_helper.html">Helper</a></div><div class="ttdef"><b>Definition:</b> <a href="helper_8cuh_source.html#l00024">helper.cuh:24</a></div></div>
<div class="ttc" id="aclass_particles_html"><div class="ttname"><a href="class_particles.html">Particles</a></div><div class="ttdef"><b>Definition:</b> <a href="particles_8cuh_source.html#l00013">particles.cuh:13</a></div></div>
<div class="ttc" id="aclass_particles_html_a122a9985fed39c45d3a151dba2794299"><div class="ttname"><a href="class_particles.html#a122a9985fed39c45d3a151dba2794299">Particles::x</a></div><div class="ttdeci">real * x</div><div class="ttdoc">(pointer to) x position (array)</div><div class="ttdef"><b>Definition:</b> <a href="particles_8cuh_source.html#l00023">particles.cuh:23</a></div></div>
<div class="ttc" id="aclass_particles_html_a19adbbf68f6c36892dee44dd76a2b0d3"><div class="ttname"><a href="class_particles.html#a19adbbf68f6c36892dee44dd76a2b0d3">Particles::level</a></div><div class="ttdeci">integer * level</div><div class="ttdef"><b>Definition:</b> <a href="particles_8cuh_source.html#l00057">particles.cuh:57</a></div></div>
<div class="ttc" id="aclass_particles_html_a1fb75739bd93384823a2f8e958f59cbf"><div class="ttname"><a href="class_particles.html#a1fb75739bd93384823a2f8e958f59cbf">Particles::g_ay</a></div><div class="ttdeci">real * g_ay</div><div class="ttdoc">(pointer to) y gravitational acceleration (array)</div><div class="ttdef"><b>Definition:</b> <a href="particles_8cuh_source.html#l00049">particles.cuh:49</a></div></div>
<div class="ttc" id="aclass_particles_html_a2b2230019fb5f5e34d2ba256d9469272"><div class="ttname"><a href="class_particles.html#a2b2230019fb5f5e34d2ba256d9469272">Particles::nodeType</a></div><div class="ttdeci">integer * nodeType</div><div class="ttdef"><b>Definition:</b> <a href="particles_8cuh_source.html#l00056">particles.cuh:56</a></div></div>
<div class="ttc" id="aclass_particles_html_a745f3d6ed2124a0c2edb724231d555eb"><div class="ttname"><a href="class_particles.html#a745f3d6ed2124a0c2edb724231d555eb">Particles::y</a></div><div class="ttdeci">real * y</div><div class="ttdoc">(pointer to) y position (array)</div><div class="ttdef"><b>Definition:</b> <a href="particles_8cuh_source.html#l00030">particles.cuh:30</a></div></div>
<div class="ttc" id="aclass_particles_html_a9e1b9e80538c2b745216b67ae79fc66a"><div class="ttname"><a href="class_particles.html#a9e1b9e80538c2b745216b67ae79fc66a">Particles::u</a></div><div class="ttdeci">real * u</div><div class="ttdoc">energy (kinetic + gravitational for now)</div><div class="ttdef"><b>Definition:</b> <a href="particles_8cuh_source.html#l00077">particles.cuh:77</a></div></div>
<div class="ttc" id="aclass_particles_html_aa0081a57dbe2053fae1d331641d8bacd"><div class="ttname"><a href="class_particles.html#aa0081a57dbe2053fae1d331641d8bacd">Particles::g_ax</a></div><div class="ttdeci">real * g_ax</div><div class="ttdoc">(pointer to) x gravitational acceleration (array)</div><div class="ttdef"><b>Definition:</b> <a href="particles_8cuh_source.html#l00046">particles.cuh:46</a></div></div>
<div class="ttc" id="aclass_particles_html_ab65623c55daecdf520fe921621d57bf2"><div class="ttname"><a href="class_particles.html#ab65623c55daecdf520fe921621d57bf2">Particles::mass</a></div><div class="ttdeci">real * mass</div><div class="ttdoc">(pointer to) mass (array)</div><div class="ttdef"><b>Definition:</b> <a href="particles_8cuh_source.html#l00021">particles.cuh:21</a></div></div>
<div class="ttc" id="aclass_particles_html_abff3b199228c5f95c78d5e23ad64d2b3"><div class="ttname"><a href="class_particles.html#abff3b199228c5f95c78d5e23ad64d2b3">Particles::z</a></div><div class="ttdeci">real * z</div><div class="ttdoc">(pointer to) z position (array)</div><div class="ttdef"><b>Definition:</b> <a href="particles_8cuh_source.html#l00037">particles.cuh:37</a></div></div>
<div class="ttc" id="aclass_particles_html_ae00fcd5b4197a57b0a1112a7be4e8de0"><div class="ttname"><a href="class_particles.html#ae00fcd5b4197a57b0a1112a7be4e8de0">Particles::g_az</a></div><div class="ttdeci">real * g_az</div><div class="ttdoc">(pointer to) z gravitational acceleration (array)</div><div class="ttdef"><b>Definition:</b> <a href="particles_8cuh_source.html#l00052">particles.cuh:52</a></div></div>
<div class="ttc" id="aclass_sub_domain_key_tree_html"><div class="ttname"><a href="class_sub_domain_key_tree.html">SubDomainKeyTree</a></div><div class="ttdef"><b>Definition:</b> <a href="subdomain_8cuh_source.html#l00043">subdomain.cuh:43</a></div></div>
<div class="ttc" id="aclass_sub_domain_key_tree_html_a97cea9227718b239343d6964915015c0"><div class="ttname"><a href="class_sub_domain_key_tree.html#a97cea9227718b239343d6964915015c0">SubDomainKeyTree::key2proc</a></div><div class="ttdeci">CUDA_CALLABLE_MEMBER integer key2proc(keyType key)</div><div class="ttdef"><b>Definition:</b> <a href="subdomain_8cu_source.html#l00068">subdomain.cu:68</a></div></div>
<div class="ttc" id="aclass_sub_domain_key_tree_html_ad364fe0bf3c4c29e3e7c403e1fef200b"><div class="ttname"><a href="class_sub_domain_key_tree.html#ad364fe0bf3c4c29e3e7c403e1fef200b">SubDomainKeyTree::rank</a></div><div class="ttdeci">integer rank</div><div class="ttdoc">MPI rank.</div><div class="ttdef"><b>Definition:</b> <a href="subdomain_8cuh_source.html#l00047">subdomain.cuh:47</a></div></div>
<div class="ttc" id="aclass_tree_html"><div class="ttname"><a href="class_tree.html">Tree</a></div><div class="ttdef"><b>Definition:</b> <a href="tree_8cuh_source.html#l00121">tree.cuh:121</a></div></div>
<div class="ttc" id="acuda__utilities_8cuh_html_a0269abaf8e197ef5b7f85bd16c19bbf8"><div class="ttname"><a href="cuda__utilities_8cuh.html#a0269abaf8e197ef5b7f85bd16c19bbf8">cudaTerminate</a></div><div class="ttdeci">#define cudaTerminate(...)</div><div class="ttdef"><b>Definition:</b> <a href="cuda__utilities_8cuh_source.html#l00047">cuda_utilities.cuh:47</a></div></div>
<div class="ttc" id="acuda__utilities_8cuh_html_a18f09c8175084d073dc810de445cdf3e"><div class="ttname"><a href="cuda__utilities_8cuh.html#a18f09c8175084d073dc810de445cdf3e">cudaAssert</a></div><div class="ttdeci">#define cudaAssert(...)</div><div class="ttdef"><b>Definition:</b> <a href="cuda__utilities_8cuh_source.html#l00031">cuda_utilities.cuh:31</a></div></div>
<div class="ttc" id="amap__sph__to__grid_8c_html_af4846c5e98e425a34134b06275f0a109"><div class="ttname"><a href="map__sph__to__grid_8c.html#af4846c5e98e425a34134b06275f0a109">offset</a></div><div class="ttdeci">double offset[DIM]</div><div class="ttdef"><b>Definition:</b> <a href="map__sph__to__grid_8c_source.html#l00066">map_sph_to_grid.c:66</a></div></div>
<div class="ttc" id="anamespace_constants_html_ad17e79c3a9b2da663530274844d9f780"><div class="ttname"><a href="namespace_constants.html#ad17e79c3a9b2da663530274844d9f780">Constants::G</a></div><div class="ttdeci">constexpr real G</div><div class="ttdef"><b>Definition:</b> <a href="parameter_8h_source.html#l00117">parameter.h:117</a></div></div>
<div class="ttc" id="anamespace_domain_list_n_s_1_1_kernel_html_a262639b50010c293a6c60e75a020f106"><div class="ttname"><a href="namespace_domain_list_n_s_1_1_kernel.html#a262639b50010c293a6c60e75a020f106">DomainListNS::Kernel::lowestDomainList</a></div><div class="ttdeci">__global__ void lowestDomainList(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, DomainList *domainList, DomainList *lowestDomainList, integer n, integer m)</div><div class="ttdef"><b>Definition:</b> <a href="subdomain_8cu_source.html#l01610">subdomain.cu:1610</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_1_1_launch_html_a198b9af143d1ef344de44c826cd0fc04"><div class="ttname"><a href="namespace_gravity_1_1_kernel_1_1_launch.html#a198b9af143d1ef344de44c826cd0fc04">Gravity::Kernel::Launch::computeForces_v2_1</a></div><div class="ttdeci">real computeForces_v2_1(Tree *tree, Particles *particles, integer n, integer m, integer blockSize, integer warp, integer stackSize, SubDomainKeyTree *subDomainKeyTree, real theta, real smoothing, bool potentialEnergy=false)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01745">gravity.cu:1745</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_1_1_launch_html_a1ca32ecc459f70026dc7944d97d9a8c2"><div class="ttname"><a href="namespace_gravity_1_1_kernel_1_1_launch.html#a1ca32ecc459f70026dc7944d97d9a8c2">Gravity::Kernel::Launch::computeForces_v1</a></div><div class="ttdeci">real computeForces_v1(Tree *tree, Particles *particles, real radius, integer n, integer m, SubDomainKeyTree *subDomainKeyTree, real theta, real smoothing, bool potentialEnergy=false)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01702">gravity.cu:1702</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_1_1_launch_html_a34ede88c5a5ddb0e73b9e5989b68c143"><div class="ttname"><a href="namespace_gravity_1_1_kernel_1_1_launch.html#a34ede88c5a5ddb0e73b9e5989b68c143">Gravity::Kernel::Launch::testSendIndices</a></div><div class="ttdeci">real testSendIndices(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, integer *sendIndices, integer *markedSendIndices, integer *levels, Curve::Type curveType, integer length)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01694">gravity.cu:1694</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_1_1_launch_html_a36795d00ed812d043c266a9d527c0a9f"><div class="ttname"><a href="namespace_gravity_1_1_kernel_1_1_launch.html#a36795d00ed812d043c266a9d527c0a9f">Gravity::Kernel::Launch::compTheta</a></div><div class="ttdeci">real compTheta(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, DomainList *domainList, Helper *helper, Curve::Type curveType=Curve::lebesgue)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01784">gravity.cu:1784</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_1_1_launch_html_a59afdf774d13a5c8b08b792a52eea8ca"><div class="ttname"><a href="namespace_gravity_1_1_kernel_1_1_launch.html#a59afdf774d13a5c8b08b792a52eea8ca">Gravity::Kernel::Launch::intermediateSymbolicForce</a></div><div class="ttdeci">real intermediateSymbolicForce(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, DomainList *domainList, integer *sendIndices, real diam, real theta_, integer n, integer m, integer relevantIndex, integer level, Curve::Type curveType)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01766">gravity.cu:1766</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_1_1_launch_html_a5fd5374a87a91b5e8b83940227672932"><div class="ttname"><a href="namespace_gravity_1_1_kernel_1_1_launch.html#a5fd5374a87a91b5e8b83940227672932">Gravity::Kernel::Launch::collectSendIndices</a></div><div class="ttdeci">real collectSendIndices(Tree *tree, Particles *particles, integer *sendIndices, integer *particles2Send, integer *pseudoParticles2Send, integer *pseudoParticlesLevel, integer *particlesCount, integer *pseudoParticlesCount, integer n, integer length, Curve::Type curveType=Curve::lebesgue)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01683">gravity.cu:1683</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_1_1_launch_html_a6ff17bca5edbee4c81b7999a17f17850"><div class="ttname"><a href="namespace_gravity_1_1_kernel_1_1_launch.html#a6ff17bca5edbee4c81b7999a17f17850">Gravity::Kernel::Launch::symbolicForce</a></div><div class="ttdeci">real symbolicForce(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, DomainList *domainList, integer *sendIndices, real diam, real theta_, integer n, integer m, integer relevantIndex, integer level, Curve::Type curveType)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01775">gravity.cu:1775</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_1_1_launch_html_aa2529f45dcf03594d67a01c2ede5bb65"><div class="ttname"><a href="namespace_gravity_1_1_kernel_1_1_launch.html#aa2529f45dcf03594d67a01c2ede5bb65">Gravity::Kernel::Launch::insertReceivedParticles</a></div><div class="ttdeci">real insertReceivedParticles(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, DomainList *domainList, DomainList *lowestDomainList, int n, int m)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01805">gravity.cu:1805</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_1_1_launch_html_ac891e359f29fdcbe33413adc497a4e5f"><div class="ttname"><a href="namespace_gravity_1_1_kernel_1_1_launch.html#ac891e359f29fdcbe33413adc497a4e5f">Gravity::Kernel::Launch::computeForces_v2</a></div><div class="ttdeci">real computeForces_v2(Tree *tree, Particles *particles, real radius, integer n, integer m, integer blockSize, integer warp, integer stackSize, SubDomainKeyTree *subDomainKeyTree, real theta, real smoothing, bool potentialEnergy=false)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01732">gravity.cu:1732</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_1_1_launch_html_acbe6dfc65d9268a74a87f4dcc10f5100"><div class="ttname"><a href="namespace_gravity_1_1_kernel_1_1_launch.html#acbe6dfc65d9268a74a87f4dcc10f5100">Gravity::Kernel::Launch::insertReceivedPseudoParticles</a></div><div class="ttdeci">real insertReceivedPseudoParticles(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, integer *levels, int level, int n, int m)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01798">gravity.cu:1798</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_1_1_launch_html_ad7f1618337e772cbb6ad23ccfb23bc35"><div class="ttname"><a href="namespace_gravity_1_1_kernel_1_1_launch.html#ad7f1618337e772cbb6ad23ccfb23bc35">Gravity::Kernel::Launch::computeForces_v1_1</a></div><div class="ttdeci">real computeForces_v1_1(Tree *tree, Particles *particles, real radius, integer n, integer m, SubDomainKeyTree *subDomainKeyTree, real theta, real smoothing, bool potentialEnergy=false)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01712">gravity.cu:1712</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_1_1_launch_html_ae755581e4ba4428696a782705d779de3"><div class="ttname"><a href="namespace_gravity_1_1_kernel_1_1_launch.html#ae755581e4ba4428696a782705d779de3">Gravity::Kernel::Launch::computeForces_v1_2</a></div><div class="ttdeci">real computeForces_v1_2(Tree *tree, Particles *particles, real radius, integer n, integer m, SubDomainKeyTree *subDomainKeyTree, real theta, real smoothing, bool potentialEnergy=false)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01722">gravity.cu:1722</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_html_a1b8c1628c756822f843208ca4a63a024"><div class="ttname"><a href="namespace_gravity_1_1_kernel.html#a1b8c1628c756822f843208ca4a63a024">Gravity::Kernel::insertReceivedParticles</a></div><div class="ttdeci">__global__ void insertReceivedParticles(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, DomainList *domainList, DomainList *lowestDomainList, int n, int m)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01560">gravity.cu:1560</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_html_a2e0b258dbccbab147cbb5ec68b434bd3"><div class="ttname"><a href="namespace_gravity_1_1_kernel.html#a2e0b258dbccbab147cbb5ec68b434bd3">Gravity::Kernel::testSendIndices</a></div><div class="ttdeci">__global__ void testSendIndices(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, integer *sendIndices, integer *markedSendIndices, integer *levels, Curve::Type curveType, integer length)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l00053">gravity.cu:53</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_html_a5cdcecff7d038d21b4e7c86011843f3e"><div class="ttname"><a href="namespace_gravity_1_1_kernel.html#a5cdcecff7d038d21b4e7c86011843f3e">Gravity::Kernel::compTheta</a></div><div class="ttdeci">__global__ void compTheta(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, DomainList *domainList, Helper *helper, Curve::Type curveType=Curve::lebesgue)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01292">gravity.cu:1292</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_html_a700b862d81747a6140b7af269c3cee16"><div class="ttname"><a href="namespace_gravity_1_1_kernel.html#a700b862d81747a6140b7af269c3cee16">Gravity::Kernel::computeForces_v2</a></div><div class="ttdeci">__global__ void computeForces_v2(Tree *tree, Particles *particles, real radius, integer n, integer m, integer blockSize, integer warp, integer stackSize, SubDomainKeyTree *subDomainKeyTree, real theta, real smoothing, bool potentialEnergy=false)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l00655">gravity.cu:655</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_html_a717dff3559e55e15c1f94e10eae1d16e"><div class="ttname"><a href="namespace_gravity_1_1_kernel.html#a717dff3559e55e15c1f94e10eae1d16e">Gravity::Kernel::computeForces_v1_1</a></div><div class="ttdeci">__global__ void computeForces_v1_1(Tree *tree, Particles *particles, real radius, integer n, integer m, SubDomainKeyTree *subDomainKeyTree, real theta, real smoothing, bool potentialEnergy=false)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l00342">gravity.cu:342</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_html_a962bb4ab459204c7236171ae3523e871"><div class="ttname"><a href="namespace_gravity_1_1_kernel.html#a962bb4ab459204c7236171ae3523e871">Gravity::Kernel::intermediateSymbolicForce</a></div><div class="ttdeci">__global__ void intermediateSymbolicForce(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, DomainList *domainList, integer *sendIndices, real diam, real theta_, integer n, integer m, integer relevantIndex, integer level, Curve::Type curveType)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01005">gravity.cu:1005</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_html_aab6c8bfe6472b2584544b0af06dfd150"><div class="ttname"><a href="namespace_gravity_1_1_kernel.html#aab6c8bfe6472b2584544b0af06dfd150">Gravity::Kernel::computeForces_v1_2</a></div><div class="ttdeci">__global__ void computeForces_v1_2(Tree *tree, Particles *particles, real radius, integer n, integer m, SubDomainKeyTree *subDomainKeyTree, real theta, real smoothing, bool potentialEnergy=false)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l00479">gravity.cu:479</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_html_ab82c5727eb23d566faca7ff2460b8b94"><div class="ttname"><a href="namespace_gravity_1_1_kernel.html#ab82c5727eb23d566faca7ff2460b8b94">Gravity::Kernel::collectSendIndices</a></div><div class="ttdeci">__global__ void collectSendIndices(Tree *tree, Particles *particles, integer *sendIndices, integer *particles2Send, integer *pseudoParticles2Send, integer *pseudoParticlesLevel, integer *particlesCount, integer *pseudoParticlesCount, integer n, integer length, Curve::Type curveType)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l00008">gravity.cu:8</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_html_ac5da3a1e3c2a9de7f4ddb53a98814c7e"><div class="ttname"><a href="namespace_gravity_1_1_kernel.html#ac5da3a1e3c2a9de7f4ddb53a98814c7e">Gravity::Kernel::insertReceivedPseudoParticles</a></div><div class="ttdeci">__global__ void insertReceivedPseudoParticles(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, integer *levels, int level, int n, int m)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01336">gravity.cu:1336</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_html_ad044343bcb2d7ed50e294f60c308d585"><div class="ttname"><a href="namespace_gravity_1_1_kernel.html#ad044343bcb2d7ed50e294f60c308d585">Gravity::Kernel::symbolicForce</a></div><div class="ttdeci">__global__ void symbolicForce(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, DomainList *domainList, integer *sendIndices, real diam, real theta_, integer n, integer m, integer relevantIndex, integer level, Curve::Type curveType)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l01026">gravity.cu:1026</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_html_aed59991b3f4e4a8893656f2c1bce363a"><div class="ttname"><a href="namespace_gravity_1_1_kernel.html#aed59991b3f4e4a8893656f2c1bce363a">Gravity::Kernel::computeForces_v1</a></div><div class="ttdeci">__global__ void computeForces_v1(Tree *tree, Particles *particles, real radius, integer n, integer m, SubDomainKeyTree *subDomainKeyTree, real theta, real smoothing, bool potentialEnergy=false)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l00202">gravity.cu:202</a></div></div>
<div class="ttc" id="anamespace_gravity_1_1_kernel_html_afe9543ee9b2e06c705b1a087b3f6b94a"><div class="ttname"><a href="namespace_gravity_1_1_kernel.html#afe9543ee9b2e06c705b1a087b3f6b94a">Gravity::Kernel::computeForces_v2_1</a></div><div class="ttdeci">__global__ void computeForces_v2_1(Tree *tree, Particles *particles, integer n, integer m, integer blockSize, integer warp, integer stackSize, SubDomainKeyTree *subDomainKeyTree, real theta, real smoothing, bool potentialEnergy=false)</div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cu_source.html#l00834">gravity.cu:834</a></div></div>
<div class="ttc" id="anamespace_gravity_html"><div class="ttname"><a href="namespace_gravity.html">Gravity</a></div><div class="ttdef"><b>Definition:</b> <a href="gravity_8cuh_source.html#l00014">gravity.cuh:14</a></div></div>
<div class="ttc" id="anamespace_kernel_html"><div class="ttname"><a href="namespace_kernel.html">Kernel</a></div><div class="ttdef"><b>Definition:</b> <a href="device__rhs_8cuh_source.html#l00007">device_rhs.cuh:7</a></div></div>
<div class="ttc" id="anamespace_profiler_ids_1_1_time_1_1_gravity_html_ab6304a139223271c365e18efb53ec96b"><div class="ttname"><a href="namespace_profiler_ids_1_1_time_1_1_gravity.html#ab6304a139223271c365e18efb53ec96b">ProfilerIds::Time::Gravity::insertReceivedParticles</a></div><div class="ttdeci">const char *const insertReceivedParticles</div><div class="ttdef"><b>Definition:</b> <a href="h5profiler_8h_source.html#l00079">h5profiler.h:79</a></div></div>
<div class="ttc" id="anamespace_profiler_ids_1_1_time_1_1_gravity_html_ad0f2afd7681e736fa00ce800a55225d9"><div class="ttname"><a href="namespace_profiler_ids_1_1_time_1_1_gravity.html#ad0f2afd7681e736fa00ce800a55225d9">ProfilerIds::Time::Gravity::insertReceivedPseudoParticles</a></div><div class="ttdeci">const char *const insertReceivedPseudoParticles</div><div class="ttdef"><b>Definition:</b> <a href="h5profiler_8h_source.html#l00078">h5profiler.h:78</a></div></div>
<div class="ttc" id="anamespace_profiler_ids_1_1_time_html_a6bc176ffe75049b4b899b6a019bf15e9"><div class="ttname"><a href="namespace_profiler_ids_1_1_time.html#a6bc176ffe75049b4b899b6a019bf15e9">ProfilerIds::Time::tree</a></div><div class="ttdeci">const char *const tree</div><div class="ttdef"><b>Definition:</b> <a href="h5profiler_8h_source.html#l00045">h5profiler.h:45</a></div></div>
<div class="ttc" id="anamespace_s_p_h_1_1_kernel_html_a89b6537f53e3271b87059b7be0d844ee"><div class="ttname"><a href="namespace_s_p_h_1_1_kernel.html#a89b6537f53e3271b87059b7be0d844ee">SPH::Kernel::particles2Send</a></div><div class="ttdeci">__global__ void particles2Send(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, DomainList *domainList, DomainList *lowestDomainList, integer maxLevel, integer *toSend, integer *sendCount, integer *alreadyInserted, integer insertOffset, integer numParticlesLocal, integer numParticles, integer numNodes, real radius, Curve::Type curveType=Curve::lebesgue)</div><div class="ttdef"><b>Definition:</b> <a href="sph_8cu_source.html#l01276">sph.cu:1276</a></div></div>
<div class="ttc" id="anamespacecuda_1_1math_html_a19175dcfac61c20c0914751a44bee73a"><div class="ttname"><a href="namespacecuda_1_1math.html#a19175dcfac61c20c0914751a44bee73a">cuda::math::rsqrt</a></div><div class="ttdeci">__device__ real rsqrt(real a)</div><div class="ttdef"><b>Definition:</b> <a href="cuda__utilities_8cu_source.html#l00464">cuda_utilities.cu:464</a></div></div>
<div class="ttc" id="anamespacecuda_1_1math_html_a706200a3f1b2445d7fd835c2ac504a11"><div class="ttname"><a href="namespacecuda_1_1math.html#a706200a3f1b2445d7fd835c2ac504a11">cuda::math::sqrt</a></div><div class="ttdeci">__device__ real sqrt(real a)</div><div class="ttdef"><b>Definition:</b> <a href="cuda__utilities_8cu_source.html#l00456">cuda_utilities.cu:456</a></div></div>
<div class="ttc" id="anamespacecuda_1_1math_html_ae45b7a0e96687aa98c58a3ee386b2ada"><div class="ttname"><a href="namespacecuda_1_1math.html#ae45b7a0e96687aa98c58a3ee386b2ada">cuda::math::max</a></div><div class="ttdeci">__device__ real max(real a, real b)</div><div class="ttdef"><b>Definition:</b> <a href="cuda__utilities_8cu_source.html#l00431">cuda_utilities.cu:431</a></div></div>
<div class="ttc" id="anamespacecuda_html_ae129f267f2d83118533c78c712265b58"><div class="ttname"><a href="namespacecuda.html#ae129f267f2d83118533c78c712265b58">cuda::launch</a></div><div class="ttdeci">real launch(bool timeKernel, const ExecutionPolicy &amp;policy, void(*f)(Arguments...), Arguments... args)</div><div class="ttdef"><b>Definition:</b> <a href="cuda__launcher_8cuh_source.html#l00054">cuda_launcher.cuh:54</a></div></div>
<div class="ttc" id="aparallel_force_concept_8cpp_html_a525c7922f7ca729e0735918e0f639bb7"><div class="ttname"><a href="parallel_force_concept_8cpp.html#a525c7922f7ca729e0735918e0f639bb7">compTheta</a></div><div class="ttdeci">__global__ void compTheta(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, DomainList *domainList, Helper *helper, Curve::Type curveType)</div><div class="ttdef"><b>Definition:</b> <a href="parallel_force_concept_8cpp_source.html#l00010">parallelForceConcept.cpp:10</a></div></div>
<div class="ttc" id="aparallel_force_concept_8cpp_html_a5ad90577a90240259fc6ba230b4f276c"><div class="ttname"><a href="parallel_force_concept_8cpp.html#a5ad90577a90240259fc6ba230b4f276c">symbolicForce</a></div><div class="ttdeci">__global__ void symbolicForce(SubDomainKeyTree *subDomainKeyTree, Tree *tree, Particles *particles, DomainList *domainList, integer *sendIndices, real diam, real theta_, integer n, integer m, integer relevantIndex, Curve::Type curveType)</div><div class="ttdef"><b>Definition:</b> <a href="parallel_force_concept_8cpp_source.html#l00064">parallelForceConcept.cpp:64</a></div></div>
<div class="ttc" id="aparameter_8h_html_a11d147c64891830c9e79b3315b1b2e21"><div class="ttname"><a href="parameter_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a></div><div class="ttdeci">double real</div><div class="ttdef"><b>Definition:</b> <a href="parameter_8h_source.html#l00015">parameter.h:15</a></div></div>
<div class="ttc" id="aparameter_8h_html_a2d83a9d6677f42e2572510c1a14e58ed"><div class="ttname"><a href="parameter_8h.html#a2d83a9d6677f42e2572510c1a14e58ed">keyType</a></div><div class="ttdeci">unsigned long keyType</div><div class="ttdef"><b>Definition:</b> <a href="parameter_8h_source.html#l00018">parameter.h:18</a></div></div>
<div class="ttc" id="aparameter_8h_html_a3b6ee100a473e8866bcea6d1fc4041d9"><div class="ttname"><a href="parameter_8h.html#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a></div><div class="ttdeci">int integer</div><div class="ttdef"><b>Definition:</b> <a href="parameter_8h_source.html#l00017">parameter.h:17</a></div></div>
<div class="ttc" id="aparameter_8h_html_a5bb4257ca9fa4bfcf9391b7895b97761"><div class="ttname"><a href="parameter_8h.html#a5bb4257ca9fa4bfcf9391b7895b97761">MAX_LEVEL</a></div><div class="ttdeci">#define MAX_LEVEL</div><div class="ttdef"><b>Definition:</b> <a href="parameter_8h_source.html#l00025">parameter.h:25</a></div></div>
<div class="ttc" id="aparameter_8h_html_a5db49eeef5c9bb774f02996f684df238"><div class="ttname"><a href="parameter_8h.html#a5db49eeef5c9bb774f02996f684df238">MAX_DEPTH</a></div><div class="ttdeci">#define MAX_DEPTH</div><div class="ttdef"><b>Definition:</b> <a href="parameter_8h_source.html#l00103">parameter.h:103</a></div></div>
<div class="ttc" id="aparameter_8h_html_aaf01a8b5289af20025d06e3fed70cc94"><div class="ttname"><a href="parameter_8h.html#aaf01a8b5289af20025d06e3fed70cc94">POW_DIM</a></div><div class="ttdeci">#define POW_DIM</div><div class="ttdef"><b>Definition:</b> <a href="parameter_8h_source.html#l00040">parameter.h:40</a></div></div>
<div class="ttc" id="astruct_curve_html_a4269858acf8d67e3cd222466771848b9"><div class="ttname"><a href="struct_curve.html#a4269858acf8d67e3cd222466771848b9">Curve::Type</a></div><div class="ttdeci">Type</div><div class="ttdef"><b>Definition:</b> <a href="parameter_8h_source.html#l00203">parameter.h:204</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
  <hr class="footer"/><address class="footer"><small>
    milupHPC  - src/gravity/gravity.cu Source File<br />
    Generated on Tue Feb 15 2022 17:15:50 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.9.3
  </small></address>
</body>
<footer>
  <custom-footer color="white" background="#2E4053">
    <div first>first: more content to add</div>
    <div second>second: bla bla bla</div>
    <div third>third: more content to add</div>
  </custom-footer>
</footer>
<!--
<script src="components/side-nav/runtime.js" type="module"></script><script src="components/side-nav/polyfills.js" type="module"></script><script src="components/side-nav/main.js" type="module"></script>
-->
<script src="components/hamburger/runtime.js" type="module"></script><script src="components/hamburger/polyfills.js" type="module"></script><script src="components/hamburger/main.js" type="module"></script>
<script src="components/header/runtime.js" type="module"></script><script src="components/header/polyfills.js" type="module"></script><script src="components/header/main.js" type="module"></script>
<script src="components/icons/runtime.js" type="module"></script><script src="components/icons/polyfills.js" type="module"></script><script src="components/icons/main.js" type="module"></script>
<script src="components/footer/runtime.js" type="module"></script><script src="components/footer/polyfills.js" type="module"></script><script src="components/footer/main.js" type="module"></script>
<script src="components/dialog/runtime.js" type="module"></script><script src="components/dialog/polyfills.js" type="module"></script><script src="components/dialog/main.js" type="module"></script>
<script src="components/copyable/runtime.js" type="module"></script><script src="components/copyable/polyfills.js" type="module"></script><script src="components/copyable/main.js" type="module"></script>
<script>
  function toggle() {
    var elem = document.getElementById("side-nav");
    console.log(elem);
    elem.toggleSideNav(false);
  }
</script>
<!--
<script>
  function topFunction() {
    document.body.scrollTop = 0; // For Safari
    document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
  }
</script>
-->
</html>