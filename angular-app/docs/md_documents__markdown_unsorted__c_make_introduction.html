<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>CodePortray</title>
	<base href="/">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--
	<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=9"/>
	-->
	<meta name="generator" content="Doxygen 1.9.3"/>
	<title>milupHPC: CMake</title>
	<title>CMake</title>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Alata&amp;display=swap" rel="stylesheet">
	<link rel="stylesheet" href="components/side-nav/styles.css">
	<link rel="stylesheet" href="components/hamburger/styles.css">
	<link rel="stylesheet" href="components/header/styles.css">
	<link rel="stylesheet" href="components/icons/styles.css">
	<link rel="stylesheet" href="components/dialog/styles.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link href="tabs.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
	<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
	<link href="doxygen-custom.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<custom-header class="custom-header-class">
		<custom-hamburger menu onclick="toggle()"></custom-hamburger>
		<div shortcuts>
			<a href="https://www.google.com"><custom-icon icon="facebook" color="white" background="#3B5998"></custom-icon></a>
			<a href="https://www.google.com"><custom-icon icon="twitter" color="white" background="#55ACEE"></custom-icon></a>
			<a href="https://www.google.com"><custom-icon icon="youtube" color="white" background="#DB0000"></custom-icon></a>
			<a href="https://www.google.com"><custom-icon icon="linkedin" color="white" background="#3B67BE"></custom-icon></a>
			<!--<a href="https://www.google.com"><custom-icon icon="share-alt" color="white" background="darkgrey"></custom-icon></a>-->
			<custom-dialog window-width="600px" window-height="400px">
				<div open><custom-icon icon="share-alt" color="white" background="darkgrey"></custom-icon></div>
				<div>test 1</div>
				<div>test 2</div>
				<div>test 3</div>
				<div>test 4</div>
			</custom-dialog>
			<a href="https://www.google.com"><custom-icon icon="github" color="white" background="#2A2D32"></custom-icon></a>
			<a href="https://www.google.com"><custom-icon icon="university" color="white" background="#8D2439"></custom-icon></a>
			<a href="https://www.google.com"><custom-icon icon="wikipedia-w" color="black" background="lightgrey"></custom-icon></a>
			<a href="https://www.google.com"><custom-icon icon="slack" color="white" background="#421B4B"></custom-icon></a>
			<a href="https://www.google.com"><custom-icon icon="home" color="white" background="black"></custom-icon></a>
			<a href="https://www.google.com"><custom-icon icon="cogs" color="white" background="black"></custom-icon></a>
			<a href="https://www.google.com"><custom-icon icon="bars" color="white" background="black"></custom-icon></a>
			<a href="https://www.google.com"><custom-icon icon="code" color="white" background="black"></custom-icon></a>
			<a href="https://www.google.com"><custom-icon icon="terminal" color="white" background="black"></custom-icon></a>
		</div>
	</custom-header>
	<!--
	<custom-side-nav id="side-nav" nav-width="300">
		<custom-icon url="https://www.google.com" icon="code" color="white" background="black"></custom-icon>
		<div>test</div>
	</custom-side-nav>
	-->
	<div id="banner">
		<div class="logo">
			<span class="subtitle">
				milupHPC documentation
			</span>
		</div>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">CMake </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md74"></a>
Links</h1>
<ul>
<li><a href="https://gitlab.kitware.com/cmake/cmake">Repository</a></li>
<li><a href="https://github.com/onqtam/awesome-cmake">Awesome-CMake list</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md75"></a>
Documentation</h2>
<ul>
<li><a href="https://cmake.org/cmake/help/v3.19/">CMake official documentation</a><ul>
<li><a href="https://cmake.org/cmake/help/latest/manual/cmake-commands.7.html">CMake commands</a></li>
<li><a href="https://cmake.org/cmake/help/latest/manual/cmake-env-variables.7.html">CMake environmental variables</a></li>
<li>...</li>
</ul>
</li>
<li><a href="http://www.aosabook.org/en/cmake.html">The Architecture of Open Source Applications</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md76"></a>
Tutorials, Guides &amp; Instructions</h2>
<ul>
<li><a href="https://gist.github.com/mbinna/c61dbb39bca0e4fb7d1f73b0d66a4fd1">Effective Modern CMake (Dos &amp; Don'ts)</a></li>
<li><a href="https://cliutils.gitlab.io/modern-cmake/">GitBook: Introduction to Modern CMake</a></li>
<li><a href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">Official CMake Tutorial</a></li>
<li><a href="https://cmake.org/cmake/help/latest/guide/user-interaction/index.html">CMake User Interaction Guide</a></li>
<li><a href="https://github.com/dev-cafe/cmake-cookbook">CMake Cookbook</a></li>
<li><a href="https://llvm.org/docs/CMakePrimer.html">CMake Primer</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md77"></a>
Videos</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=HPMvU64RUTY">Intro to CMake</a></li>
<li><a href="https://www.youtube.com/watch?v=eC9-iRN2b04">Using Modern CMake Patterns to Enforce a Good Modular Design</a></li>
<li><a href="https://www.youtube.com/watch?v=bsXLMQ6WgIk">Effective CMake</a></li>
<li><a href="https://www.youtube.com/watch?v=JsjI5xr1jxM">Embracing Modern CMake</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md78"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md79"></a>
Command line tools &amp; Interactive Dialogs</h2>
<h3><a class="anchor" id="autotoc_md80"></a>
cmake</h3>
<p >The <a href="https://cmake.org/cmake/help/latest/manual/cmake.1.html">cmake</a> executable is the command-line interface of the cross-platform buildsystem generator <em>CMake</em>.</p>
<div class="fragment"><div class="line"># Generate a Project Buildsystem</div>
<div class="line">cmake [&lt;options&gt;] &lt;path-to-source&gt;</div>
<div class="line">cmake [&lt;options&gt;] &lt;path-to-existing-build&gt;</div>
<div class="line">cmake [&lt;options&gt;] -S &lt;path-to-source&gt; -B &lt;path-to-build&gt;</div>
<div class="line"># Build a Project</div>
<div class="line">cmake --build &lt;dir&gt; [&lt;options&gt;] [-- &lt;build-tool-options&gt;]</div>
<div class="line"># Install a Project</div>
<div class="line">cmake --install &lt;dir&gt; [&lt;options&gt;]</div>
<div class="line"># Open a Project</div>
<div class="line">cmake --open &lt;dir&gt;</div>
<div class="line"># Run a Script</div>
<div class="line">cmake [{-D &lt;var&gt;=&lt;value&gt;}...] -P &lt;cmake-script-file&gt;</div>
<div class="line"># Run a Command-Line Tool</div>
<div class="line">cmake -E &lt;command&gt; [&lt;options&gt;]</div>
<div class="line"># Run the Find-Package Tool</div>
<div class="line">cmake --find-package [&lt;options&gt;]</div>
<div class="line"># View Help</div>
<div class="line">cmake --help[-&lt;topic&gt;]</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md81"></a>
ctest</h3>
<p >The <a href="https://cmake.org/cmake/help/latest/manual/ctest.1.html">ctest</a> executable is the CMake test driver program. Build trees using <code>enable_testing()</code> and <code>add_test</code> have testing support.</p>
<div class="fragment"><div class="line">ctest [&lt;options&gt;]</div>
<div class="line">ctest --build-and-test &lt;path-to-source&gt; &lt;path-to-build&gt;</div>
<div class="line">      --build-generator &lt;generator&gt; [&lt;options&gt;...]</div>
<div class="line">      [--build-options &lt;opts&gt;...] [--test-command &lt;command&gt; [&lt;args&gt;...]]</div>
<div class="line">ctest {-D &lt;dashboard&gt; | -M &lt;model&gt; -T &lt;action&gt; | -S &lt;script&gt; | -SP &lt;script&gt;}</div>
<div class="line">      [-- &lt;dashboard-options&gt;...]</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md82"></a>
cpack</h3>
<p >The <a href="https://cmake.org/cmake/help/latest/manual/cpack.1.html">cpack</a> executable is the CMake packaging program, generating installers and source packages in a variety of formats.</p>
<div class="fragment"><div class="line">cpack [&lt;options&gt;]</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md83"></a>
ccmake</h3>
<p >The <a href="https://cmake.org/cmake/help/latest/manual/ccmake.1.html">ccmake</a> executable is the CMake curses interface enabling to configure settings interactively through this GUI.</p>
<div class="fragment"><div class="line">ccmake [&lt;options&gt;] {&lt;path-to-source&gt; | &lt;path-to-existing-build&gt;}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md84"></a>
cmake-gui</h3>
<p >The <a href="https://cmake.org/cmake/help/latest/manual/cmake-gui.1.html">cmake-gui</a> executable is the CMake GUI.</p>
<div class="fragment"><div class="line">cmake-gui [&lt;options&gt;]</div>
<div class="line">cmake-gui [&lt;options&gt;] {&lt;path-to-source&gt; | &lt;path-to-existing-build&gt;}</div>
<div class="line">cmake-gui [&lt;options&gt;] -S &lt;path-to-source&gt; -B &lt;path-to-build&gt;</div>
<div class="line">cmake-gui [&lt;options&gt;] --browse-manual</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md85"></a>
Basics</h1>
<h2><a class="anchor" id="autotoc_md86"></a>
CMake Version</h2>
<div class="fragment"><div class="line">#minmum CMake version</div>
<div class="line">cmake_minimum_required(VERSION 3.12)</div>
<div class="line">if(${CMAKE_VERSION} VERSION_LESS 3.12)</div>
<div class="line">    cmake_policy(VERSION ${CMAKE_MAJOR_VERSION}.${CMAKE_MINOR_VERSION})</div>
<div class="line">endif()</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md87"></a>
VARIABLES</h2>
<p >See <a href="https://cmake.org/cmake/help/latest/manual/cmake-variables.7.html">CMake variables</a></p>
<div class="fragment"><div class="line"># Local variable</div>
<div class="line">set(MY_VARIABLE &quot;value&quot;)</div>
<div class="line">set(MY_LIST &quot;one&quot; &quot;two&quot;)</div>
<div class="line"># Cache variable</div>
<div class="line">set(MY_CACHE_VARIABLE &quot;VALUE&quot; CACHE STRING &quot;Description&quot;)</div>
<div class="line"># Environmental variables</div>
<div class="line">set(ENV{variable_name} value) #access via $ENV{variable_name}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md88"></a>
PROPERTIES</h2>
<p >See <a href="https://cmake.org/cmake/help/latest/manual/cmake-properties.7.html">CMake properties</a></p>
<div class="fragment"><div class="line">set_property(TARGET TargetName PROPERTY CXX_STANDARD 11)</div>
<div class="line">set_target_properties(TargetName PROPERTIES CXX_STANDARD 11)</div>
<div class="line">get_property(ResultVariable TARGET TargetName PROPERTY CXX_STANDARD)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md89"></a>
Output folders</h2>
<div class="fragment"><div class="line"># set output folders</div>
<div class="line">set(PROJECT_SOURCE_DIR)</div>
<div class="line">set(CMAKE_SOURCE_DIR ...)</div>
<div class="line">set(CMAKE_BINARY_DIR ${CMAKE_SOURCE_DIR}$/bin)</div>
<div class="line">set(EXECUTABLE_OUTPUT_PATH ${CMAKE_BINARY_DIR})</div>
<div class="line">set(LIBRARY_OUTPUT_PATH ${CMAKE_BINARY_DIR})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md90"></a>
Sources</h2>
<div class="fragment"><div class="line"># set sources</div>
<div class="line">set(SOURCES example.cu)</div>
<div class="line">file(GLOB SOURCES *.cu)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md91"></a>
Executables &amp; targets</h2>
<p >Add executable/create target:</p>
<div class="fragment"><div class="line">#add_executable(example ${PROJECT_SOURCE_DIR}/example.cu)</div>
<div class="line">add_executable(miluphcuda ${SOURCES})</div>
</div><!-- fragment --><div class="fragment"><div class="line"># add include directory to target</div>
<div class="line">target_include_directories(miluphcdua PUBLIC include) #PUBLIC/PRIVATE/INTERFACE</div>
<div class="line"># add compile feature to target</div>
<div class="line">target_compile_features(miluphcuda PUBLIC cxx_std_11)</div>
</div><!-- fragment --><div class="fragment"><div class="line"># chain targets (assume &quot;another&quot; is a target)</div>
<div class="line">add_library(another STATIC another.cpp another.h)</div>
<div class="line">target_link_libraries(another PUBLIC miluphcuda)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md92"></a>
PROGRAMMING IN CMAKE</h2>
<p >See <a href="https://cmake.org/cmake/help/latest/manual/cmake-language.7.html">the CMake language</a> and <a href="https://cmake.org/cmake/help/latest/manual/cmake-commands.7.html">CMake commands</a></p>
<p >Keywords:</p>
<ul>
<li>NOT</li>
<li>TARGET</li>
<li>EXISTS</li>
<li>DEFINED</li>
<li>STREQUAL</li>
<li>AND</li>
<li>OR</li>
<li>MATCHES</li>
<li>...</li>
</ul>
<h3><a class="anchor" id="autotoc_md93"></a>
Control flow</h3>
<div class="fragment"><div class="line">if(variable)</div>
<div class="line">    # If variable is `ON`, `YES`, `TRUE`, `Y`, or non zero number</div>
<div class="line">else()</div>
<div class="line">    # If variable is `0`, `OFF`, `NO`, `FALSE`, `N`, `IGNORE`, `NOTFOUND`, `&quot;&quot;`, or ends in `-NOTFOUND`</div>
<div class="line">#endif()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md94"></a>
Loops</h3>
<ul>
<li><code>foreach(var IN ITEMS foo bar baz) ... endforeach()</code></li>
<li><code>foreach(var IN LISTS my_list) ... endforeach()</code></li>
<li><code>foreach(var IN LISTS my_list ITEMS foo bar baz) ... endforeach</code></li>
<li><code>while() ... endwhile()</code></li>
</ul>
<p >Within loops</p>
<ul>
<li><code>break()</code></li>
<li><code>continue()</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md95"></a>
Generator expression</h3>
<p >See <a href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html">CMake generator expressions</a></p>
<div class="fragment"><div class="line">target_include_directories(</div>
<div class="line">        MyTarget</div>
<div class="line">        PUBLIC</div>
<div class="line">        $&lt;BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include&gt;</div>
<div class="line">        $&lt;INSTALL_INTERFACE:include&gt;</div>
<div class="line">)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md96"></a>
Functions (&amp; macros)</h3>
<div class="fragment"><div class="line">function(SIMPLE REQUIRED_ARG)</div>
<div class="line">    message(STATUS &quot;Simple arguments: ${REQUIRED_ARG}, followed by ${ARGV}&quot;)</div>
<div class="line">    set(${REQUIRED_ARG} &quot;From SIMPLE&quot; PARENT_SCOPE)</div>
<div class="line">endfunction()</div>
<div class="line">simple(This)</div>
<div class="line">message(&quot;Output: ${This}&quot;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md97"></a>
COMMUNICATION WITH CODE</h2>
<h3><a class="anchor" id="autotoc_md98"></a>
Configure File</h3>
<div class="fragment"><div class="line">configure_file()</div>
<div class="line">...</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md99"></a>
Reading files</h3>
<div class="fragment"><div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md100"></a>
RUNNING OTHER PROGRAMS</h2>
<h3><a class="anchor" id="autotoc_md101"></a>
command at configure time</h3>
<div class="fragment"><div class="line">find_package(Git QUIET)</div>
<div class="line">if(GIT_FOUND AND EXISTS &quot;${PROJECT_SOURCE_DIR}/.git&quot;)</div>
<div class="line">    execute_process(COMMAND ${GIT_EXECUTABLE} submodule update --init --recursive</div>
<div class="line">            WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}</div>
<div class="line">            RESULT_VARIABLE GIT_SUBMOD_RESULT)</div>
<div class="line">    if(NOT GIT_SUBMOD_RESULT EQUAL &quot;0&quot;)</div>
<div class="line">        message(FATAL_ERROR &quot;git submodule update --init failed with ${GIT_SUBMOD_RESULT}, please checkout submodules&quot;)</div>
<div class="line">    endif()</div>
<div class="line">endif()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md102"></a>
command at build time</h3>
<div class="fragment"><div class="line">find_package(PythonInterp REQUIRED)</div>
<div class="line">add_custom_command(OUTPUT &quot;${CMAKE_CURRENT_BINARY_DIR}/include/Generated.hpp&quot;</div>
<div class="line">        COMMAND &quot;${PYTHON_EXECUTABLE}&quot; &quot;${CMAKE_CURRENT_SOURCE_DIR}/scripts/GenerateHeader.py&quot; --argument</div>
<div class="line">        DEPENDS some_target)</div>
<div class="line">add_custom_target(generate_header ALL</div>
<div class="line">        DEPENDS &quot;${CMAKE_CURRENT_BINARY_DIR}/include/Generated.hpp&quot;)</div>
<div class="line">install(FILES ${CMAKE_CURRENT_BINARY_DIR}/include/Generated.hpp DESTINATION include)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md103"></a>
Libraries</h1>
<div class="fragment"><div class="line"># make a library</div>
<div class="line">add_library(one STATIC two.cpp three.h) # STATIC/SHARED/MODULE</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md104"></a>
Policies</h1>
<p ><a href="https://cmake.org/cmake/help/v3.0/manual/cmake-policies.7.html">CMake policies</a> is how CMake implements backward compability.</p>
<p >CMake policies know two states</p>
<ul>
<li><b>old</b>: makes CMake revert to old behaviour (existed before introduction of the policy)</li>
<li><b>new</b>: makes CMake use the new behavior that is considered correct and prefered</li>
</ul>
<h1><a class="anchor" id="autotoc_md105"></a>
Language/Package related</h1>
<h2><a class="anchor" id="autotoc_md106"></a>
C</h2>
<div class="fragment"><div class="line"># set C compiler</div>
<div class="line">set(CMAKE_C_COMPILER &quot;/usr/bin/gcc-7&quot;)</div>
<div class="line">execute_process (</div>
<div class="line">        COMMAND bash -c &quot;git describe --abbrev=4 --dirty --always --tags&#39;&quot;</div>
<div class="line">        OUTPUT_VARIABLE GIT_VERSION</div>
<div class="line">)</div>
</div><!-- fragment --><div class="fragment"><div class="line">#set(CMAKE_BUILD_TYPE DEBUG)</div>
<div class="line">set(CMAKE_C_FLAGS &quot;-c -std=c99 -O3 -DVERSION=\&quot;${GIT_VERSION})\&quot; -fPIC&quot;)</div>
<div class="line">#set(CMAKE_C_FLAGS_DEBUG &quot;-O0 -ggdb&quot;)</div>
<div class="line">#set(CMAKE_C_FLAGS_RELEASE &quot;-O0 -ggdb&quot;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md107"></a>
C++</h2>
<p >...</p>
<h2><a class="anchor" id="autotoc_md108"></a>
CUDA</h2>
<p >See <a href="https://on-demand.gputechconf.com/gtc/2017/presentation/S7438-robert-maynard-build-systems-combining-cuda-and-machine-learning.pdf">Combining CUDA and Modern CMake</a></p>
<h3><a class="anchor" id="autotoc_md109"></a>
Enable Cuda support</h3>
<p >CUDA is not optional</p>
<div class="fragment"><div class="line">project(MY_PROJECT LANGUAGES CUDA CXX)</div>
</div><!-- fragment --><p >CUDA is optional</p>
<div class="fragment"><div class="line">enable_language(CUDA)</div>
</div><!-- fragment --><p >Check whether CUDA is available</p>
<div class="fragment"><div class="line">include(CheckLanguage)</div>
<div class="line">check_language(CUDA)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md110"></a>
CUDA Variables</h3>
<p >Exchange <em>CXX</em> with <em>CUDA</em></p>
<p >E.g. setting CUDA standard:</p>
<div class="fragment"><div class="line">if(NOT DEFINED CMAKE_CUDA_STANDARD)</div>
<div class="line">    set(CMAKE_CUDA_STANDARD 11)</div>
<div class="line">    set(CMAKE_CUDA_STANDARD_REQUIRED ON)</div>
<div class="line">endif()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md111"></a>
Adding libraries / executables</h3>
<p >As long as *.cu* is used for CUDA files, the procedure is as normal.</p>
<p >With separable compilation</p>
<div class="fragment"><div class="line">set_target_properties(mylib PROPERTIES</div>
<div class="line">                            CUDA_SEPARABLE_COMPILATION ON)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md112"></a>
Architecture</h3>
<p >Use <code>CMAKE_CUDA_ARCHITECTURES</code> variable and the <code>CUDA_ARCHITECTURES property</code> on targets.</p>
<h3><a class="anchor" id="autotoc_md113"></a>
Working with targets</h3>
<p >Compiler option</p>
<div class="fragment"><div class="line">&quot;$&lt;$&lt;BUILD_INTERFACE:$&lt;COMPILE_LANGUAGE:CXX&gt;&gt;:-fopenmp&gt;$&lt;$&lt;BUILD_INTERFACE:$&lt;COMPILE_LANGUAGE:CUDA&gt;&gt;:-Xcompiler=-fopenmp&gt;&quot;</div>
</div><!-- fragment --><p >Use a function that will fix a C++ only target by wrapping the flags if using a CUDA compiler</p>
<div class="fragment"><div class="line">function(CUDA_CONVERT_FLAGS EXISTING_TARGET)</div>
<div class="line">    get_property(old_flags TARGET ${EXISTING_TARGET} PROPERTY INTERFACE_COMPILE_OPTIONS)</div>
<div class="line">    if(NOT &quot;${old_flags}&quot; STREQUAL &quot;&quot;)</div>
<div class="line">        string(REPLACE &quot;;&quot; &quot;,&quot; CUDA_flags &quot;${old_flags}&quot;)</div>
<div class="line">        set_property(TARGET ${EXISTING_TARGET} PROPERTY INTERFACE_COMPILE_OPTIONS</div>
<div class="line">            &quot;$&lt;$&lt;BUILD_INTERFACE:$&lt;COMPILE_LANGUAGE:CXX&gt;&gt;:${old_flags}&gt;$&lt;$&lt;BUILD_INTERFACE:$&lt;COMPILE_LANGUAGE:CUDA&gt;&gt;:-Xcompiler=${CUDA_flags}&gt;&quot;</div>
<div class="line">            )</div>
<div class="line">    endif()</div>
<div class="line">endfunction()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md114"></a>
Useful variables</h3>
<ul>
<li><code>CMAKE_CUDA_TOOLKIT_INCLUDE_DIRECTORIES</code>: Place for built-in Thrust, etc</li>
<li><code>CMAKE_CUDA_COMPILER</code>: NVCC with location</li>
</ul>
<div class="fragment"><div class="line">set(CUDA_DIR &quot;/usr/local/cuda-10.0&quot;)</div>
<div class="line">set(CMAKE_CUDA_COMPILER ${CUDA_DIR}/bin/nvcc)</div>
<div class="line">set(CMAKE_CUDA_FLAGS &quot;-ccbin ${CC} -x cu -c -dc -O3  -Xcompiler &quot;-O3 -pthread&quot; -Wno-deprecated-gpu-targets -DVERSION=\&quot;${GIT_VERSION}\&quot;  --ptxas-options=-v&quot;)</div>
<div class="line">set(CMAKE_CUDA_FLAGS_DEBUG ...)</div>
<div class="line">set(CMAKE_CUDA_HOST_COMPILER ...)</div>
<div class="line">set(CMAKE_CUDA_EXTENSIONS ...)</div>
<div class="line">set(CMAKE_CUDA_STANDARD ...)</div>
<div class="line">set(CMAKE_CUDA_RUNTIME_LIBRARY ...)</div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md115"></a>
OpenMP</h2>
<h3><a class="anchor" id="autotoc_md116"></a>
Enable OpenMP support</h3>
<div class="fragment"><div class="line">find_package(OpenMP)</div>
<div class="line">if(OpenMP_CXX_FOUND)</div>
<div class="line">    target_link_libraries(MyTarget PUBLIC OpenMP::OpenMP_CXX)</div>
<div class="line">endif()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md117"></a>
Boost</h2>
<p >The Boost library is included in the find packages that CMake provides.</p>
<p >(Common) Settings related to boost</p>
<ul>
<li><code>set(Boost_USE_STATIC_LIBS OFF)</code></li>
<li><code>set(Boost_USE_MULTITHREADED ON)</code></li>
<li>`<code>set(Boost_USE_STATIC_RUNTIME OFF)</code></li>
</ul>
<p >E.g.: using the <code>Boost::filesystem</code> library</p>
<div class="fragment"><div class="line">set(Boost_USE_STATIC_LIBS OFF)</div>
<div class="line">set(Boost_USE_MULTITHREADED ON)</div>
<div class="line">set(Boost_USE_STATIC_RUNTIME OFF)</div>
<div class="line">find_package(Boost 1.50 REQUIRED COMPONENTS filesystem)</div>
<div class="line">message(STATUS &quot;Boost version: ${Boost_VERSION}&quot;)</div>
<div class="line"> </div>
<div class="line"># This is needed if your Boost version is newer than your CMake version</div>
<div class="line"># or if you have an old version of CMake (&lt;3.5)</div>
<div class="line">if(NOT TARGET Boost::filesystem)</div>
<div class="line">    add_library(Boost::filesystem IMPORTED INTERFACE)</div>
<div class="line">    set_property(TARGET Boost::filesystem PROPERTY</div>
<div class="line">        INTERFACE_INCLUDE_DIRECTORIES ${Boost_INCLUDE_DIR})</div>
<div class="line">    set_property(TARGET Boost::filesystem PROPERTY</div>
<div class="line">        INTERFACE_LINK_LIBRARIES ${Boost_LIBRARIES})</div>
<div class="line">endif()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md118"></a>
MPI</h2>
<h3><a class="anchor" id="autotoc_md119"></a>
Enable MPI support</h3>
<div class="fragment"><div class="line">find_package(MPI REQUIRED)</div>
<div class="line">message(STATUS &quot;Run: ${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} ${MPIEXEC_MAX_NUMPROCS} ${MPIEXEC_PREFLAGS} EXECUTABLE ${MPIEXEC_POSTFLAGS} ARGS&quot;)</div>
<div class="line">target_link_libraries(MyTarget PUBLIC MPI::MPI_CXX)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md120"></a>
Adding features</h1>
<h2><a class="anchor" id="autotoc_md121"></a>
Set default build type</h2>
<div class="fragment"><div class="line">set(default_build_type &quot;Release&quot;)</div>
<div class="line">if(NOT CMAKE_BUILD_TYPE AND NOT CMAKE_CONFIGURATION_TYPES)</div>
<div class="line">  message(STATUS &quot;Setting build type to &#39;${default_build_type}&#39; as none was specified.&quot;)</div>
<div class="line">  set(CMAKE_BUILD_TYPE &quot;${default_build_type}&quot; CACHE</div>
<div class="line">      STRING &quot;Choose the type of build.&quot; FORCE)</div>
<div class="line">  # Set the possible values of build type for cmake-gui</div>
<div class="line">  set_property(CACHE CMAKE_BUILD_TYPE PROPERTY STRINGS</div>
<div class="line">    &quot;Debug&quot; &quot;Release&quot; &quot;MinSizeRel&quot; &quot;RelWithDebInfo&quot;)</div>
<div class="line">endif()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md122"></a>
Meta compiler features</h2>
<div class="fragment"><div class="line">target_compile_features(myTarget PUBLIC cxx_std_11)</div>
<div class="line">set_target_properties(myTarget PROPERTIES CXX_EXTENSIONS OFF)</div>
<div class="line">set(CMAKE_CXX_STANDARD 11)</div>
<div class="line">set(CMAKE_CXX_STANDARD_REQUIRED ON)</div>
<div class="line">set(CMAKE_CXX_EXTENSIONS OFF)</div>
<div class="line">set_target_properties(myTarget PROPERTIES</div>
<div class="line">    CXX_STANDARD 11</div>
<div class="line">    CXX_STANDARD_REQUIRED YES</div>
<div class="line">    CXX_EXTENSIONS NO</div>
<div class="line">)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md123"></a>
Position independent code (-fPIC)</h2>
<div class="fragment"><div class="line">set(CMAKE_POSITION_INDEPENDENT_CODE ON)</div>
<div class="line"># or target dependent</div>
<div class="line">set_target_properties(lib1 PROPERTIES POSITION_INDEPENDENT_CODE ON)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md124"></a>
Little libraries</h2>
<div class="fragment"><div class="line">find_library(MATH_LIBRARY m)</div>
<div class="line">if(MATH_LIBRARY)</div>
<div class="line">    target_link_libraries(MyTarget PUBLIC ${MATH_LIBRARY})</div>
<div class="line">endif()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md125"></a>
Modules</h2>
<p >See <a href="https://cmake.org/cmake/help/latest/manual/cmake-modules.7.html">CMake modules</a></p>
<h3><a class="anchor" id="autotoc_md126"></a>
CMakeDependentOption</h3>
<div class="fragment"><div class="line">include(CMakeDependentOption)</div>
<div class="line">cmake_dependent_option(BUILD_TESTS &quot;Build your tests&quot; ON &quot;VAL1;VAL2&quot; OFF)</div>
</div><!-- fragment --><p >which is equivalent to</p>
<div class="fragment"><div class="line">if(VAL1 AND VAL2)</div>
<div class="line">    set(BUILD_TESTS_DEFAULT ON)</div>
<div class="line">else()</div>
<div class="line">    set(BUILD_TESTS_DEFAULT OFF)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">option(BUILD_TESTS &quot;Build your tests&quot; ${BUILD_TESTS_DEFAULT})</div>
<div class="line"> </div>
<div class="line">if(NOT BUILD_TESTS_DEFAULT)</div>
<div class="line">    mark_as_advanced(BUILD_TESTS)</div>
<div class="line">endif()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md127"></a>
CMakePrintHelpers</h3>
<div class="fragment"><div class="line">cmake_print_properties</div>
<div class="line">cmake_print_variables</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md128"></a>
CheckCXXCompilerFlag</h3>
<p >Check whether flag is supported</p>
<div class="fragment"><div class="line">include(CheckCXXCompilerFlag)</div>
<div class="line">check_cxx_compiler_flag(-someflag OUTPUT_VARIABLE)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md129"></a>
WriteCompilerDetectionHeader</h3>
<p >Look for a list of features that some compilers support and write out a C++ header file that lets you know whether that feature is available</p>
<div class="fragment"><div class="line">write_compiler_detection_header(</div>
<div class="line">  FILE myoutput.h</div>
<div class="line">  PREFIX My</div>
<div class="line">  COMPILERS GNU Clang MSVC Intel</div>
<div class="line">  FEATURES cxx_variadic_templates</div>
<div class="line">)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md130"></a>
try_compile / try_run</h3>
<div class="fragment"><div class="line">try_compile(</div>
<div class="line">  RESULT_VAR</div>
<div class="line">    bindir</div>
<div class="line">  SOURCES</div>
<div class="line">    source.cpp</div>
<div class="line">)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md131"></a>
Debugging</h1>
<h2><a class="anchor" id="autotoc_md132"></a>
Printing variables</h2>
<div class="fragment"><div class="line">message(STATUS &quot;MY_VARIABLE=${MY_VARIABLE}&quot;)</div>
<div class="line"># or using module </div>
<div class="line">include(CMakePrintHelpers)</div>
<div class="line">cmake_print_variables(MY_VARIABLE)</div>
<div class="line">cmake_print_properties(</div>
<div class="line">    TARGETS my_target</div>
<div class="line">    PROPERTIES POSITION_INDEPENDENT_CODE</div>
<div class="line">)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md133"></a>
Tracing a run</h2>
<div class="fragment"><div class="line">cmake -S . -B build --trace-source=CMakeLists.txt #--trace-expand </div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md134"></a>
Including projects</h1>
<h2><a class="anchor" id="autotoc_md135"></a>
Fetch</h2>
<p >E.g.: download Catch2</p>
<div class="fragment"><div class="line">FetchContent_Declare(</div>
<div class="line">  catch</div>
<div class="line">  GIT_REPOSITORY https://github.com/catchorg/Catch2.git</div>
<div class="line">  GIT_TAG        v2.13.0</div>
<div class="line">)</div>
<div class="line"># CMake 3.14+</div>
<div class="line">FetchContent_MakeAvailable(catch)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md136"></a>
Testing</h1>
<h2><a class="anchor" id="autotoc_md137"></a>
General</h2>
<p >Enable testing and set a <code>BUILD_TESTING</code> option</p>
<div class="fragment"><div class="line">if(CMAKE_PROJECT_NAME STREQUAL PROJECT_NAME)</div>
<div class="line">    include(CTest)</div>
<div class="line">endif()</div>
</div><!-- fragment --><p >Add test folder</p>
<div class="fragment"><div class="line">if(CMAKE_PROJECT_NAME STREQUAL PROJECT_NAME AND BUILD_TESTING)</div>
<div class="line">    add_subdirectory(tests)</div>
<div class="line">endif()</div>
</div><!-- fragment --><p >Register targets</p>
<div class="fragment"><div class="line">add_test(NAME TestName COMMAND TargetName)</div>
<div class="line">add_test(NAME TestName COMMAND $&lt;TARGET_FILE:${TESTNAME}&gt;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md138"></a>
Building as part of the test</h2>
<div class="fragment"><div class="line">add_test(</div>
<div class="line">  NAME</div>
<div class="line">    ExampleCMakeBuild</div>
<div class="line">  COMMAND</div>
<div class="line">    &quot;${CMAKE_CTEST_COMMAND}&quot;</div>
<div class="line">             --build-and-test &quot;${My_SOURCE_DIR}/examples/simple&quot;</div>
<div class="line">                              &quot;${CMAKE_CURRENT_BINARY_DIR}/simple&quot;</div>
<div class="line">             --build-generator &quot;${CMAKE_GENERATOR}&quot;</div>
<div class="line">             --test-command &quot;${CMAKE_CTEST_COMMAND}&quot;</div>
<div class="line">)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md139"></a>
Testing frameworks</h2>
<h3><a class="anchor" id="autotoc_md140"></a>
GoogleTest</h3>
<p >See <a href="https://cliutils.gitlab.io/modern-cmake/chapters/testing/googletest.html">Modern CMake: GoogleTest</a> for reference.</p>
<p >Checkout GoogleTest as submodule</p>
<div class="fragment"><div class="line">git submodule add --branch=release-1.8.0 ../../google/googletest.git extern/googletest</div>
</div><!-- fragment --><div class="fragment"><div class="line">option(PACKAGE_TESTS &quot;Build the tests&quot; ON)</div>
<div class="line">if(PACKAGE_TESTS)</div>
<div class="line">    enable_testing()</div>
<div class="line">    include(GoogleTest)</div>
<div class="line">    add_subdirectory(tests)</div>
<div class="line">endif()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md141"></a>
Catch2</h3>
<div class="fragment"><div class="line"># Prepare &quot;Catch&quot; library for other executables</div>
<div class="line">set(CATCH_INCLUDE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/extern/catch)</div>
<div class="line">add_library(Catch2::Catch IMPORTED INTERFACE)</div>
<div class="line">set_property(Catch2::Catch PROPERTY INTERFACE_INCLUDE_DIRECTORIES &quot;${CATCH_INCLUDE_DIR}&quot;)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md142"></a>
DocTest</h3>
<p ><em>DocTest</em> is a replacement for <em>Catch2</em> that is supposed to compile much faster and be cleaner. Just replace <em>Catch2</em> with <em>DocTest</em>.</p>
<h1><a class="anchor" id="autotoc_md143"></a>
Exporting and Installing</h1>
<p >Allow others to use your library, via</p>
<ul>
<li><em>Bad way:</em> Find module</li>
<li><em>Add subproject:</em> <code>add_library(MyLib::MyLib ALIAS MyLib)</code></li>
<li><em>Exporting:</em> Using *Config.cmake scripts</li>
</ul>
<h2><a class="anchor" id="autotoc_md144"></a>
Installing</h2>
<p >See <a href="https://cliutils.gitlab.io/modern-cmake/chapters/install/installing.html">GitBook: Installing</a> Basic target install command (executed by e.g. <code>make install</code>)</p>
<div class="fragment"><div class="line">install(TARGETS MyLib</div>
<div class="line">        EXPORT MyLibTargets</div>
<div class="line">        LIBRARY DESTINATION lib</div>
<div class="line">        ARCHIVE DESTINATION lib</div>
<div class="line">        RUNTIME DESTINATION bin</div>
<div class="line">        INCLUDES DESTINATION include</div>
<div class="line">        )</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md145"></a>
Exporting</h2>
<p >See <a href="https://cliutils.gitlab.io/modern-cmake/chapters/install/exporting.html">GitBook: Exporting</a></p>
<h2><a class="anchor" id="autotoc_md146"></a>
Packaging</h2>
<p >See <a href="https://cliutils.gitlab.io/modern-cmake/chapters/install/packaging.html">GitBook: Packaging</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
  <hr class="footer"/><address class="footer"><small>
    milupHPC  - CMake<br />
    Generated on Thu Feb 10 2022 17:28:33 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.9.3
  </small></address>
</body>
<footer>
  <custom-footer color="white" background="#2E4053">
    <div first>first: more content to add</div>
    <div second>second: bla bla bla</div>
    <div third>third: more content to add</div>
  </custom-footer>
</footer>
<!--
<script src="components/side-nav/runtime.js" type="module"></script><script src="components/side-nav/polyfills.js" type="module"></script><script src="components/side-nav/main.js" type="module"></script>
-->
<script src="components/hamburger/runtime.js" type="module"></script><script src="components/hamburger/polyfills.js" type="module"></script><script src="components/hamburger/main.js" type="module"></script>
<script src="components/header/runtime.js" type="module"></script><script src="components/header/polyfills.js" type="module"></script><script src="components/header/main.js" type="module"></script>
<script src="components/icons/runtime.js" type="module"></script><script src="components/icons/polyfills.js" type="module"></script><script src="components/icons/main.js" type="module"></script>
<script src="components/footer/runtime.js" type="module"></script><script src="components/footer/polyfills.js" type="module"></script><script src="components/footer/main.js" type="module"></script>
<script src="components/dialog/runtime.js" type="module"></script><script src="components/dialog/polyfills.js" type="module"></script><script src="components/dialog/main.js" type="module"></script>
<script>
  function toggle() {
    var elem = document.getElementById("side-nav");
    console.log(elem);
    elem.toggleSideNav(false);
  }
</script>
<!--
<script>
  function topFunction() {
    document.body.scrollTop = 0; // For Safari
    document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
  }
</script>
-->
</html>